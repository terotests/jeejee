var jeejee_prototype=function(){"use strict";var t=function(){var t=function(){!function(t){var e,i,n,r,a;t.add=function(t,e,n){if(e||n){var r;"[object Array]"===Object.prototype.toString.call(n)?r=n:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),i.push([e,t,r])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},r={},a=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<a.length;f++){var l=a[f];l()}for(var d in n)if(n.hasOwnProperty(d)){var h=n[d];h[0](h[1]),delete n[d]}for(var d in r)if(r.hasOwnProperty(d)){var h=r[d];h.nextTime<o&&(h.remove?h.nextTime>0?(h.fn(),delete r[d]):h.nextTime=o+h.step:(h.fn(),h.nextTime=o+h.step)),h.until&&h.until<o&&delete r[d]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){a.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=a.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),a.splice(e,1),!0):!1}}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("later",i),i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,r=0,a=[],o=new Array(n);return this.then(function(){var t=e();return 0==i.length&&t.resolve([]),i.forEach(function(e,i){e.then?(a.push(e),e.then(function(e){o[i]=e,r++,r==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var r;r=this.isArray(i)?i:[i];var a=r.length,o=!1,s=!1,c=0,f=[],l=n||{};return this.then(function(){var i=e();return r.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,l),(o&&!s||0==s&&a==c)&&(i.resolve(l),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onFulfill)try{var n=i._onFulfill(t);"undefined"!=typeof n?i.resolve(n):i.fulfill(t)}catch(r){i.reject(r)}else i.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),r=t.concat(e),a=i.apply(this,r);n.resolve(a)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e),!e&&this.isFunction(t)){var n=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){n.resolve(t)},function(t){n.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,e){this.plugin(t,function(){var t,i,n=Array.prototype.slice.call(arguments,0),r=0;n.length>=0&&(t=n[n.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(i=t,r=n.length-1));var a=wishes().pending();return this.then(function(){var t=wishes().pending(),o=Array.prototype.slice.call(arguments,0);console.log("Orig args",n),console.log("Then args",o);var s;0==n.length&&(s=o),0==o.length&&(s=n),s||(s=o.concat(n)),r=s.length,i&&r--,s[r]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void a.reject(e);if(i){var n=Array.prototype.slice.call(arguments),r=i.apply(this,n);a.resolve(r)}else{var n=Array.prototype.slice.call(arguments,1);a.resolve.apply(a,n)}},t.then(function(t){a.resolve(t)}),console.log("nodeStyle after concat",s);e.apply(this,s);return t},function(t){a.reject(t)}),a})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({name:i,promise:t[i]});var n=e.length,r=0,a=[],o={};return this.then(function(){var t=wishes().pending();return e.forEach(function(e){var i=e.promise,s=e.name;i.then?(a.push(i),i.then(function(e){o[s]=e,r++,r==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onReject)try{i._onReject(t),i.reject(t)}catch(n){i.reject(n)}else i.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var r=new e(t,n),a=this;return 1==this._state&&i().asap(function(){a.fulfill(a.value())}),2==this._state&&ater().asap(function(){a.reject(a.rejectReason())}),this._childPromises.push(r),r},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,r,a,o,s,c){if(!(this instanceof e))return new e(t,i,n,r,a,o,s,c);var f=[t,i,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=e._classInfo.name)return new l(t,i,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_promise",e),e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var i=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){var i=t.div(),n=t.div(),r=i.table(),a=D("input");r.addRow(a,"Hae ID -arvolla");var o=i.div().button().text("Etsi"),s=D("textarea");s.width(700).height(130),n.add(s),o.on("click",function(){var t=e.findFromCache(a.val());s.val(t?JSON.stringify(t.toData(),null,2):"Object not found ")})})}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=r._classInfo.name)return new l(t,e,i,n,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"objectTools"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("objectTools",r),r.prototype=new i,"undefined"!=typeof window&&(window.objectTools=r),"undefined"!=typeof window&&(window.objectTools_prototype=i);var s=function(){!function(t){t.fromAce=function(t){var e=[];return t.forEach(function(t){var i=t.range;"insertText"==t.action&&e.push([1,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"removeText"==t.action&&e.push([2,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"insertLines"==t.action&&e.push([3,i.start.row,i.start.column,i.end.row,i.end.column,t.lines]),"removeLines"==t.action&&e.push([4,i.start.row,i.start.column,i.end.row,i.end.column,t.lines,t.nl])}),e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.runToAce=function(t){var e=[],i=["","insertText","removeText","insertLines","removeLines"];return t.forEach(function(t){var n={action:i[t[0]],range:{start:{row:t[1],column:t[2]},end:{row:t[3],column:t[4]}}};t[0]<3?n.text=t[5]:n.lines=t[5],4==t[0]&&(n.nl=t[6]||"\n"),e.push(n)}),e},t.runToLineObj=function(t,e){e.forEach(function(e){var i=e[1],n=e[2],r=e[3],a=e[4];if(1==e[0])if("\n"==e[5]){var o=t.item(i);if(o){var s=o.text();o.text(s.slice(0,n));var c={text:s.slice(n)||""};t.insertAt(i+1,c)}else t.insertAt(i,{text:""}),t.insertAt(i+1,{text:""})}else{var o=t.item(i);if(o){var s=o.text();o.text(s.slice(0,n)+e[5]+s.slice(n))}else t.insertAt(i,{text:e[5]})}if(2==e[0])if("\n"==e[5]){var f=t.item(i),l=t.item(i+1),d="",h="";f&&(d=f.text()),l&&(h=l.text()),f?f.text(d+h):t.insertAt(i,{text:""}),l&&l.remove()}else{var o=t.item(i),s=o.text();o.text(s.slice(0,n)+s.slice(a))}if(3==e[0])for(var u=r-i,_=0;u>_;_++)t.insertAt(i+_,{text:e[5][_]});if(4==e[0])for(var u=r-i,_=0;u>_;_++){var o=t.item(i);o.remove()}})},t.runToString=function(t,e){if(!e||"undefined"==typeof t)return"";t+="";var i=t.split("\n");return e.forEach(function(t){var e=t[1],n=t[2],r=t[3],a=t[4];if(1==t[0])if("\n"==t[5]){var o=i[e]||"";i[e]=o.slice(0,n);var s=o.slice(n)||"";i.splice(e+1,0,s)}else{var o=i[e]||"";i[e]=o.slice(0,n)+t[5]+o.slice(n)}if(2==t[0])if("\n"==t[5]){var c=i[e]||"",f=i[e+1]||"";i[e]=c+f,i.splice(e+1,1)}else{var o=i[e]||"";i[e]=o.slice(0,n)+o.slice(a)}if(3==t[0])for(var l=r-e,d=0;l>d;d++)i.splice(e+d,0,t[5][d]);if(4==t[0])for(var l=r-e,d=0;l>d;d++)i.splice(e,1)}),i.join("\n")},t.simplify=function(t){var e,i=[],n=null;return t.forEach(function(t){e&&1==t[0]&&1==e[0]&&t[3]==t[1]&&e[1]==t[1]&&e[3]==t[3]&&e[4]==t[2]?n?(n[3]=t[3],n[4]=t[4],n[5]=n[5]+t[5]):(n=[],n[0]=1,n[1]=e[1],n[2]=e[2],n[3]=t[3],n[4]=t[4],n[5]=e[5]+t[5]):(n&&(i.push(n),n=null),1==t[0]?n=t.slice():i.push(t)),e=t}),n&&i.push(n),i}}(this)},c=function(t,e,i,n,r,a,o,s){if(!(this instanceof c))return new c(t,e,i,n,r,a,o,s);var f=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=c._classInfo.name)return new l(t,e,i,n,r,a,o,s)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};c._classInfo={name:"aceCmdConvert"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("aceCmdConvert",c),c.prototype=new s,"undefined"!=typeof window&&(window.aceCmdConvert=c),"undefined"!=typeof window&&(window.aceCmdConvert_prototype=s);var f=function(){var t=function(){!function(t){t.run=function(t,e,i){if(t&&i&&4==t[0]){var n=t[1],r=e.data[n],a=i.value;a!=r&&(i.value=r)}}}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"_inputWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_inputWorker",i),i.prototype=new t;var n=function(){!function(t){t.run=function(t,e,i){if(t&&i){var n=i;if(this.bDetected||("undefined"!=typeof n.textContent?this.bFast=!0:(this.bFast=!1,this.tmpDom=document.createElement("div")),this.bDetected=!0),4==t[0]){var r=t[1],a=e.data[r];this.bFast?i.textContent=a:(this.tmpDom.innerHTML=a,i.innerHTML?i.innerHTML=this.tmpDom.innerText:i.replaceData(0,i.nodeValue.length,a||""))}}}}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=r._classInfo.name)return new l(t,e,i,n,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"_domTextWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_domTextWorker",r),r.prototype=new n;var a=function(){!function(t){var e,i,n,r,a,o,s,f,l;t._addCustomDir=function(t,e){o||(o={}),o[t]=e},t._addModelTemplate=function(t,i){var n=this.guid();e||(e={}),e[n]=i,t&&t.setAttribute&&t.setAttribute("data-tpl",n)},t._callCustom=function(t,e,i){o[t]&&o[t](e,i)},t._clearWorkers=function(t){t.workers.forEach(function(t){a._removeWorker(t)});var e=this;t.childViews.forEach(function(t){e._clearWorkers(t)})},t._createViewDef=function(t,e){var i={viewid:this.getGUID(),dataid:t,baseTpl:null,dom:null,parentView:e,workers:[],childViews:[]};return s||(s={}),s[i.viewid]=i,e&&e.childViews&&e.childViews.push(i),a._addModelView(t,i),i},t._eventActionFor=function(t,e,i){var n=t.target;if(n){var r=n.getAttribute(e),a=this;if(r){for(var o,s=10,c=n;c&&!(o=c.getAttribute("data-id"))&&s--;)c=c.parentNode;if(c&&o){var f=r.split("("),r=f.shift(),l=f.pop(),d=null;if(l)var h=l.split(")"),d=h.shift().split(",");var u=i.findFromCache(o);a.isFunction(u[r])&&(console.log("fires ",r,d),a.isArray(d)?u[r].apply(u,d):u[r]())}}}},t._findModelTemplate=function(t){if(t&&t.getAttribute){var i=t.getAttribute("data-tpl");if(e)return e[i]}},t._getNamedView=function(t){return r[t]},t._getNamedViews=function(){return r},t._getSvgTagName=function(t){return"textpath"==t?"textPath":t},t._getViewsOfModel=function(t){return e[t]},t._saveViewTemplate=function(t,e){i||(i={}),i[t]=e},t._setNamedModel=function(t,e){return n[t]=e,this},t._setNamedView=function(t,e){r[t]=e},t.clearTheView=function(t){if(s){var e=s[t];if(e){this._clearWorkers(e);var i=e.parentView;if(i){var n=i.childViews.indexOf(e);n>=0&&i.childViews.splice(n,1)}delete s[e.viewid]}}},t.composeModelView=function(t,e,i,n){var r,o=e,s=this,c=i.baseTpl;if(r=n?n:s._createViewDef(o.__id,i),c.classSwitch){var f,l=o.data[c.classSwitch];if(l?(f=c.classTemplates[l],f||(f=c.classTemplates["default"])):f=c.classTemplates["default"],f&&f){var d=s.composeTemplate(o,f,r);n?n.dom.parentNode.replaceChild(d,n.dom):t.appendChild(d),r.dom=d;var h=a._createWorker(o.__id,c.classSwitch,y().fetch(5),t,{view:r,template:c,m:o,dom:d});r.workers.push(h)}}else{var u=c.children[0],d=s.composeTemplate(o,u,i);t.appendChild(d),r.dom=d}},t.composePartsToTxt=function(t,e){for(var i="",n=t.txtParts.list,r=t.txtParts.tokens,a=0;a<n.length;a++){var o;if(o=r[a]){var s="";"undefined"!=typeof e.data[o]&&(s=e.data[o]||""),i+=s}else i+=n[a]||""}return i},t.composeTemplate=function(t,e,i){var n=!1,r=this;e&&e.tplData&&(e=e.tplData),e&&e.baseTpl&&(e=e.baseTpl);var s=!1;if(e.dataAttrs){{var c;e.dataAttrs["data-model-url"],e.dataAttrs["data-model-url-confirm"]}(c=e.dataAttrs["data-selection"])&&t.data[c]&&a._addSelectionModel(t.data[c]);var f=e.dataAttrs["data-use-model"];f&&a.query(f,function(e){e&&(t=e,s=!0)})}if(i){if(e.dataAttrs){var d=e.dataAttrs["data-view"];d&&(i=this._createViewDef(t.__id,i),i.baseTpl=e,this._setNamedView(d,i))}}else if(i=this._createViewDef(t.__id),i.baseTpl=e,e.dataAttrs){var d=e.dataAttrs["data-view"];d&&this._setNamedView(d,i)}if(3==e.type){var h;if(e.txtParts&&e.txtParts.bHas)for(var h=document.createDocumentFragment(),u=e.txtParts.list,_=e.txtParts.tokens,p=0;p<u.length;p++){var v;if(v=_[p]){var m="",g=!1,b=v.split(":");if(b.length>1){v=b[0];var w=b[1];if("aceHTML"==w){"undefined"!=typeof t.data[v]&&(m=t.data[v]||"");var x=document.createElement("div");x.setAttribute("class","aceHTML");var C=r.getAceInstance(t.__id+":"+v,x,t,v,null,i);C.dom.parentNode&&C.dom.parentNode.removeChild(C.dom),h.appendChild(C.dom),C.editor._noUpdates=!0,C.editor.setValue(m),C.editor._noUpdates=!1,i.workers.push(O),g=!0}if("aceJS"==w){"undefined"!=typeof t.data[v]&&(m=t.data[v]||"");var x=document.createElement("div");x.setAttribute("class","aceHTML");var C=r.getAceInstance(t.__id+":"+v,x,t,v,"javascript",i);C.dom.parentNode&&C.dom.parentNode.removeChild(C.dom),h.appendChild(C.dom),C.editor._noUpdates=!0,C.editor.setValue(m),C.editor._noUpdates=!1,g=!0}if("template"==w){"undefined"!=typeof t.data[v]&&(m=t.data[v]||"");var I=r.compile(m),j=r.composeTemplate(t,I);h.appendChild(j),g=!0;var T=r.getViewForElem(j),O=a._createWorker(t.__id,v,y().fetch(9),j,{modelid:t.__id,compiler:r,view:T});T.workers.push(O)}var A;if(l[w],(A=l[w])&&("this"==v?m=t:"undefined"!=typeof t.data[v]&&(m=t.data[v]||""),A.fn&&v)){var k=A.fn(m,{dom:h,data:t,tpl:e,view:i});if(k){h.appendChild(k),g=!0;var E=t.data[v];if(r.isObject(E)&&r.isArray(E.data))var O=a._createWorker(E.__id,"*",y().fetch(10),k,{modelid:E.__id,fn:A.fn,varName:v,dom:k,callOpts:{dom:h,data:E,tpl:e,view:i}});else{E=t;var O=a._createWorker(E.__id,v,y().fetch(10),k,{modelid:E.__id,fn:A.fn,varName:v,dom:k,callOpts:{dom:h,data:E,tpl:e,view:i}})}i.workers.push(O)}}}g||a.query(v,function(t,e){if(e){t||(t="");var n=document.createTextNode(t);if(h.appendChild(n),e.obj&&e.name){var r=a._createWorker(e.obj.__id,e.name,y().fetch(1),n,null);i.workers.push(r)}}},t)}else h.appendChild(document.createTextNode(u[p]||""))}else h=document.createTextNode(e.text||"")}if(1==e.type){var h,S=!1;if("svg"==e.tagName)h=document.createElementNS("http://www.w3.org/2000/svg","svg"),h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");else if("svg"==e.ns){var h=document.createElementNS("http://www.w3.org/2000/svg",this._getSvgTagName(e.tagName));h.setAttributeNS(null,"data-id",t.__id),h.setAttributeNS(null,"data-viewid",i.viewid)}else{var h=document.createElement(e.tagName);h.setAttribute("data-id",t.__id),h.setAttribute("data-viewid",i.viewid)}var N=!1;i.dom||(i.dom=h);var M,F;if(t&&(M=e.dataAttrs["data-sel-class"])){var L=M.split(":");F=L[0];var D=P().findSelection(F);D.indexOf(t.__id)>=0&&$(h).addClass(L[1])}var R=!1;if("style"==e.tagName){R=!0;var V=e.children[0],q={tpl:V,dom:h,model:t,modelid:t.__id},H=P()._createWorker(t.__id,"*",y().fetch(8),h,q);i.workers.push(H);var B=this.composePartsToTxt(V,t);h.cssText?h.cssText=B:r.dom_setText(h,B)}var U;if(t&&(U=e.dataAttrs["data-if-not-last"]))try{var W=t.__p;if(W){var z=a._find(W);if("undefined"!=typeof z){var G=z.data.indexOf(t),J=z.data.length;J-1>G||(h.style.display="none",n=!0)}}}catch(Q){console.error(Q.message)}if((U=e.dataAttrs["data-if"])&&a.query(U,function(e){e||(h.style.display="none");var n=a._createWorker(t.__id,U,y().fetch(11),h);i.workers.push(n)},t),(U=e.dataAttrs["data-if-not"])&&a.query(U,function(e){e&&(h.style.display="none");var n=a._createWorker(t.__id,U,y().fetch(11),h);i.workers.push(n)},t),U=e.dataAttrs["data-if-then"]){var Y=U.split("=>"),X=Y[0].split("="),K=X[0];a.query(K,function(t,e){var n=a._createWorker(e.obj.__id,e.name,y().fetch(13),h,{modelid:e.obj.__id,evalFn:U,thenCtrl:$.trim(Y[1])});i.workers.push(n)},t)}if(!S){var Z;if(Z=e.dataAttrs["data-upload-to"])try{var te={vars:{},target:Z,autoUpload:!0,onComplete:function(t){console.log("***** GOT FROM UPLOAD "),console.log(t),a.execCommand(t)}},ee=e.dataAttrs["data-upload-list"];ee&&a.query(ee,function(t,e){console.log("---- upload list, to"),console.log(t),console.log(e),e.vars.responsesTo=e.obj.__id},t);var ie=a._createUploadFrame(te);h.appendChild(ie._dom)}catch(Q){alert(Q.message)}if(e.valueParts&&e.valueParts.bHas){for(var u=e.valueParts.list,_=e.valueParts.tokens,p=0;p<u.length;p++){var v;if(v=_[p]){var m="";a.query(v,function(t,n){if(n&&(t||(t=""),h.value=t,n.obj&&n.name)){var o=n.obj,s=n.name,c=a._createWorker(o.__id,s,y().fetch(2),h,null);i.workers.push(c),r.dom_setAttr(h,"data-value-id",o.__id+"::"+s,e.ns)}},t)}}N=!0}e.attributes&&e.attributes.forEach(function(n){var s=n[0],c=n[1],f=n[2];if("value"!=s||!N){var l=!1;if(o[s]){var d,u={},_={currentView:i,model:t,binds:f,name:s,vars:u,value:d};if(f)for(var p=f.list,v=f.tokens,m=0;m<p.length;m++){var g;if(g=v[m]){var b="";"undefined"!=typeof t.data[g]&&(b=t.data[g]||""),u[g]=b,_.vars=u,_.value=b;var w=a._createWorker(t.__id,g,y().fetch(6),h,_);i.workers.push(w)}}o[s](h,_)}if(e.dataAttrs[s]&&"data-attr-fwd"==s){var x=c.split(",");x.forEach(function(n){n=n.trim();var o="",s=n,c=n.split("=>");if(c.length>1&&(s=c[1].trim(),n=c[0].trim()),"undefined"!=typeof t.data[n]&&(o=t.data[n]||""),r.dom_setAttr(h,s,o,e.ns),"svg"==e.ns)var f=a._createWorker(t.__id,n,y().fetch(4),h,s);else var f=a._createWorker(t.__id,n,y().fetch(3),h,s);i.workers.push(f),l=!0})}if(f){var p=f.list,v=f.tokens;r.composeTokensToTxt(f,t,function(t){l=!0,r.dom_setAttr(h,s,t,e.ns)});for(var m=0;m<p.length;m++){var g;if(g=v[m]){var b="";if("undefined"!=typeof t.data[g]&&(b=t.data[g]||""),"svg"==e.ns)var w=a._createWorker(t.__id,g,y().fetch(4),h,{attrName:s,binds:f,compiler:r});else var w=a._createWorker(t.__id,g,y().fetch(3),h,{attrName:s,binds:f,compiler:r});i.workers.push(w),l=!0}}}l||r.dom_setAttr(h,s,c,e.ns)}})}if(e.children&&!R&&"textarea"!=e.tagName){var r=this;e.children.forEach(function(n){var o=n.dataAttrs["data-model"],s=n.dataAttrs["data-view"];if(o)a.query(o,function(t){if(t&&t.__id){if("svg"==n.ns)var o=document.createElementNS("http://www.w3.org/2000/svg",e.tagName);else var o=document.createElement(n.tagName);n.attributes.forEach(function(t){{var i=t[0],n=t[1];t[2]}r.dom_setAttr(o,i,n,e.ns)});var c=r._createViewDef(t.__id,i);if(c.dom=o,s&&r._setNamedView(s,c),r.dom_setAttr(o,"data-id",t.__id,e.ns),c.tagName=n.tagName,c.baseTpl=n,r.isArray(t.data)){var f=a._createWorker(t.__id,"*",y().fetch(7),c);c.workers.push(f),t.data.forEach&&t.data.forEach(function(t){r.composeModelView(o,t,c)}),h.appendChild(o)}else{var o=r.composeTemplate(t,n,c);o&&h.appendChild(o)}}},t);else{var c=r.composeTemplate(t,n,i);c&&h.appendChild(c)}})}}return n?h=document.createDocumentFragment():h},t.composeTokensToTxt=function(t,e,i){for(var n=t.list,r=t.tokens,o=[],s=0,c=!1,f=0;f<n.length;f++){var l;(l=r[f])?!function(t){a.query(l,function(e){e||(e=""),o[t]=e,s++,c||s!=n.length||(c=!0,i(o.join("")))},e)}(f):(o[f]=n[f]||"",s++)}c||s!=n.length||i(o.join(""))},t.createElemFromTpl=function(t,e){var i=this._findModelTemplate(t);console.log("Tpl",i);var n=i.cProp,r=i.baseTpl,a=e,o=this;if(!n){var s=o.createNewTemplate(a,r,t.tagName);return s}var c=i.classTpl;if(a.data[n]){var f=a.data[n],l=c[f];if(l){l=l.trim();var s=o.createNewTemplate(a,l,t.tagName);return s}}},t.createViewType=function(t,e,i){return l[t]?l[t].fn(e,i):void 0},t.findTemplateList=function(t){var e=t.split("{{"),i=e.length;if(2>i)return[t];for(var n=[],r=0;r<e.length;r++){var a=e[r];if(0!=a.length){var o=a.split("}}");o.length>1?(n.push("{{"+o[0]+"}}"),n.push(o[1])):n.push(a)}}return n},t.getAceInstance=function(t,e,i,n,r,o){if(r||(r="html"),f||(f={}),!f[t]){var s=ace.edit(e);s.setTheme("ace/theme/monokai"),s.getSession().setMode("ace/mode/"+r);s.getSession().on("change",function(t){if(!s._noUpdates){s._noUpdates=!0;for(var e,r=c(),o=c().fromAce([t.data]),f=r.simplify(o),l=[];e=f.pop();)l.push(e);a.execCommand([13,n,l,null,i.__id]),s._noUpdates=!1}});var l={dom:e,name:t,editor:s};f[t]=l;var d=a._createWorker(i.__id,n,y().fetch(12),e,{modelid:i.__id,editor:s,view:o});o.workers.push(d)}return f[t]},t.getGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.getViewForElem=function(t){var e=t.getAttribute("data-viewid");return e?s[e]:void 0},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){n||(n={},r={},o={},l={},a=P())}),t.registerViewType=function(t,e){l[t]=e}}(this),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isDataTrait=function(t){return t.__dataTr?!0:void 0},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.dom_setAttr=function(t,e,i,n){"xlink:href"==e?t.setAttributeNS("http://www.w3.org/1999/xlink","href",i):n?t.setAttributeNS&&t.setAttributeNS(null,e,i):t.setAttribute&&t.setAttribute(e,i)},t.dom_setText=function(t,e){if("undefined"!=typeof t.textContent)t.textContent=e;else{var i=document.createElement("div");i.innerHTML=e;var n=i.textContent||i.innerText||"";e.innerHTML=n}}}(this),function(t){var e,i;t.compile=function(t,e){var n,r={tagName:"DIV",tplData:null};if(e){var a=document.createElement(e);a.innerHTML=t,r.tagName=e,i[r.tagName.toLowerCase()]&&(n="svg")}else{var a=document.createElement("DIV");a.innerHTML=t}return r.tplData=this.parseNode(a,n),r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=D(),i={circle:"true",rect:!0,path:!0,svg:!0,image:!0,line:!0,text:!0,tspan:!0,g:!0,pattern:!0,polygon:!0,polyline:!0,clippath:!0,defs:!0,textpath:!0,feoffset:!0,femerge:!0,femergenode:!0,fegaussianblur:!0,filter:!0})}),t.parseMustache=function(t){var e=t.split("{{"),i=e.length;if(2>i)return[t];for(var n=[],r=0;r<e.length;r++){var a=e[r];if(0!=a.length){var o=a.split("}}");o.length>1?(n.push("{{"+o[0]+"}}"),n.push(o[1])):n.push(a)}}return n},t.parseNode=function(t,e){if(8==t.nodeType)return null;var n={tagName:t.tagName,type:t.nodeType,children:[],attributes:[],classTemplates:{},dataAttrs:{},ns:e};if(n.tagName){var r=n.tagName.toLowerCase();i[r]&&(e="svg","svg"!=r&&(n.ns="svg")),n.tagName=r}var a=!1;t.nodeName&&"input"==t.nodeName.toLowerCase()&&(a=!0);var o;if(a&&(o=t.getAttribute("data-input-value"))&&(n.value=o,n.valueParts=this.parseTemplateParts(o)),t.value&&!o&&(n.value=t.value,n.valueParts=this.parseTemplateParts(n.value)),t.attributes)for(var s=0;s<t.attributes.length;s++){var c=t.attributes[s];if(c.specified){var f=c.name,l=c.value;"data"==f.substring(0,4)&&(n.dataAttrs[f]=l),n.attributes.push([f,l,this.parseTemplateParts(l)])}}t.childNodes&&0!=t.childNodes.length||(n.text=t.textContent,n.txtParts=this.parseTemplateParts(n.text));var d=t.childNodes;if(d)for(var h=d.length,s=0;h>s;s++){var u=d[s],_=this.parseNode(u,e);_&&n.children.push(_)}var p;if(n&&(p=n.dataAttrs["data-class-switch"])){n.useClass=!0,n.classSwitch=p;for(var v=0;v<n.children.length;v++){var m=n.children[v];if(m.dataAttrs){var g=m.dataAttrs["data-class"];g&&(n.classTemplates[g]=m)}}}return n},t.parseTemplateParts=function(t){var e={list:null,tokens:{},bHas:!1};if(!t||0==t.length)return null;for(var i=e.list=this.parseMustache(t),n=0;n<i.length;n++){var r=i[n];if(r.length>3&&"{"==r.charAt(0)&&"{"==r.charAt(1)){e.bHas=!0;var a=r.substring(2,r.length-2);e.tokens[n]=a}}return e}}(this)},o=function(t,e,i,n,r,a,s,c){if(!(this instanceof o))return new o(t,e,i,n,r,a,s,c);var f=[t,e,i,n,r,a,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=o._classInfo.name)return new l(t,e,i,n,r,a,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};o._classInfo={name:"templateCompiler"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("templateCompiler",o),o.prototype=new a,"undefined"!=typeof window&&(window.templateCompiler=o),"undefined"!=typeof window&&(window.templateCompiler_prototype=a);var s=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){{var r=n.attrName,a=n.binds,o=n.compiler;t[1]}console.log("ATTR CHANGE "),console.log("Binds ",a),console.log("DOM ATTR worker binds ",a);{a.list,a.tokens}o.composeTokensToTxt(a,e,function(t){console.log("Composed new attribute value for ",r),console.log(t),i.setAttribute(r,t)})}}}(this)},f=function(t,e,i,n,r,a,o,s){if(!(this instanceof f))return new f(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,c)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=f._classInfo.name)return new l(t,e,i,n,r,a,o,s)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};f._classInfo={name:"_domAttrWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_domAttrWorker",f),f.prototype=new s;var l=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var r=t[1],a=e.data[r];i.setAttributeNS(null,n,a)}}}(this)},d=function(t,e,i,n,r,a,o,s){if(!(this instanceof d))return new d(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=d._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};d._classInfo={name:"_svgAttrWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_svgAttrWorker",d),d.prototype=new l;var h=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var r,a=n.view,s=n.m,c=n.template,f=s.data[c.classSwitch];
if(f?(r=c.classTemplates[f],r||(r=c.classTemplates["default"])):r=c.classTemplates["default"],r&&r){var l=o();l._clearWorkers(a);var d=P(),h=a.dom.parentNode,u=l.composeTemplate(s,r,a);a.dom=u,h.replaceChild(u,n.dom);var _=d._createWorker(s.__id,c.classSwitch,y().fetch(5),u,{view:a,template:c,m:s,dom:u});a.workers.push(_)}}}}(this)},u=function(t,e,i,n,r,a,o,s){if(!(this instanceof u))return new u(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=u._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};u._classInfo={name:"_classWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_classWorker",u),u.prototype=new h;var _=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var r=(n.tpl,n.binds),a=n.model,s=n.name,c=i,f={};if(r)for(var l=r.list,d=r.tokens,h=0;h<l.length;h++){var u;if(u=d[h]){var _="";"undefined"!=typeof a.data[u]&&(_=a.data[u]||""),f[u]=_,n.value=_}}n.vars=f,o()._callCustom(s,c,n)}}}(this)},p=function(t,e,i,n,r,a,o,s){if(!(this instanceof p))return new p(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=p._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};p._classInfo={name:"_customDirWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_customDirWorker",p),p.prototype=new _;var v=function(){!function(t){t.run=function(t,e,i){if(t&&i){if(7==t[0]){var n=o();n.composeModelView(i.dom,e,i)}if(8==t[0]){var r=P(),e=r._find(t[2]),a=(r._find(t[4]),parseInt(t[2]),0),s=i.childViews.length;for(console.log("Should remove ",e);s>a;a++){var c=i.childViews[a];if(c.dataid==t[2]){console.log("Found the view to be removed"),console.log(c),r._removeView(c);break}}}if(12==t[0]){var f,r=P(),e=r._find(t[1]),l=(r._find(t[4]),parseInt(t[2])),d=parseInt(t[3]),h=i.dom,u=h.children[d];f=u.parentNode,f.removeChild(u);var _=h.children[l];f.insertBefore(u,_),console.log("Moving the item ",i),console.log("Old "+d+" new "+l);var p=i.childViews.splice(d,1);console.log("theV ",p,p[0]),i.childViews.splice(l,0,p[0])}}}}(this)},m=function(t,e,i,n,r,a,o,s){if(!(this instanceof m))return new m(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=m._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};m._classInfo={name:"_listViewWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_listViewWorker",m),m.prototype=new v;var g=function(){!function(t){var e;t.fetch=function(t){return e[t]},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=[null,r(),i(),f(),d(),u(),p(),m(),w(),C(),j(),O(),k(),S(),M()])})}(this)},y=function(t,e,i,n,r,a,o,s){if(!(this instanceof y))return new y(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=y._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};y._classInfo={name:"_workers"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_workers",y),y.prototype=new g;var b=function(){!function(t){t.run=function(t,e,i,n){if(t&&i&&4==t[0]){var r=n.tpl,a=n.model,o=i;a=P()._find(n.modelid);for(var s="",c=r.txtParts.list,f=r.txtParts.tokens,l=0;l<c.length;l++){var d;if(d=f[l]){var h="";"undefined"!=typeof a.data[d]&&(h=a.data[d]||""),s+=h}else s+=c[l]||""}o.cssText?o.cssText=s:o.textContent=s}}}(this)},w=function(t,e,i,n,r,a,o,s){if(!(this instanceof w))return new w(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=w._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};w._classInfo={name:"_rawTextWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_rawTextWorker",w),w.prototype=new b;var x=function(){!function(t){var e;t.run=function(t,i,n,r){if(t&&n&&4==t[0]){var a,o=r.compiler,s=t[1],c=t[2],f=n;a=P()._find(r.modelid);var l=o.compile(c),d=o.composeTemplate(a,l);o._clearWorkers(r.view),f.parentNode.replaceChild(d,f),e||(e=P());var h=o.getViewForElem(d),u=e._createWorker(a.__id,s,y().fetch(9),d,{modelid:a.__id,compiler:o,view:h});h.workers.push(u)}}}(this)},C=function(t,e,i,n,r,a,o,s){if(!(this instanceof C))return new C(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=C._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};C._classInfo={name:"_templateWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_templateWorker",C),C.prototype=new x;var I=function(){!function(t){t.run=function(t,e,i,n,r){if(t&&i){var a;a=r?r:n;var o,s=a.fn,c=a.callOpts,f=a.varName,l=a.dom;if(o=P()._find(a.modelid),l.parentNode){var d=s(o.data[f],{data:o,view:c.view,dom:l.parentNode});l.parentNode.replaceChild(d,l),a.dom=d}}}}(this)},j=function(t,e,i,n,r,a,o,s){if(!(this instanceof j))return new j(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=j._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};j._classInfo={name:"_abstractWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_abstractWorker",j),j.prototype=new I;var T=function(){!function(t){t.run=function(t,e,i){if(t&&i){var n=i;if(4==t[0]){var r=t[1],a=e.data[r];if(a){var o=n.getAttribute("data-entry-class");n.style.display="block",o&&$(n).addClass(o);var s=n.getAttribute("data-exit-class");s&&$(n).removeClass(s)}else{var o=n.getAttribute("data-entry-class");o&&$(n).removeClass(o);var s=n.getAttribute("data-exit-class");s?($(n).addClass(s),setTimeout(function(){n.style.display="none"},500)):n.style.display="none"}}}}}(this)},O=function(t,e,i,n,r,a,o,s){if(!(this instanceof O))return new O(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=O._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};O._classInfo={name:"_domIfWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_domIfWorker",O),O.prototype=new T;var A=function(){!function(t){t.run=function(t,e,i,n){if(t){if(4==t[0]){var r=n.editor,a=n.model;if(r._noUpdates);else{var o=P();o.isDoingRemote()||(console.log("Should update the ACE editor value directly here... "),r._noUpdates=!0,r.setValue(t[2],1),r._noUpdates=!1)}}if(13==t[0]){var r=n.editor,a=n.model;a=P()._find(n.modelid);var s=c().runToAce(t[2]);r._noUpdates=!0;var f=r.getSession(),l=f.getDocument();l.applyDeltas(s),r._noUpdates=!1}}}}(this)},k=function(t,e,i,n,r,a,o,s){if(!(this instanceof k))return new k(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=k._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};k._classInfo={name:"_aceEditorWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_aceEditorWorker",k),k.prototype=new A;var E=function(){!function(t){t.run=function(t,e,i,n){if(t&&4==t[0]){{var r=i,a=P();a._find(n.modelid)}console.log("******* if Then Worker ******"),console.log(n),n.thenCtrl&&(console.log("==>Calling ctr"),a._callController(n.thenCtrl,n.modelid,r))}}}(this)},S=function(t,e,i,n,r,a,o,s){if(!(this instanceof S))return new S(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=S._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};S._classInfo={name:"_ifThenWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_ifThenWorker",S),S.prototype=new E;var N=function(){!function(t){t.run=function(t,e,i,n,r){if(t){if(4==t[0]){console.log("--- set value --- ");var a=P(),o=R();o.createPropertyUpdateFn(t[1],null);var s=a._find(n.modelid);if(s.__undone)return;n&&n.eventObj&&t[3]!=t[2]&&n.eventObj.trigger(t[1],t[2])}if(r){n=r}if(5==t[0]){var a=P(),s=a._find(t[2]),c=a._find(t[4]);if(s.__undone)return;if(c.__undone)return;var f=R();if(f.findFromCache(t[4])){var o=R(t[4]),l=R(t[2]),d=t[1];if(!o)return;if(!l)return;o[d]=l}}if(8==t[0]){var a=P(),s=a._find(t[2]);if(s.__undone)return;n.bListenMVC&&n.eventObj&&n.eventObj.trigger("remove",s.__removedAt)}if(7==t[0]){var a=P(),h=a._find(t[4]),u=a._find(t[2]);if(h.__undone)return;if(u.__undone)return;var _=h.data.indexOf(u);n.bListenMVC&&n.eventObj&&n.eventObj.trigger("insert",_)}if(12==t[0]){var a=P(),h=a._find(t[4]),_=parseInt(t[2]),p=h.data.length;if(h.__undone)return;for(var v=0;p>v;v++){var m=h.data[v];if(m.__id==t[1]){i=m;break}}if(i&&i.__undone)return;console.log("Options for cmd 12 "),console.log(i);var g=i.__fromIndex;if(console.log(g),i){var y=parseInt(t[2]);n.bListenMVC&&n.eventObj&&n.eventObj.trigger("move",{from:g,to:y})}}}}}(this)},M=function(t,e,i,n,r,a,o,s){if(!(this instanceof M))return new M(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=M._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};M._classInfo={name:"_objectEventWorker"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_objectEventWorker",M),M.prototype=new N;var L=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this),function(t){var i,n,r,a,o;t.__dataTr=function(){},t._collectObject=function(t,e,i){this.isArray(e)||(e=e.split(","));var n={};e.forEach(function(e){n[e]=t[e](),t.on(e,function(){n[e]=t[e](),console.log(e+" = "+t[e]()+" from "+t.getID()),i(n)})}),i(n)},t._copyAs=function(t){var e=this,i=e._channelInfo;if(i){var n=this.toData();e._reGuidRawData(n);var r={ip:i.ip,port:i.port,sandbox:i.sandbox,path:i.path,file:t,createWith:n},a=R({},{channel:r});return a}},t._embedFileURL=function(t){var e=t||this._findURL(),i=this._parseURL(e),n=i.protocol+"://"+i.ip+":"+i.port+"/"+i.sandbox+"/"+i.path+"/"+this.getID()+".embed";return n},t._findActiveChannel=function(){if(this._activeChannel&&this._activeChannel)return this._activeChannel;var t=this.parent();return t?t._findActiveChannel():void 0},t._findRootDoc=function(){if(this._isRootDoc)return this;var t=this.parent();return t?t._findRootDoc():this},t._findURL=function(){for(var t=this;!t._docData.__radioURL;)t=t.parent();return t&&t._docData&&t._docData.__radioURL?t._docData.__radioURL:void 0},t._forMembers=function(t){var e=this;if(this.isArray())for(var i=0;i<this._data.length;i++){var n=this._data[i];this.isObject(n)&&n.__dataTr&&t(n)}else this._members.forEach(function(i){e[i]&&t(e[i])})},t._getCommandHistory=function(){return r._getCommandHistory(this._findURL())},t._initializeData=function(t,e){this._data=t.data,this._docData=t;var i=(r._createWorker(this._docData.__id,"*",y().fetch(14),null,{bListenMVC:!0,modelid:this._docData.__id,eventObj:this}),t.data);if(i instanceof Array)for(var n in i)this[n]=R(i[n]);else for(var n in i)if(i.hasOwnProperty(n)){var a=i[n];if(this.isFunction(a))continue;if(!this.isFunction(a)&&(a===Object(a)||a instanceof Array)){this[n]=new R(a,e);continue}this.isFunction(a)||this.isObject(a)||this.isArray(a)||this[n]||this.createPropertyUpdateFn(n,a)}},t._makeEmbeddable=function(){if(!this._docData.__p)return void console.error("ERROR: Can not make root document embeddable, it already is");if(this._docData.__rid)return void console.error("ERROR: The object is alrady remoted");var t=this._findURL(),e=R(this.serialize());e.then(function(){var i=e._metaFileURL(t),n=e._embedFileURL(t);console.log("Might be creting"),console.log("-",i),console.log("-",n);var r=R({});return void r.then(function(){console.log("The command list of this object "),console.log(r._docData.__ctxCmdList)})})},t._metaFileURL=function(t){var e=t||this._findURL(),i=this._parseURL(e),n=i.protocol+"://"+i.ip+":"+i.port+"/"+i.sandbox+"/"+i.path+"/"+this.getID()+".ln";return n},t._moveCmdListTo=function(t){if(this.__cmdList&&t){var e=t._findRootDoc();if(e){if(e.__cmdList||(e.__cmdList=[]),e.__ctxCmdList||(e.__ctxCmdList=[]),e==this)return;e.__cmdList.concat||(console.log("*cmdlist*"),console.log(JSON.stringify(e.__cmdList))),e.__cmdList=e.__cmdList.concat(this.__cmdList),this.__cmdList=[],e.__ctxCmdList=e.__ctxCmdList.concat(this.__ctxCmdList),this.__ctxCmdList=[]}}},t._parseURL=function(t){var e=t.split("://"),i=e.shift(),n=e.shift(),r=n.split("/"),a=r.shift(),o=a.split(":"),s=o[0],c=o[1],f=r.shift(),l=r.pop(),d=r.join("/");return{url:t,ip:s,port:c,sandbox:f,path:d,file:l,protocol:i}},t._reGuidRawData=function(t){if(console.log("_reGuidRawData"),this.isArray(t)){var e=this;t.forEach(function(t){e._reGuidRawData(t)})}else if(this.isObject(t))for(var i in t)t.hasOwnProperty(i)&&("__id"!=i?(this.isObject(t[i])&&this._reGuidRawData(t[i]),this.isArray(t[i])&&this._reGuidRawData(t[i])):(console.log("Changing the __id"),t[i]=this.guid()))},t._setAuthToken=function(t,e){n=t,i=e},t._setBroadcastManager=function(t){this.__bcManager=t},t.addController=function(t){this._controllers||(this._controllers=[]),this._controllers.indexOf(t)>=0||this._controllers.push(t)},t.askChannelQuestion=function(t,e,i){var n=this._findURL();console.log("Asking, the URL was "+n);var r=P(n);r.then(function(){console.log("Resolved the doc, asking the channel the question "+t),r._ask(t,e,i)})},t.at=function(t){var e=this._docData.data[t];return e?R(e):void 0},t.clear=function(){for(var t=this.length();t--;)this.pop()},t.clone=function(){return R(this.serialize())},t.copyToData=function(){var t=this.toData();return this._reGuidRawData(t),t},t.createArrayField=function(t,e){var i,n=this;return i=e._docData?e:R(e),n[t]?this:(i.then(function(){r.execCommand([5,t,i.getID(),null,n.getID()])}),n[t]=i,this)},t.createField=function(t,e){this.set(t,e||null)},t.createObjectField=function(t,i){var n,a=this;n=i._docData?i:R(i);var o=e();return a.hasOwn(t)?(o.resolve(!1),o):(n.then(function(){r.execCommand([5,t,n.getID(),null,a.getID()]).then(function(){o.resolve()})}),a[t]=n,o)},t.createPropertyUpdateFn=function(e,i){t[e]||(t[e]=function(t){if(this._docData){var i=this._docData.data;if(i){if("undefined"==typeof t)return i[e];if(i[e]!=t&&this._enterCtx(e))return r.execCommand([4,e,t,null,this._docData.__id]),this._leaveCtx(e),this}}},o[e]=!0)},t.dbDefineSync=function(t){if(t){var e=this;t.forEach(function(t){var i=e.dbFindSyncVar(t.name,!0);for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])})}},t.dbFindSyncVar=function(t,e){this.__dbSync||(this.__dbSync=[]);for(var i=0;i<this.__dbSync.length;i++){var n=this.__dbSync[i];if(n.name==t)return n}if(e){var n={name:t,dirty:!1};this.__dbSync.push(n),this.on(t,function(){n.dirty=!0})}return n},t.dbSync=function(){for(var t=0;t<this.__dbSync.length;t++){var e=this.__dbSync[t];e.dirty&&e.syncFn&&(e.promises||(e.promises=[]),console.log("The variable ",e),e.promises.push(e.syncFn()),e.dirty=!1)}},t.emitValue=function(t,e){if(this._processingEmit)return this;if(this._processingEmit=!0,this._controllers)for(var i=0,n=0;n<this._controllers.length;n++){var r=this._controllers[n];r[t]&&(r[t](e),i++)}this._valueFn&&this._valueFn[t]&&this._valueFn[t].forEach(function(t){t(e)}),this._parent&&this._parent.emitValue&&this._parent.emitValue(t,e),this._processingEmit=!1},t.extendWith=function(e){for(var i in e){var n=e[i];this.isFunction(n)&&(t[i]=n)}},t.find=function(t){console.log("*** find with "+t);var e=r._getObjectInPath(t,this._docData);return R(e.__id)},t.findRootDocup=function(){for(var t,e=this;t=e.parent();)e=t;return P(e._docData)},t.forEach=function(t){var i=e(),n=e(),r=[],a=this;return this._docData.data.forEach(function(t){t.__undone||r.push(R(t))}),i.all(r).then(function(){a._docData.data.forEach(function(e){if(!e.__undone){var i=R(e);t(i)}}),n.resolve(!0)}),i.resolve(!0),n},t.get=function(t){return this[t]?this.isFunction(this[t])?this[t]():this[t]:void 0},t.getID=function(){return this._docData.__id},t.getRemoteID=function(){return this._docData&&this._docData.__rid?this._docData.__rid:void 0},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.hasOwn=function(t){return"undefined"!=typeof this._docData.data[t]?!0:!1},t.indexOf=function(){return r.indexOf(this._docData)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(r=P({})),a||(a={},o={})}),t.insertAt=function(t,e){this.push(e);var i=this.at(this.length()-1);return r.moveItemToPos(i.getID(),t),this},t.isArray=function(t){return"undefined"==typeof t?this._docData&&this._docData.data?this.isArray(this._docData.data):!1:"[object Array]"===Object.prototype.toString.call(t)},t.isDataTrait=function(t){return t._docData?!0:void 0},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this._docData&&this._docData.data?this.isObject(this._docData.data):!1:t===Object(t)},t.item=function(t){var e=this._docData.data[t];return e?R(e):void 0},t.keys=function(t){for(var e in this._docData.data)t(e,this._docData.data[e],this._docData.data);return this},t.length=function(){return this._docData&&this._docData.data?this._docData.data.length:0},t.moveDown=function(){r.moveItemDown(this._docData.__id)},t.moveToIndex=function(t){r.moveItemToPos(this._docData.__id,t)},t.moveUp=function(){r.moveItemUp(this._docData.__id)},t.onValue=function(t,e){this._valueFn||(this._valueFn={}),this._valueFn[t]||(this._valueFn[t]=[]),this._valueFn[t].indexOf(e)<0&&this._valueFn[t].push(e)},t.parent=function(t){if("undefined"!=typeof t)return console.error("setting parent is not implemented"),this;if(this._docData){var t=this._docData.__p;return t?R(t):void 0}},t.pick=function(t){var e=F(),i=this;return this.then(function(){console.log("About to collect ",t),i._collectObject(i,t,function(t){console.log("Got "+t),e.pushValue(t)})}),e},t.pop=function(){var t=this.length();if(t){var e=this.at(t-1);return e.remove(),e}},t.push=function(t){var i=e();if(t.then){var n=this._docData;return t.then(function(){t=t._docData,r.push(n,t).then(function(){i.resolve(!0)})}),i}var a=this;return this.then(function(){r.push(a._docData,t).then(function(){i.resolve(!0)})}),i},t.pushRemote=function(t,e){if(this.isArray()){var i=this.guid();P().execCommand([16,t,e,i,this.getID()])}return this},t.remove=function(){return console.log("Removing cmd for ",this._docData.__id),r.removeItem(this._docData.__id),this},t.removeListener=function(t,e){if(this._events&&this._events[t]){var i=this._events[t].indexOf(e);i>=0&&this._events[t].splice(i,1),0==this._events[t].length&&delete this._events[t]}},t.restackOps=function(t){function e(t,e,i,n,r){return{dist:t,data:e,from:i,to:n,parent:r}}function i(t){return t.reduce(function(t,e,i){return t+Math.abs(i-e)},0)}function n(t){var n=t.slice(0);console.log("data:",n);for(var o=n.length,s=o,c=i(n),f=[e(c,t,0,0,null)];c>0&&s>0;){var l=[];f.forEach(function(t){c=t.dist;for(var n=t.data,r=0;o>r;r++)for(var s=0;o+1>s;s++){var f=n.slice(0),d=f.splice(r,1);r>s?f.splice(s,0,d[0]):f.splice(s-1,0,d[0]);var h=i(f);if(l.length<a||c>h){var u=e(h,f,r,s,t);l.push(u),l.length>a&&(l.sort(function(t,e){return t.dist-e.dist}),l=l.slice(0,l.length-1)),c=l.reduce(function(t,e){return Math.max(t,e.dist)},0)}}}),f=l,s--,c=l.reduce(function(t,e){return Math.min(t,e.dist)},1)}if(l){for(var d=l.filter(function(t){return 0==t.dist})[0],h=[d];null!=d.parent;)h.push(d.parent),d=d.parent;return h.reverse(),h.slice(1).forEach(function(t){r.push(t.to==t.parent.data.length?["b",t.parent.data[t.from],t.parent.data[t.to-1]]:["a",t.parent.data[t.from],t.parent.data[t.to]])}),n}}var r=[],a=5;return n(t),r},t.restackOps2=function(t){function e(t){for(var e=t.slice(0),n=t.slice(0),r=t.slice(0).sort(function(t,e){return t-e}),a={},o={},s=0;s<n.length;s++){var c=r.indexOf(n[s]);a[n[s]]=c,o[c]=n[s],e[s]=c}var f=e.slice(0).sort(function(t,e){return t-e}),l=e[0],d=e[0],h=[],u=0,_=function(){var t=0;for(len=e.length,df=0;len>t;t++){var i=e[t];i>d&&(d=i),l>i&&(l=i),t>0&&h.push(f[t]-f[t-1]),t>0&&(u+=Math.abs(f[t]-f[t-1])),df+=Math.abs(i-f[t])}return u/=len,df/len}();h.sort(function(t,e){return t-e});for(var p=(h[0],function(t){for(var i=function(i,n,r){var a=[],o=e.length;for(n||(n=0);o>i;i++){var s=e[i];if(s-r!=1){var c=i+n;0>c&&(c=0),c>=o&&(c=o-1),t(s,f[c],s,r,i,o)&&(e[i+1]&&e[i+1]<s&&e[i+1]>r||(a.push(s),r=s))}else a.push(s),r=s}return a},n=[],r=0;.1>r;){for(var a=-5;5>=a;a++)n.push(i(Math.floor(e.length*r),a,l-1));r+=.05}return n.sort(function(t,e){return e.length-t.length}),n[0]}),v=[p(function(t,e,i,n,r,a){return n>i?!1:r>0&&Math.abs(i-n)>h[r-1]?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(t-e)<=_&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n){return n>i?!1:Math.abs(i-n)<u?!0:Math.abs(t-e)<=u&&i>=n?!0:!1}),p(function(t,e,i,n){return i>n?!0:!1}),p(function(t,e,i,n){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:r>0&&Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:r>0&&Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n){if(n>i)return!1;if(n>=l){if(i>=n)return!0}else if(i==l)return!0;return!1})],m=[],g=0,s=0;s<v.length;s++){var y=v[s];y.length>g&&(m=y,g=y.length)}0==m.length&&(m=[f[Math.floor(f.length/2)]]);{var b=[],w=[];!function(){var t=l,i=m[0],n=m.length,r=e.indexOf(i),a=0,o=0;for(len=e.length;len>o;o++){var s=e[o];s>=t&&i>=s&&r>=o?(b.push(s),t=s):w.push(s),s==i&&(t=s,n-1>a?(a++,i=m[a],r=e.indexOf(i)):(i=d,r=len+1))}}()}w.sort(function(t,e){return t-e});!function(){for(var t=0,e=0,n=b[0],r=w.length;r>t;){var a=b[e],s=w[t];if("undefined"==typeof a){for(;r>t;)i.push(["b",o[s],o[n]]),n=s,t++,s=w[t];return}s>a?(n=a,e++):(i.push(["a",o[s],o[a]]),t++)}}();return e}var i=[];return e(t),i},t.serialize=function(t){var e,i=this._docData.data;e=this.isArray(this._data)?[]:{};for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];if("undefined"==typeof r)continue;if(t&&(this.isObject(r)||this.isArray(r)))continue;e[n]=this.isObject(r)?R(r).serialize():r}return e},t.set=function(t,i){if(this.isFulfilled())return r.execCommand([4,t,i,null,this._docData.__id]);var n=e(),a=this;return o[t]||this.isObject(i)||this.createPropertyUpdateFn(t,i),this.then(function(){r.execCommand([4,t,i,null,a._docData.__id]).then(function(){n.resolve(!0)})}),n},t.toData=function(){var t=JSON.stringify(this._docData),e=JSON.parse(t);return e.__ctxCmdList&&delete e.__ctxCmdList,e.__cmdList&&delete e.__cmdList,e},t.unset=function(t){return r.unset(this._docData.__id,t),this},t.updateData=function(t){var e=this;if(t instanceof Array){var i=!0,n={};if(this.forEach(function(t){t.id?n[t.id()]=t:i=!1}),t.forEach(function(t){t.id||(i=!1)}),i)for(var r=0;r<t.length;r++){var a=t[r],o=n[a.id];o?o.updateData(a):e.push(a)}else console.log("Was not able to update data ",t);if(!i){e.clear();for(var s in t){var c=t[s];e.push(!this.isFunction(c)&&(c===Object(c)||c instanceof Array)?c:c)}}}else for(var s in t)if(t.hasOwnProperty(s)){var c=t[s];if(!(this.isFunction(c)||c instanceof Array||c!==Object(c)||c.constructor===Object))continue;!this.isFunction(c)&&(c===Object(c)||c instanceof Array)?this[s]?this[s].updateData&&this[s].updateData(c):(this[s]=new R(c),this[s].parent(this),this._members.push(s),this.saveCommand("setMember",s,this[s]._guid,null)):e[s]?e[s](c):(e.createPropertyUpdateFn(s,c),this[s](c))}},t.validatorFor=function(t,e){this._validators||(this._validators={}),this._validators[t]=e}}(this),function(t){var e;t._enterCtx=function(t){e||(e={active:{}}),this.__lid||(this.__lid=this.guid());var i=this.__lid+t;return e.active[i]?!1:(e.active[i]=1,!0)},t._getCtx=function(){var t={},i=e.active;for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t},t._leaveCtx=function(t){var i=this.__lid+t;e.active[i]&&delete e.active[i]},t._resetCtx=function(){e.active={}},t._setCtx=function(t){e.active=t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this.__lid=this.guid(),e||(e={active:{}})})}(this),function(t){var e,i;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e=[]),i||(i=P())}),t.on=function(t,e){this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(e);var i=this;e._unbindEvent=function(){i.removeListener(t,e)}},t.removeListener=function(t,e){if(this._events&&this._events[t]){var i=this._events[t].indexOf(e);i>=0&&this._events[t].splice(i,1),0==this._events[t].length&&delete this._events[t]}},t.trigger=function(t,i){if(!(e.indexOf(t+this._guid)>=0)&&this._events&&this._events[t]){var n=this._events[t],r=this;e.push(t+this._guid);for(var a=n.length,o=0;a>o;o++)n[o](r,i);var s=e.indexOf(t+this._guid);e.splice(s,1)}}}(this),function(t){var e,i;t._askSnapshot=function(){var t=this.findRootDocup();t._askSnapshot(!0)},t._broadcastToCmdChannels=function(t){this._cmdChannels&&(console.log("Channels",this._cmdChannels),this._cmdChannels.forEach(function(e){e.broadcast(t)}))},t._clearCmdCache=function(){i={},e=[]},t._removeFromCache=function(t){return void console.error("_removeFromCache not implemented ")},t._sendToInListeners=function(){console.error("_sendToInListeners not implemented")},t.addToCache=function(t,e){i||(i={}),t&&(i[t]=e)},t.execCommands=function(){console.error("execCommands not implemented")},t.findFromCache=function(t){return i?i[t]:void 0},t.getObjectCache=function(){return i},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.isRecordingCommands=function(){console.error("isRecordingCommands not implemented")},t.saveCommand=function(){console.error("saveCommand not implemented")},t.setCommandRecOnOff=function(){console.error("setCommandRecOnOff not implemented")}}(this),function(t){var e,i,n;t._addFactoryProperty=function(t){i||(i=[]),i.push(t)},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){if(this.isObject(t)){if(t.data&&t.__id){var e=this.findFromCache(t.__id);if(e)return e}}else{var e=this.findFromCache(t);if(e)return e}if(i&&n)for(var r=0;r<i.length;r++){var a,o=i[r];if(t&&t.data?a=t.data[o]:t&&(a=t[o]),a&&(s=n[a]))return s}if(t&&t.__m){var a=t.__m,s=n[a];return s}}),t.callMe=function(t){alert(t)},t.createSubClass=function(t,e,i){var n=i,r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return console.log("NOT instance of..."),new r(t,e,i,n,a,o,s,c);console.log("is instance of..."),console.log(this.__traitInit);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=r._classInfo.name)return new l(t,e,i,n,a,o,s,c)}else if(l)return l}if(this.__traitInit){console.log("Calling the subclass trait init...");var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};return r._classInfo={name:this.guid()},n.prototype=R.prototype,r.prototype=new n,this.registerComponent(e,r),this._addFactoryProperty(t),r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){e||(e=P({}));var n,r,a=this;if(!t)return void a.resolve(!0);if(t&&t.__id&&e._find(t.__id))return a._initializeData(t),a.addToCache(t.__id,a),void a.resolve(!0);if(t&&t.__rid){e._find(t.__rid)}console.log("_doc up for data"),r=P(t,i),r.then(function(){n=r.getData(),console.log("**** just returned creating data for **** "),a._initializeData(n),a.addToCache(n.__id,a),a.resolve(!0)})}),t.registerComponent=function(t,e){n||(n={}),n[t]||(n[t]=e)}}(this)};L.prototype=e.prototype;var R=function(t,e,i,n,r,a,o,s){if(!(this instanceof R))return new R(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=R._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};R._classInfo={name:"_data"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_data",R),R.prototype=new L,"undefined"!=typeof window&&(window._data=R),"undefined"!=typeof window&&(window._data_prototype=L),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})
}(this)},l=function(t,e,i,n,r,a,o,s){if(!(this instanceof l))return new l(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,d=this;if(this.__factoryClass.forEach(function(t){f=t.apply(d,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=l._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};l._classInfo={name:"templatePackage"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("templatePackage",l),l.prototype=new f,"undefined"!=typeof window&&(window.templatePackage=l),"undefined"!=typeof window&&(window.templatePackage_prototype=f);var t=function(){var t=function(){!function(t){var e,i,n,r,a;t.add=function(t,e,n){if(e||n){var r;"[object Array]"===Object.prototype.toString.call(n)?r=n:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),i.push([e,t,r])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},r={},a=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<a.length;f++){var l=a[f];l()}for(var d in n)if(n.hasOwnProperty(d)){var h=n[d];h[0](h[1]),delete n[d]}for(var d in r)if(r.hasOwnProperty(d)){var h=r[d];h.nextTime<o&&(h.remove?h.nextTime>0?(h.fn(),delete r[d]):h.nextTime=o+h.step:(h.fn(),h.nextTime=o+h.step)),h.until&&h.until<o&&delete r[d]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){a.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=a.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),a.splice(e,1),!0):!1}}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("later",i),i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,r=0,a=[],o=new Array(n);return this.then(function(){var t=e();return 0==i.length&&t.resolve([]),i.forEach(function(e,i){e.then?(a.push(e),e.then(function(e){o[i]=e,r++,r==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var r;r=this.isArray(i)?i:[i];var a=r.length,o=!1,s=!1,c=0,f=[],l=n||{};return this.then(function(){var i=e();return r.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,l),(o&&!s||0==s&&a==c)&&(i.resolve(l),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onFulfill)try{var n=i._onFulfill(t);"undefined"!=typeof n?i.resolve(n):i.fulfill(t)}catch(r){i.reject(r)}else i.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),r=t.concat(e),a=i.apply(this,r);n.resolve(a)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e),!e&&this.isFunction(t)){var n=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){n.resolve(t)},function(t){n.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,e){this.plugin(t,function(){var t,i,n=Array.prototype.slice.call(arguments,0),r=0;n.length>=0&&(t=n[n.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(i=t,r=n.length-1));var a=wishes().pending();return this.then(function(){var t=wishes().pending(),o=Array.prototype.slice.call(arguments,0);console.log("Orig args",n),console.log("Then args",o);var s;0==n.length&&(s=o),0==o.length&&(s=n),s||(s=o.concat(n)),r=s.length,i&&r--,s[r]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void a.reject(e);if(i){var n=Array.prototype.slice.call(arguments),r=i.apply(this,n);a.resolve(r)}else{var n=Array.prototype.slice.call(arguments,1);a.resolve.apply(a,n)}},t.then(function(t){a.resolve(t)}),console.log("nodeStyle after concat",s);e.apply(this,s);return t},function(t){a.reject(t)}),a})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({name:i,promise:t[i]});var n=e.length,r=0,a=[],o={};return this.then(function(){var t=wishes().pending();return e.forEach(function(e){var i=e.promise,s=e.name;i.then?(a.push(i),i.then(function(e){o[s]=e,r++,r==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var e=this._childPromises.length;e--;){var i=this._childPromises.shift();if(i._onReject)try{i._onReject(t),i.reject(t)}catch(n){i.reject(n)}else i.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var r=new e(t,n),a=this;return 1==this._state&&i().asap(function(){a.fulfill(a.value())}),2==this._state&&ater().asap(function(){a.reject(a.rejectReason())}),this._childPromises.push(r),r},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,r,a,o,s,c){if(!(this instanceof e))return new e(t,i,n,r,a,o,s,c);var f=[t,i,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=e._classInfo.name)return new l(t,i,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_promise",e),e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var d=function(){var t=function(){var t=function(){!function(t){var e,i,n,r,a;t.add=function(t,e,n){if(e||n){var r;"[object Array]"===Object.prototype.toString.call(n)?r=n:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),i.push([e,t,r])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},r={},a=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<a.length;f++){var l=a[f];l()}for(var d in n)if(n.hasOwnProperty(d)){var h=n[d];h[0](h[1]),delete n[d]}for(var d in r)if(r.hasOwnProperty(d)){var h=r[d];h.nextTime<o&&(h.remove?h.nextTime>0?(h.fn(),delete r[d]):h.nextTime=o+h.step:(h.fn(),h.nextTime=o+h.step)),h.until&&h.until<o&&delete r[d]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){a.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=a.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),a.splice(e,1),!0):!1}}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("later",i),i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,r=0,a=[],o=new Array(n);return this.then(function(){var t=e();return i.forEach(function(e,i){e.then?(a.push(e),e.then(function(e){o[i]=e,r++,r==n&&t.resolve(o)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var r;r=this.isArray(i)?i:[i];var a=r.length,o=!1,s=!1,c=0,f=[],l=n||{};return this.then(function(){var i=e();return r.forEach(function(e){e.then?(f.push(e),e.then(function(e){c++,o=t(e,l),(o&&!s||0==s&&a==c)&&(i.resolve(l),s=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t,this._childPromises.forEach(function(e){if(e._onFulfill)try{var i=e._onFulfill(t);"undefined"!=typeof i?e.resolve(i):e.fulfill(t)}catch(n){e.reject(n)}else e.fulfill(t)}),this._childPromises=[],this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),r=t.concat(e),a=i.apply(this,r);n.resolve(a)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(e)&&(this._onReject=e)}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,i){this.plugin(t,function(){var t,n,r=Array.prototype.slice.call(arguments,0),a=0;r.length>=0&&(t=r[r.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(n=t,a=r.length-1)),console.log("nodeStyle",r);var o=e();return this.then(function(){var t=e(),s=Array.prototype.slice.call(arguments,0);console.log("Orig args",r),console.log("Then args",s);var c;0==r.length&&(c=s),0==s.length&&(c=r),c||(c=s.concat(r)),a=c.length,n&&a--,c[a]=function(e){if(e)return console.log("Got error ",e),t.reject(e),void o.reject(e);if(n){var i=Array.prototype.slice.call(arguments),r=n.apply(this,i);o.resolve(r)}else{var i=Array.prototype.slice.call(arguments,1);o.resolve.apply(o,i)}},t.then(function(t){o.resolve(t)}),console.log("nodeStyle after concat",c);i.apply(this,c);return t},function(t){o.reject(t)}),o})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(e,i){return t[e]=i,this},t.props=function(t){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push({name:n,promise:t[n]});var r=i.length,a=0,o=[],s={};return this.then(function(){var t=e();return i.forEach(function(e){var i=e.promise,n=e.name;i.then?(o.push(i),i.then(function(e){s[n]=e,a++,a==r&&t.resolve(s)},function(e){t.reject(e)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;this._childPromises.forEach(function(e){if(e._onReject)try{e._onReject(t),e.reject(t)}catch(i){e.reject(i)}else e.reject(t)}),this._childPromises=[],this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var e=this;t.onStateChange(function(){1==t._state&&e.resolve(t.value()),2==t._state&&e.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var i=!1;try{var e=this;t.then.call(t,function(t){i||(e.resolve(t),i=!0)},function(t){i||(e.reject(t),i=!0)})}catch(n){i||this.reject(n)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){var r=new e(t,n),a=this;return 1==this._state&&i().asap(function(){a.fulfill(a.value())}),2==this._state&&i().asap(function(){a.reject(a.rejectReason())}),this._childPromises.push(r),r},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(e){e(t)}),this._listeners=[])},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,r,a,o,s,c){if(!(this instanceof e))return new e(t,i,n,r,a,o,s,c);var f=[t,i,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=e._classInfo.name)return new l(t,i,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"_promise"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_promise",e),e.prototype=new t,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=t);var i=function(){!function(t){var e;t.createSocketServer=function(t){var i=t.ip+":"+t.port;if(e[i])return e[i];var n=a({url:"http://"+i+"/",ioOptions:{"reconnection delay":500,"reconnection limit":100,"max reconnection attempts":1/0}});return e[i]=n,n},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e={})})}(this)},n=function(t,e,i,r,a,o,s,c){if(!(this instanceof n))return new n(t,e,i,r,a,o,s,c);var f=[t,e,i,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=n._classInfo.name)return new l(t,e,i,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};n._classInfo={name:"_connectManager"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_connectManager",n),n.prototype=new i,"undefined"!=typeof window&&(window._connectManager=n),"undefined"!=typeof window&&(window._connectManager_prototype=i);var r=function(){!function(t){t.on=function(t,e){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,i){if(this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,e,i)}),this}}}(this),function(t){var e,i;t.createChannel=function(t,i){this._channels||(this._channels=[]),e||(e={});var n=t.sandbox+":"+t.path+":"+t.file;if(e[n])return e[n];var r=s(this,t,i);return e[n]=r,r},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){console.log("_connSocket with ",t),this._socket=io.connect(t.url,t.ioOptions),this._options=t,this._connInfo={cnt:0,isConnected:!1};var e=this,i=this._socket;i.on("disconnect",function(){e._connInfo.isConnected=!1,e.trigger("disconnect")}),i.on("connect",function(){e._connInfo.isConnected=!0,e.trigger("connect")})}),t.localCmdBroadcast=function(t){console.log("Remote commands"),console.log(t),i._setCmdRemoteUpdate(!0),i.execCommands(t),i._setCmdRemoteUpdate(!1)},t.remoteCmdBroadcast=function(){}}(this)},a=function(t,e,i,n,r,o,s,c){if(!(this instanceof a))return new a(t,e,i,n,r,o,s,c);var f=[t,e,i,n,r,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=a._classInfo.name)return new l(t,e,i,n,r,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};a._classInfo={name:"_connSocket"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_connSocket",a),a.prototype=new r,"undefined"!=typeof window&&(window._connSocket=a),"undefined"!=typeof window&&(window._connSocket_prototype=r);var o=function(){!function(t){t.on=function(t,e){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e),this},t.trigger=function(t,e,i){if(this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,e,i)}),this}}}(this),function(t){var e,i,n;t.addAnswerCallback=function(t,e,n){i||(i={}),i[t]={fn:e,cmd:n}},t.ask=function(t,e){t.__aid=this.genGUID(),e&&this.addAnswerCallback(t.__aid,function(n){e(n.answer),delete i[t.__aid]},t),console.log("Asking with "+t.__aid);var n=this.getSocket();n.emit("ask_"+this._channelId,t)},t.genGUID=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.getFileData=function(t){var e=this;e._tryCnt=0;var i,n=this.getSocket(),r=function(t){i=JSON.parse(t),n.removeListener("fileData_"+e._channelId,r)},a=function(r){var o=[];if(r.length>2)for(var s=r.split("\n"),c=s.length,f=0;c>f;f++){var l=s[f];!l||l.length<2||o.push(JSON.parse(l))}t(i,o),n.removeListener("changeData_"+e._channelId,a)};n.on("fileData_"+this._channelId,r),n.on("changeData_"+this._channelId,a),n.emit(this._channelId,{cmd:"getFile"})},t.getID=function(){return this._channelId},t.getSocket=function(){return this._socketObj._socket},t.getURL=function(){return this._url},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,r,a){var o=this,s=t._socket;this._socketObj=t,this._options=r,this._url=a,e||(e=P());var c=this.genGUID();this._options.responseId=c,o._tryCnt=0;var f=function(t){var c=t.channelId,f=t.namespace;n||(n={}),n[a]||(n[a]=f);var l=h();l.namespace(a,f),0==o._tryCnt&&(s.on("ctxupd_"+c,function(t){e._enterCtx(o._channelId)&&(t.forEach(function(t){e._setCtx(t.ctx),r.listeners.onCommand.forEach(function(e){e(t.cmd,t.ctx)}),e._resetCtx()}),e._leaveCtx(o._channelId))}),s.on("answer_"+c,function(t){if(i){var e=i[t.__aid];e&&e.fn(t)}})),o._channelId=c,o._isConnected=!0,o._tryCnt++,o.trigger("connect"),o.resolve(o._channelId)};s.on(c,f),s.connected?(console.log("Sending request for channel "),s.emit("requestChannel",o._options)):s.on("connect",function(){console.log("Sending request for channel "),s.emit("requestChannel",o._options)})})}(this)};o.prototype=e.prototype;var s=function(t,e,i,n,r,a,o,c){if(!(this instanceof s))return new s(t,e,i,n,r,a,o,c);var f=[t,e,i,n,r,a,o,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=s._classInfo.name)return new l(t,e,i,n,r,a,o,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"_connChannel"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_connChannel",s),s.prototype=new o,"undefined"!=typeof window&&(window._connChannel=s),"undefined"!=typeof window&&(window._connChannel_prototype=o),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i,r,a,o;t.ask=function(t,e,n,r){var a={cmd:e};r&&(a.data=r);var o=i[t];if(o){console.log("About to send question ",a);var o=o.channel;o&&o.ask(a,n)}},t.askPromise=function(t,e){var n=i[t];if(n){console.log("Creating ask promise");var r=_wish(),n=n.channel;return n&&n.ask(e,function(t){r.resolve(t)}),r}},t.command=function(t,n){var r={cmd:"cmd",data:n};return console.log("radio command called "),e(function(e,n){n("promise with : "+t);var a=i[t];a||n("no such channel : "+t);var a=a.channel;console.log("going to ask ",a),a&&a.ask(r,e)})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i={},r={},a={},o=P())}),t.listen=function(t,r){var a=this.parseRemoteUrl(t),o=a.channel;o.listeners={onCommand:[]},r.onCommand&&o.listeners.onCommand.push(r.onCommand);var s=n().createSocketServer({ip:o.ip,port:o.port});r&&this.isObject(r)&&r.createWith&&(o.createWith=r.createWith),r&&this.isObject(r)&&r.dataNS&&(o.dataNS=r.dataNS);var c=e(),f=s.createChannel(o,t),l={channel:f,createdTime:(new Date).getTime(),bConnected:!1,bFileLoaded:!1,createOptions:o,listenerOptions:[]};return i[t]=l,l.listenerOptions.push(r),f.then(function(){l.bConnected=!0,f.getFileData(function(t,e){console.log("*********** CHANNEL ID ",f.getID());var i=l.listenerOptions;l.initData=t,l.initChanges=e;for(var n=0;n<i.length;n++){var r=i[n];r.onFile&&r.onFile(t,e,f.getURL())}l.bFileLoaded=!0,c.resolve(!0)})}),c},t.namespace=function(t,e){return"undefined"!=typeof e?(a[t]=e,this):a[t]||""},t.parseRemoteUrl=function(t){console.log("Parsing ",t);var e=t.split("://"),i=(e.shift(),e.shift()),n=i.split("/"),r=n.shift(),a=r.split(":"),o=a[0],s=a[1],c=n.shift(),f=n.pop(),l=n.join("/"),d={channel:{ip:o,port:s,sandbox:c,path:l,file:f,auth:{u:"abba",p:"nowp"}}};return d},t.send=function(t,e){if(i&&i[t]){var n=i[t].channel;if(n){if(!o._enterCtx(n._channelId))return;var r=n.getSocket();r.emit("ctxupd_"+n._channelId,e),o._leaveCtx(n._channelId)}}},t.snapshot=function(t,e){if(e){var n=i[t];if(n){var r={cmd:"snapshot"};r.rawData=e;var n=n.channel;n&&n.ask(r)}}}}(this)},h=function(t,e,i,n,r,a,o,s){if(!(this instanceof h))return new h(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=h._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};h._classInfo={name:"docRadio"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("docRadio",h),h.prototype=new d,"undefined"!=typeof window&&(window.docRadio=h),"undefined"!=typeof window&&(window.docRadio_prototype=d);var u=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.sayHelloToSub=function(){alert("Sub says hi!")}}(this)};u.prototype=_data.prototype;var _=function(t,e,i,n,r,a,o,s){if(!(this instanceof _))return new _(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=_._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};_._classInfo={name:"DataSubClass"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("DataSubClass",_),_.prototype=new u,"undefined"!=typeof window&&(window.DataSubClass=_),"undefined"!=typeof window&&(window.DataSubClass_prototype=u);var p=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.sayHelloToSub=function(){alert("Second sub says hi!")}}(this)};p.prototype=_data.prototype;var v=function(t,e,i,n,r,a,o,s){if(!(this instanceof v))return new v(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=v._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};v._classInfo={name:"DataSubClass2"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("DataSubClass2",v),v.prototype=new p,"undefined"!=typeof window&&(window.DataSubClass2=v),"undefined"!=typeof window&&(window.DataSubClass2_prototype=p);var m=function(){!function(t){t.getElem=function(){return this._o},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._id=t,this._up=P(),this._o=D();var e=this;this._o.button().text("Step commands").on("click",function(){e._up._stepCommandList(t)});var i=this._o.div("commandHistory"),n=["","Create Object","Create Array","Init property","Set Value","Set Member","Push","Push Object","Remove","","Remove Property","Insert Object At","Move to Index","","","","Create Remote Object"],r=0;later().every(.1,function(){var t=e._up._getCommandHistory(e._id);for(e._up._getCommandPointer();t.length>r;){var a=i.div("cmdDiv"),o=a.table(),s=t[r],c=a.div(),f=D("button"),l=D();!function(t,e){f.text("Details").on("click",function(){e.clear();var i=e.ul();i.li().text(t.cmd[0]),i.li().text(t.cmd[1]),i.li().text(t.cmd[2]),i.li().text(t.cmd[3]),i.li().text(t.cmd[4]),i.li().text(t.cmd[5]),i.li().text(t.cmd[6])});var i=l.button().text("Run").on("click",function(){P().execCommand(t.cmd,!0),i.text("Done")})}(s,c),o.addRow(l,s.cmd[0],"=",n[s.cmd[0]],f),r++}})})}(this)},g=function(t,e,i,n,r,a,o,s){if(!(this instanceof g))return new g(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=g._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};g._classInfo={name:"channelDebug"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("channelDebug",g),g.prototype=new m,"undefined"!=typeof window&&(window.channelDebug=g),"undefined"!=typeof window&&(window.channelDebug_prototype=m);var y=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var e,i,n,r,a,o,s,c;t._createModelCommands=function(t,e,i){i||(i=[]);var n;if(n=t.data&&t.__id?t.data:t,this.isObject(n)||this.isArray(n)){var r;if(r=t.__id?t:{data:n,__id:this.guid()},this.isArray(n))var a=[2,r.__fork||r.__id,[],null,r.__fork||r.__id];else var a=[1,r.__fork||r.__id,{},null,r.__fork||r.__id];e&&(r.__p=e.__id),i.push(a);for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];if(this.isObject(s)||this.isArray(s)){var c=this._createModelCommands(s,r,i),a=[5,o,c.__fork||c.__id,null,r.__fork||r.__id];i.push(a)}else{var a=[4,o,s,null,r.__fork||r.__id];
i.push(a)}}return r}},t.addedObjects=function(){var t=[];for(var e in n)n.hasOwnProperty(e)&&(i[e]||(t.push(e),s[e]=n[e]));return t},t.commonObjects=function(){var t=[];for(var r in e)i[r]&&n[r]&&t.push(r);return t},t.compareFiles=function(t,r){i={},n={},e={},a={},o={},s={},c={},this.findObjects(t,i),this.findObjects(r,n);var f={missing:this.missingObjects(),added:this.addedObjects(),common:this.commonObjects(),cMod:[],cmds:[]},l=this;f.common.forEach(function(t){var e=l.objectDiff(i[t],n[t]);f.cMod.push(e)});var l=this;return f.added.forEach(function(t){var i=[],n=e[t];l._createModelCommands(n,null,i),i.forEach(function(t){f.cmds.push(t)})}),f.cMod.forEach(function(t){t.cmds.forEach(function(t){f.cmds.push(t)})}),f},t.findObjects=function(t,i){if(console.log("findObjects called with ",t),t&&t.__id&&(i[t.__fork||t.__id]=t,e[t.__fork||t.__id]=t,a[t.__id]=t),t.data){var n=t.data;for(var r in n)if(n.hasOwnProperty(r)){var o=n[r];this.isObject(o)&&(c[o.__fork||o.__id]=t.__fork||t.__id,this.findObjects(o,i))}}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(r=P(),a={})}),t.missingObjects=function(){var t=[];for(var e in i)i.hasOwnProperty(e)&&(n[e]||(o[e]=i[e],t.push(e)));return t},t.objectDiff=function(t,i){var n={modified:[],posMoved:[],sourcesAndTargets:[],cmds:[]};if(t.data&&i.data&&this.isObject(t.data)&&!this.isArray(t.data)){var r=t.data;for(var a in i.data)if(i.data.hasOwnProperty(a)){var f=r[a],l=t.__fork||t.__id;this.isObject(f)||this.isArray(f)||i.data[a]!=f&&(n.modified.push({id:l,prop:a,from:f,to:i.data[a]}),n.cmds.push([4,a,i.data[a],f,l]))}}if(this.isArray(t.data)){for(var d=t.data,h=i.data,u=[],_=[],p=d.length,v=h.length,m=0;p>m;m++){var g=d[m];if(this.isObject(g)){var y=g.__fork||g.__id;o[y]?n.cmds.push([8,0,y,0,c[y]]):u.push(y)}}for(var b={},w={},x={},m=0;v>m;m++){var g=h[m];if(this.isObject(g)){var y=g.__fork||g.__id;b[y]=m,w[m]=y,s[y]&&(u.push(y),n.cmds.push([7,0,y,0,c[y]])),_.push(y)}}var C=[],m=0;u.forEach(function(t){C.push(b[t]),x[t]=m,m++}),n.restackIndex=b,n.restackList=C,n.reverseIndex=w,n.restack=this.restackOps(C);var I=[],j=u.slice();n.restack.forEach(function(t){if("a"==t[0]){var i=w[t[1]],r=w[t[2]],a=(b[r],j.indexOf(i));j.splice(a,1);var o=j.indexOf(r);j.splice(o,0,i);{e[i]}n.cmds.push([12,i,o,0,c[i]])}else{var i=w[t[1]],r=w[t[2]],a=(b[r],j.indexOf(i));j.splice(a,1);var o=j.indexOf(r)+1;j.splice(o,0,i),n.cmds.push([12,i,o,0,c[i]])}}),n.stackCmds=I,n.sourceArrayWork=j,n.sourcesAndTargets.push([u,_])}return n},t.restackOps=function(t){function e(t){for(var e=t.slice(0),n=t.slice(0),r=t.slice(0).sort(function(t,e){return t-e}),a={},o={},s=0;s<n.length;s++){var c=r.indexOf(n[s]);a[n[s]]=c,o[c]=n[s],e[s]=c}var f=e.slice(0).sort(function(t,e){return t-e}),l=e[0],d=e[0],h=[],u=0,_=function(){var t=0;for(len=e.length,df=0;len>t;t++){var i=e[t];i>d&&(d=i),l>i&&(l=i),t>0&&h.push(f[t]-f[t-1]),t>0&&(u+=Math.abs(f[t]-f[t-1])),df+=Math.abs(i-f[t])}return u/=len,df/len}();h.sort(function(t,e){return t-e});for(var p=(h[0],function(t){for(var i=function(i,n,r){var a=[],o=e.length;for(n||(n=0);o>i;i++){var s=e[i];if(s-r!=1){var c=i+n;0>c&&(c=0),c>=o&&(c=o-1),t(s,f[c],s,r,i,o)&&(e[i+1]&&e[i+1]<s&&e[i+1]>r||(a.push(s),r=s))}else a.push(s),r=s}return a},n=[],r=0;.1>r;){for(var a=-5;5>=a;a++)n.push(i(Math.floor(e.length*r),a,l-1));r+=.05}return n.sort(function(t,e){return e.length-t.length}),n[0]}),v=[p(function(t,e,i,n,r,a){return n>i?!1:r>0&&Math.abs(i-n)>h[r-1]?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:Math.abs(t-e)<=_&&i>=n?!0:Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n){return n>i?!1:Math.abs(i-n)<u?!0:Math.abs(t-e)<=u&&i>=n?!0:!1}),p(function(t,e,i,n){return i>n?!0:!1}),p(function(t,e,i,n){return n>i?!1:Math.abs(i-n)>_?!1:Math.abs(t-e)<=_&&i>=n?!0:!1}),p(function(t,e,i,n,r,a){return n>i?!1:r>0&&Math.abs(i-n)>_?!1:Math.abs(t-e)<=_*(r/a)&&i>=n?!0:r>0&&Math.abs(n-i)<=_*(r/a)&&i>=n?!0:!1}),p(function(t,e,i,n){if(n>i)return!1;if(n>=l){if(i>=n)return!0}else if(i==l)return!0;return!1})],m=[],g=0,s=0;s<v.length;s++){var y=v[s];y.length>g&&(m=y,g=y.length)}0==m.length&&(m=[f[Math.floor(f.length/2)]]);{var b=[],w=[];!function(){var t=l,i=m[0],n=m.length,r=e.indexOf(i),a=0,o=0;for(len=e.length;len>o;o++){var s=e[o];s>=t&&i>=s&&r>=o?(b.push(s),t=s):w.push(s),s==i&&(t=s,n-1>a?(a++,i=m[a],r=e.indexOf(i)):(i=d,r=len+1))}}()}w.sort(function(t,e){return t-e});!function(){for(var t=0,e=0,n=b[0],r=w.length;r>t;){var a=b[e],s=w[t];if("undefined"==typeof a){for(;r>t;)i.push(["b",o[s],o[n]]),n=s,t++,s=w[t];return}s>a?(n=a,e++):(i.push(["a",o[s],o[a]]),t++)}}();return e}var i=[];return e(t),i}}(this)},b=function(t,e,i,n,r,a,o,s){if(!(this instanceof b))return new b(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=b._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};b._classInfo={name:"diffEngine"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("diffEngine",b),b.prototype=new y,"undefined"!=typeof window&&(window.diffEngine=b),"undefined"!=typeof window&&(window.diffEngine_prototype=y);var w=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i;t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,e){return t===!1&&e?void 0:(i||(i={}),i[t]?i[t]:void(i[t]=this))}),t.addCommands=function(t,e){if(this.isArray(t)){var i=this;return t.forEach(function(t){i.addCommands(t)}),this}this._commands.push({fnCmd:t,fnFail:e,async:!0})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._commands||(this._commands=[],this.waitingList=[],this._index=0);var i=this;e||later().every(1/30,function(){i.step()})}),t.step=function(){var t=this._index,i=this._commands.length;if(t!=i){for(var n=e(),r=n,a=e(),o=this;i>t;){var s=this._commands[t];!function(t){r=r.then(function(){var i=e();return t.fnCmd(function(){i.resolve(!0)},function(e){i.resolve(!0),t.fnFail&&t.fnFail(e)}),i}).fail(function(e){t.fnFail&&t.fnFail(e)})}(s),this._index++,t++}return r.then(function(){if(o.waitingList.shift(),a.resolve(!0),o.waitingList.length){var t=o.waitingList[0];t.resolve(!0)}}).fail(function(){}),this.waitingList.push(n),1==this.waitingList.length&&n.resolve(!0),a}}}(this)},C=function(t,e,i,n,r,a,o,s){if(!(this instanceof C))return new C(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=C._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};C._classInfo={name:"sequenceStepper"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("sequenceStepper",C),C.prototype=new w,"undefined"!=typeof window&&(window.sequenceStepper=C),"undefined"!=typeof window&&(window.sequenceStepper_prototype=w);var I=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.addEvent=function(t,e,i,n){if(this._workers&&this._workers[t]){var r=this._workers[t][e],a=this,o=(new Date).getTime();r.forEach(function(){a._calls.push({objId:t,msgId:e,options:options,callData:n,responseId:n,time:o})})}},t.call=function(t){this.callCommand(t.id,t.msg,t.data)},t.callCommand=function(t,e,i){if(this._workers&&this._workers[t]){var n=this._workers[t][e],r=this,a=(new Date).getTime();n.forEach(function(){r._calls.push({objId:t,msgId:e,options:options,callData:i,time:a})})}},t.createWorker=function(t,e,i){var n=this._workers[t];n||(n=this._workers[t]={});var r=n[e];r||(r=n[e]=[]),i&&this.isObject(i)&&i.workerFn&&r.push(i)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._workers||(this._workers={},this._calls=[])}),t.processCallList=function(){var t=new C("engine");me._calls.forEach(function(e){t.addCommands(function(){e.options.workerFn(e.callData,function(t){e.options.responseFn&&e.options.responseFn(t)},e)})})}}(this)},j=function(t,e,i,n,r,a,o,s){if(!(this instanceof j))return new j(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=j._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};j._classInfo={name:"commandEngine"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("commandEngine",j),j.prototype=new I,"undefined"!=typeof window&&(window.commandEngine=j),"undefined"!=typeof window&&(window.commandEngine_prototype=I);var T=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},O=function(t,e,i,n,r,a,o,s){if(!(this instanceof O))return new O(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=O._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};O._classInfo={name:"messageStorage"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("messageStorage",O),O.prototype=new T,"undefined"!=typeof window&&(window.messageStorage=O),"undefined"!=typeof window&&(window.messageStorage_prototype=T);var A=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var e;t.addCommand=function(t,i){e||(e={}),e[t]=i},t.createCommands=function(){e||(e={})},t.getCommand=function(t){return e?e[t]:null},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},k=function(t,e,i,n,r,a,o,s){if(!(this instanceof k))return new k(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=k._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};k._classInfo={name:"commandStorage"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("commandStorage",k),k.prototype=new A,"undefined"!=typeof window&&(window.commandStorage=k),"undefined"!=typeof window&&(window.commandStorage_prototype=A);var E=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.ask=function(){return e(function(t){setTimeout(function(){t({msg:"Hello "})},1e3)})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},S=function(t,e,i,n,r,a,o,s){if(!(this instanceof S))return new S(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=S._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};S._classInfo={name:"conversation"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("conversation",S),S.prototype=new E,"undefined"!=typeof window&&(window.conversation=S),"undefined"!=typeof window&&(window.conversation_prototype=E);var N=function(){!function(t){t.addController=function(t){this._controllers||(this._controllers=[]),this._controllers.indexOf(t)>=0||this._controllers.push(t)},t.clone=function(){return _data(this.serialize())},t.emitValue=function(t,e){if(this._processingEmit)return this;if(this._processingEmit=!0,this._controllers){for(var i=0,n=0;n<this._controllers.length;n++){var r=this._controllers[n];r[t]&&(r[t](e),i++)}if(this._processingEmit=!1,i>0)return this}this._valueFn&&this._valueFn[t]?this._valueFn[t](e):this._parent&&this._parent.emitValue&&this._parent.emitValue(t,e),this._processingEmit=!1},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var i,n,r,o,s,f,l,d,h,u,_,p,v,m,g,y,b,w,x,C,I;t._addChannelFork=function(t,e){b[t]||(b[t]=[]),b[t].push(e)},t._addCommandChannel=function(t){return this._cmdChannels||(this._cmdChannels=[]),this._cmdChannels.indexOf(t)>=0?this:void this._cmdChannels.push(t)},t._addHotDoc=function(t){var e=u[t._guid];e?e.ms=(new Date).getTime():u[t._guid]={doc:t,ms:(new Date).getTime()}},t._addReflection=function(t,e){return t&&e&&t!=e?(g||(g={}),g[t]||(g[t]=[]),g[t].indexOf(e)<0&&g[t].push(e),this):this},t._ask=function(t,e,i){var n=this._data,r=n.__radio,a=n.__radioURL;e||(e={}),r.ask(a,t,i,e)},t._askSnapshot=function(){var t=this._data,e=t.__radio,i=t.__radioURL,t=this._transformObjFromNs(t);e.snapshot(i,t)},t._broadcastToCmdChannels=function(t){this._cmdChannels&&this._cmdChannels.forEach(function(e){e.broadcast(t)})},t._clearCmdCache=function(){n={},i=[]},t._createHotObject=function(t){var e=h.index[t._guid],i=this;return e?e.t=i._getCmdTime():(e={t:i._getCmdTime(),id:t._guid,o:t},t._hotBuffer=[],h.index[t._guid]=e,h.list.push(e)),e},t._debugMode=function(t){return"undefined"==typeof t?v.debugmode:(v.debugmode=t,this)},t._execCommandsPromise=function(t,i,n,r,a){for(var o=e(),s=e(),c=this,f=function(t,e){return t.then(function(){return i?c._realExecCmd(e,i,n,r,a):c.execCommand(e,i,n,r,a)})},l=t.length,d=o,h=0;l>h;h++)d=f(d,t[h]);return d.then(function(){s.resolve(!0)}),o.resolve(!0),s},t._findParentWithUrl=function(t){if(!t)return t;if(!t.__p)return t;if(t.__radioURL)return t;for(var e,i=t.__p,n=this._find(i);n;){if(n.__radioURL)return n;e=n,i=n.__p,n=this._find(i)}return e},t._findReflections=function(t){return g?g[t]:void 0},t._findRootDoc=function(t){if(!t.__p)return t;if(t.__virtual)return t;var e=t.__p,i=this._find(e);return i?this._findRootDoc(i):t},t._getCmdTime=function(){return h.time},t._getExecInfo=function(){return v},t._getNsFromUrl=function(t){return I[t]?I[t]:(x[C]=t,I[t]=C++,I[t])},t._getNsShorthand=function(t){return I[t]?I[t]:(x[C]=t,I[t]=C++,I[t])},t._getReflections=function(){return g},t._getReflectionsFor=function(t){if(g){var e=g[t];if(e)return e}return[]},t._getReverseNs=function(t){return x[t]},t._idFromNs=function(t){if(t){var e=t.length;"#"==t[e-1]&&(t=t.split("@").shift())}return t},t._idToNs=function(t,e){if(t){var i=t.length;if("#"==t[i-1]){var n=t.indexOf("@"),r=t.substring(n+1,i-1);r!=e&&(t=t.substring(0,n)+"@"+e+"#")}else t=t+"@"+e+"#"}return t},t._localExecCmd=function(t,i,n,r,a){var o=this,s=e();if(this.isArray(t[0]))return console.error("Array of promises NOT implemented.... "),s.resolve(!0),s;var f="local::"+t[0]+"::"+t[4];if(!o._enterCtx(f,!0))return s.resolve(!0),s;var d=(this._getExecInfo(),t.slice());if(!n){var h=this._find(t[4]);r=this._findParentWithUrl(h)}try{if(88==t[0]&&(this._pushChannelCommand(r.__radioURL,d.slice(),f,!1,r.__radio),s.resolve(!0)),1==t[0]){var u={data:{},__id:t[1]},_=this._getObjectHash();_[u.__id]=u,this.writeCommand(t),s.resolve(!0)}if(2==t[0]){var u={data:[],__id:t[1]},_=this._getObjectHash();_[u.__id]=u,this.writeCommand(t),s.resolve(!0)}if(3==t[0]&&s.resolve(!0),4==t[0]){var g=this._find(t[4]),y=t[1];if(g){if(!n&&g.__rid)return t[4]=g.__rid,o._leaveCtx(f),o._localExecCmd(t,i).then(function(){s.resolve(!0)}),s;if(t[3]||(t[3]=g.data[y],d[3]=g.data[y]),v.oldValue=g.data[y],g.data[y]=t[2],this._cmd(t,g,null),n||i||this._pushChannelCommand(r.__radioURL,d.slice(),f,!1,r.__radio),p){var b=g.__id+"::"+y,w=p[b];w&&w.forEach(function(e){e(g,t[2])})}if(!n)return o._leaveCtx(f),o._sendCmdToRefs(d,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(13==t[0]){var g=this._find(t[4]),y=t[1];if(!n&&g.__rid)return t[4]=g.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;var x=c();g.data[y]=x.runToString(g.data[y],t[2]),m=i||l;var C=[4,y,g.data[y],null,t[4]];if(this._cmd(C,g,null),(i||l)&&this._cmd(t,g,null),m=!1,n||i||this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio),p){var b=g.__id+"::"+y,w=p[b];w&&w.forEach(function(t){t(g,g.data[y])})}if(!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(5==t[0]){var g=this._find(t[4]),y=t[1],I=this._find(t[2]);if(!g||!I)return o._leaveCtx(f),void s.resolve(!0);var j=g;if(!n&&j.__rid&&j.__rid!=t[4]){var T=t.slice();return T[4]=j.__rid,o._leaveCtx(f),o.execCommand(T,i).then(function(){s.resolve(!0)}),s}if(I=this._transformToNsBeforeInsert(I,g),g.data[y]=I,I.__p=g.__id,this._cmd(t,g,I),n||i||(this._pushCmdListToChannel(I,r,f),this._pushChannelCommand(r.__radioURL,t,f,!1,r.__radio)),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(10==t[0]){var g=this._find(t[4]),y=t[1];if(console.log("*** unsetting property ****",y),!g||!y)return o._leaveCtx(f),void s.resolve(!0);var j=g;if(!n&&g.__rid)return t[4]=g.__rid,o._leaveCtx(f),o._localExecCmd(t,i).then(function(){s.resolve(!0)}),s;if(delete g.data[y],I&&(I.__oldp=j.__id,I.__p=null),this._cmd(t,g,I),n||i||this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(7==t[0]){var j=this._find(t[4]),O=this._find(t[2]),y="*",A=j.data.length;if(j&&O){if(!n&&j.__rid&&j.__rid!=t[4])return t[4]=j.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(O=this._transformToNsBeforeInsert(O,j),j.data.push(O),O.__p=j.__id,this._cmd(t,j,O),n||i||(this._pushCmdListToChannel(O,r,f),this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio)),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(8==t[0]){var j=this._find(t[4]),k=this._find(t[2]),y="*",A=j.data.indexOf(k);if(j&&k){var E=(j.__rid&&k.__rid,!0);if(k.__vpid&&k.__vpid!=k.__pid&&(E=!1),!n){if(E&&k.__rid&&j.__rid)return t[4]=j.__rid,t[2]=k.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(!E&&k.__rid&&j.__rid&&k.__vcid!=k.__id)return t[4]=k.__vpid,t[2]=k.__vcid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s}if(j.data.splice(A,1),k.__removedAt=A,this._cmd(d.slice(),j,k),n||i||this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio),k.__p=null,!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(12==t[0]){var S,g=this._find(t[4]),y="*",N=g.data.length,M=0;for(M=0;N>M;M++){var F=g.data[M];if(F.__id==t[1]){S=F;break}}if(S){var L=parseInt(t[2]),D=this._find(t[1]),R=g.__rid&&D.__rid;if(!n&&R&&g.__rid!=g.__id)return D.__vpid&&D.__vpid!=t[4]?(t[4]=D.__vpid,t[1]=D.__vcid):(t[4]=g.__rid,t[1]=D.__rid),o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(g.__fromIndex=M,S.__fromIndex=M,g.data.splice(M,1),g.data.splice(L,0,S),this._cmd(d,g,S),n||i||this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(16==t[0]){console.log("%c COMMAND 16 ","background: #222; color: #bada55"),console.log(t);var V=this._find(t[4]),q=t[1],H=t[2],B=t[3],U=t[4];if(V&&V.data){if(!n&&V.__rid)return t[4]=V.__rid,o._leaveCtx(f),console.log(JSON.stringify(t)),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;n||i||this._pushChannelCommand(r.__radioURL,d,f,!1,r.__radio),console.log(" - - - about to insert remote object into array - - - ");var W=this._find(H),z=this._find(B);console.log("Checking if the objects are already here..."),console.log("Remote object ",W),console.log("Local object ",z);var G=_data();console.log("Data find from cache, local ",G.findFromCache(B));var u,J={data:{},__rid:H,__id:B,__undone:!0};o._waitingPromises||(o._waitingPromises=[]),o._waitingPromises.push(s),V.data.push(J),J.__radioURL=q,console.log("--- calling change to remote ---- ");var Q=P()._changeToRemote(J,q,H);Q.then(function(e){delete J.__undone,console.log("The raw data for the object was "),console.log(JSON.parse(JSON.stringify(J)));o._find(B);J.__p=U;o._find(H);J.__p=U,n&&a?(J.__vpid=a.__vpid,J.__vcid=a.__vcid):(J.__vpid=U,J.__vcid=B),o._addReflection(J.__vcid,J.__id),u=_data(J),u.then(function(){console.log("Did load remote object... the object is "),console.log(u),o._cmd([7,V.data.length,B,null,U],V,u),n?s.resolve(e):o._sendCmdToRefs(t,i).then(function(){s.resolve(e)})})}),i||l||console.log("Writing the command .... "),o._leaveCtx(f)}else s.resolve(!0)}}catch($){console.error($.message),o._leaveCtx(f),s.resolve($.message)}return o._leaveCtx(f),s},t._moveCmdListToParent=function(t){if(t.__ctxCmdList){var e=this._findRootDoc(t);if(e==t)return;e&&(e.__ctxCmdList||(e.__ctxCmdList=[]),e.__ctxCmdList=e.__ctxCmdList.concat(t.__ctxCmdList),delete t.__ctxCmdList)}},t._nsFromId=function(t){var e;if(t){t+="";var i=t.length;"#"==t[i-1]&&(e=t.split("@").pop(),e=e.split("#").shift())}return e},t._pushCmdListToChannel=function(t,e){var i;this.isObject(t)&&t.__ctxCmdList?(i=t.__ctxCmdList,delete t.__ctxCmdList):i=t;var n=this;i.forEach(function(t){n._pushChannelCommand(e.__radioURL,t.cmd,t.ctx,!1,e.__radio)})},t._realExecCmd=function(t,i,n,r,a){var o=this,s=e();if(this.isArray(t[0]))return this._execCommandsPromise(t,i).then(function(){s.resolve(!0)}),s;var f="realExec::"+t[0]+"::"+t[4];if(!o._enterCtx(f))return s.resolve(!0),s;var d=(this._getExecInfo(),t.slice());try{if(88==t[0]&&s.resolve(!0),1==t[0]){var h={data:{},__id:t[1]},u=this._getObjectHash();u[h.__id]=h,s.resolve(!0)}if(2==t[0]){var h={data:[],__id:t[1]},u=this._getObjectHash();u[h.__id]=h,s.resolve(!0)}if(3==t[0]&&s.resolve(!0),4==t[0]){var _=this._find(t[4]),g=t[1];if(_){if(!n&&_.__rid)return t[4]=_.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(v.oldValue=_.data[g],_.data[g]=t[2],this._cmd(t,_,null),p){var y=_.__id+"::"+g,b=p[y];b&&b.forEach(function(e){e(_,t[2])})}if(!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(13==t[0]){var _=this._find(t[4]),g=t[1];if(!n&&_.__rid)return t[4]=_.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;var w=c();_.data[g]=w.runToString(_.data[g],t[2]),m=i||l;var x=[4,g,_.data[g],null,t[4]];if(this._cmd(x,_,null),(i||l)&&this._cmd(t,_,null),m=!1,p){var y=_.__id+"::"+g,b=p[y];b&&b.forEach(function(t){t(_,_.data[g])})}if(!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(5==t[0]){var _=this._find(t[4]),g=t[1],C=this._find(t[2]);if(!_)return;if(!C)return;var I=_;if(!n&&I.__rid&&I.__rid!=t[4]){var j=t.slice();return j[4]=I.__rid,o._leaveCtx(f),o.execCommand(j,i).then(function(){s.resolve(!0)}),s}if(_.data[g]=C,C.__p=_.__id,this._cmd(t,_,C),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(10==t[0]){var _=this._find(t[4]),g=t[1];if(!_)return;if(!g)return;if(!n&&_.__rid)return t[4]=_.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(delete _.data[g],!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}if(7==t[0]){var I=this._find(t[4]),T=this._find(t[2]),g="*",O=I.data.length;if(I&&T){if(!n&&I.__rid)return t[4]=I.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(I.data.push(T),T.__p=I.__id,this._cmd(t,I,T),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(8==t[0]){var I=this._find(t[4]),A=this._find(t[2]),g="*",O=I.data.indexOf(A);if(I&&A){var k=(I.__rid&&A.__rid,!0);if(A.__vpid&&A.__vpid!=A.__pid&&(k=!1),!n){if(k&&A.__rid&&I.__rid)return t[4]=I.__rid,t[2]=A.__rid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(!k&&A.__rid&&I.__rid&&A.__vcid!=A.__id)return t[4]=A.__vpid,t[2]=A.__vcid,o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s}if(I.data.splice(O,1),A.__removedAt=O,this._cmd(d,I,A),A.__p=null,!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else console.error("Could not find the removed object"),s.resolve(!0)}if(12==t[0]){var E,_=this._find(t[4]),g="*",S=_.data.length,N=0;for(N=0;S>N;N++){var M=_.data[N];if(M.__id==t[1]){E=M;break}}if(E){var F=parseInt(t[2]),L=this._find(t[1]),D=_.__rid&&L.__rid;if(!n&&D)return L.__vpid?(t[4]=L.__vpid,t[1]=L.__vcid):(t[4]=_.__rid,t[1]=L.__rid),o._leaveCtx(f),o.execCommand(t,i).then(function(){s.resolve(!0)}),s;if(v.fromIndex=N,_.__fromIndex=N,E.__fromIndex=N,_.data.splice(N,1),_.data.splice(F,0,E),this._cmd(d,_,E,{fromIndex:N}),!n)return o._leaveCtx(f),o._sendCmdToRefs(t,i).then(function(){s.resolve(!0)}),s;s.resolve(!0)}else s.resolve(!0)}if(16==t[0]){var R=this._find(t[4]),V=t[1],q=t[2],H=t[3],B=t[4];if(R&&R.data){console.log(" - - - about to insert remote object into array - - - ");var U=this._find(q),W=this._find(H);console.log("Checking if the objects are already here..."),console.log("Remote object ",U),console.log("Local object ",W);var h,z={data:{},__rid:q,__id:H,__undone:!0};o._waitingPromises||(o._waitingPromises=[]),o._waitingPromises.push(s),R.data.push(z),z.__radioURL=V;var G=P()._changeToRemote(z,V,q);G.then(function(e){delete z.__undone;o._find(H);z.__p=B;o._find(q);z.__p=B,n&&a?(z.__vpid=a.__vpid,z.__vcid=a.__vcid):(z.__vpid=B,z.__vcid=H),o._addReflection(z.__vcid,z.__id),console.log("The data before _data()"),console.log(JSON.parse(JSON.stringify(z))),h=_data(z),h.then(function(){o._cmd([7,R.data.length,H,null,B],R,h),n?s.resolve(e):o._sendCmdToRefs(t,i).then(function(){s.resolve(e)})})}),i||l||console.log("Writing the command .... "),o._leaveCtx(f)}}}catch(J){console.error(J.message),o._leaveCtx(f),s.resolve(J.message)}return o._leaveCtx(f),s},t._removeFromCache=function(t){if(t)if(this.isObject(t)){var e=t._guid;e&&(console.log("*** removing "+e),delete n[e])}else t&&(console.log("*** removing "+t),delete n[t]);else{this._forMembers(function(t){t&&t._removeFromCache()}),this._removeFromCache(this)}},t._sendCmdToRefs=function(t,i){var n=this,r=e(),a=!1;if(4==t[0]&&g){var o=g[t[4]];if(o&&o.length){v.reflection=!0,a=!0;var s=[];o.forEach(function(e){t[4]=e,s.push(t.slice())}),n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}}if(13==t[0]&&g){var o=g[t[4]];if(o&&o.length){v.reflection=!0,a=!0;var s=[];o.forEach(function(e){t[4]=e,console.log(JSON.stringify(t)),s.push(t.slice())}),n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}}if(7==t[0]&&g){var o=g[t[4]],c=t[2];if(o&&o.length){v.reflection=!0,a=!0;var s=[],f=[];if(o.forEach(function(e){var i=n._find(c),r=t.slice();r[4]=e;var a=n._createReflection(i);a.then(function(t){r[2]=t.__id,console.log(r),s.push(r)}),f.push(a)}),f.length){var l=e();l.all(f).then(function(){n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}),l.resolve(!0)}else r.resolve(!0)}}if((5==t[0]||10==t[0])&&g){var o=g[t[4]],c=t[2];if(o&&o.length){v.reflection=!0,a=!0;var s=[],f=[];if(o.forEach(function(e){var i=n._find(c),r=t.slice();r[4]=e;var a=n._createReflection(i);a.then(function(t){r[2]=t.__id,console.log(r),s.push(r)}),f.push(a)}),f.length){var l=e();l.all(f).then(function(){n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}),l.resolve(!0)}else r.resolve(!0)}}if(16==t[0]&&g){var o=g[t[4]];if(o&&o.length){v.reflection=!0;var d={__vcid:t[3],__vpid:t[4]};a=!0;var s=[];o.forEach(function(e){t[4]=e,t[3]=n.guid(),console.log(JSON.stringify(t)),s.push(t.slice())}),n._execCommandsPromise(s,i,!0,null,d).then(function(){v.reflection=!1,r.resolve(!0)})}}if(8==t[0]&&g){var o=g[t[2]];if(o&&o.length){v.reflection=!0,a=!0;var s=[];o.forEach(function(e){t[2]=e;var i=n._find(e);i&&i.__p&&(t[4]=i.__p,s.push(t.slice()))}),n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}}if(12==t[0]&&g){var o=g[t[1]];if(o&&o.length){v.reflection=!0,a=!0;var s=[];o.forEach(function(e){t[1]=e;var i=n._find(e);i&&i.__p&&(t[4]=i.__p,s.push(t.slice()))}),n._execCommandsPromise(s,i,!0).then(function(){v.reflection=!1,r.resolve(!0)})}}return a||r.resolve(!0),r},t._sendToInListeners=function(t){_&&_.forEach(function(e){e(t)
})},t._setCmdRemoteUpdate=function(t){l=t},t._transformCmdFromNs=function(t,e){var i=w,n=t.slice(),r=i[t[0]],a=this;return r&&r.forEach(function(t){n[t]=a._idFromNs(n[t],e)}),n},t._transformCmdToNs=function(t,e){var i=w,n=t.slice(),r=i[t[0]],a=this;return r&&r.forEach(function(t){n[t]=a._idToNs(n[t],e)}),n},t._transformObjFromNs=function(t,e){if(t&&t.__id){t.__id=this._idFromNs(t.__id,e);for(var i in t.data)t.data.hasOwnProperty(i)&&this.isObject(t.data[i])&&this._transformObjFromNs(t.data[i],e)}return t},t._transformObjToNs=function(t,e){if(t&&t.__id){var i;if(t.__radioURL)var i=this._getNsShorthand(t.__radioURL);t.__rid||(e=i||e),t.__id=this._idToNs(t.__id,e);for(var n in t.data)t.data.hasOwnProperty(n)&&this.isObject(t.data[n])&&this._transformObjToNs(t.data[n],i||e)}return t},t._transformToNsBeforeInsert=function(t,e){var i=t.__ctxCmdList,n=this._nsFromId(e.__id);console.log(" _transformToNsBeforeInsert ");var r=this;return n?(console.log("Using namespace "+n),i.forEach(function(t){t.cmd=r._transformCmdToNs(t.cmd,n)}),t=r._transformObjToNs(t,n),t.__ctxCmdList=i,this._addToCache(t),t):t},t.addCommandListener=function(t){f=t},t.addListener=function(t,e){p||(p={});var i,n=t.split("."),r=n[0];n.length>1&&(i=n[1]);var a=this.fetch(r);if(a&&i){var o=a.__id+"::"+i;p[o]||(p[o]=[]),p[o].push(e)}},t.addToCache=function(t){n||(n={}),t._guid&&(n[t._guid]=t)},t.compressCmdBuffer=function(t){console.log(JSON.stringify(t));for(var e=t.length,i={},n=e-1;n>=0;n--){var r=t[n];if(4==r[0]){var a=r[1];i[a]?t.splice(n,1):i[a]=!0}}return t},t.execCommand=function(t,i,n,r,a){var o,s=this._find(t[4]),f=(t[0],t.slice()),r=this._findParentWithUrl(s),l="::"+t[0]+"::"+t[1];if(r&&r.__radioURL&&(o=r.__radioURL),o){var d=this._localExecCmd(t,i,n,r,a);return d}var h=e();if(1==t[0]){var u={data:{},__id:t[1]};this._addToCache(u),this.writeCommand(t),console.log("DID create the new object")}if(2==t[0]){var u={data:[],__id:t[1]};this._addToCache(u),this.writeCommand(t)}if(4==t[0]){var _=t[1];if(s&&(v.oldValue=s.data[_],s.data[_]=t[2],this._cmd(t,s,null),this.writeCommand(t),p)){var g=s.__id+"::"+_,y=p[g];y&&y.forEach(function(e){e(s,t[2])})}}if(13==t[0]){var _=t[1],b=c();s.data[_]=b.runToString(s.data[_],t[2]),m=!1;var w=[4,_,s.data[_],null,t[4]];if(this._cmd(w,s,null),this.writeCommand(t),p){var g=s.__id+"::"+_,y=p[g];y&&y.forEach(function(t){t(s,s.data[_])})}}if(5==t[0]){var _=t[1],x=this._find(t[2]);if(!s)return;if(!x)return;s.data[_]=x,x.__p=s.__id,this._cmd(t,s,x),this._moveCmdListToParent(x),this.writeCommand(t)}if(7==t[0]){var C=this._find(t[4]),I=this._find(t[2]),_="*",j=C.data.length;C&&I&&(C.data.push(I),I.__p=C.__id,this._cmd(t,C,I),this._moveCmdListToParent(I),this.writeCommand(t))}if(8==t[0]){var C=this._find(t[4]),T=this._find(t[2]),_="*",j=C.data.indexOf(T);C&&T&&(C.data.splice(j,1),T.__removedAt=j,this._cmd(t,C,T),T.__p=null,this.writeCommand(f))}if(10==t[0]){var s=this._find(t[4]),_=t[1];console.log("*** unsetting property ****",_),s&&_&&(delete s.data[_],this.writeCommand(t))}if(12==t[0]){var O,s=this._find(t[4]),_="*",A=s.data.length,k=0;for(k=0;A>k;k++){var E=s.data[k];if(E.__id==t[1]){O=E;break}}if(O){{var S=parseInt(t[2]);this._find(t[1])}v.fromIndex=k,s.__fromIndex=k,O.__fromIndex=k,s.data.splice(k,1),s.data.splice(S,0,O),this._cmd(t,s,O),this.writeCommand(f)}}if(16==t[0]){var N=this._find(t[4]),M=t[1],F=t[2],L=t[3],D=t[4];if(N&&N.data){var h=e(),u=_data({data:{},__id:L,__rid:F});R._waitingPromises||(R._waitingPromises=[]),R._waitingPromises.push(h),R._enterCtx(l),u.then(function(){N.data.push(u._docData),u._docData.__radioURL=M,delete u._docData.__ctxCmdList,delete u._docData.__cmdList;var e=P()._changeToRemote(u._docData,M,F);e.then(function(e){R._find(L);u._docData.__p=D,u._docData.__vpid=D,u._initializeData(u._docData);var r=_data(L);r.then(function(){R._cmd([7,N.data.length,L,null,D],N,r),n?h.resolve(e):R._sendCmdToRefs(t,i).then(function(){h.resolve(e)})})})}),this.writeCommand(t),R._leaveCtx(l)}else h.resolve(!0)}else h.resolve(!0);return h;var R,h,l,u,u,s,_,g,y,s,_,b,w,g,y,s,_,C,I,_,j,C,T,_,j,s,_,A,O,k,E,S,N,M,F,L,D,u},t.execCommandBackup=function(t,e){var i=this;if(this.isArray(t[0]))return void t.forEach(function(t){i.execCommand(t,e)});var n="::"+t[0]+"::"+t[1];if(i._enterCtx(n)){try{if(1==t[0]){var r={data:{},__id:t[1]},a=this._getObjectHash();a[r.__id]=r,e||l||this.writeCommand(t)}if(2==t[0]){var r={data:[],__id:t[1]},a=this._getObjectHash();a[r.__id]=r,e||l||this.writeCommand(t)}if(4==t[0]){var o=this._find(t[4]),s=t[1];if(o&&(o.data[s]=t[2],this._cmd(t,o,null),o.__rid||e||l||this.writeCommand(t),p)){var f=o.__id+"::"+s,d=p[f];d&&d.forEach(function(e){e(o,t[2])})}}if(13==t[0]){var o=this._find(t[4]),s=t[1],h=c();o.data[s]=h.runToString(o.data[s],t[2]),m=e||l;var u=[4,s,o.data[s],null,t[4]];if(this._cmd(u,o,null),e||l?this._cmd(t,o,null):this.writeCommand(t),m=!1,p){var f=o.__id+"::"+s,d=p[f];d&&d.forEach(function(t){t(o,o.data[s])})}}if(5==t[0]){var o=this._find(t[4]),s=t[1];if(setObj=this._find(t[2]),!o)return;if(!setObj)return;o.data[s]=setObj,setObj.__p=o.__id,this._cmd(t,o,setObj),this._moveCmdListToParent(setObj),e||l||this.writeCommand(t)}if(7==t[0]){var _=this._find(t[4]),g=this._find(t[2]),s="*",y=_.data.length;_&&g&&(_.data.push(g),g.__p=_.__id,this._cmd(t,_,g),this._moveCmdListToParent(g),e||l||this.writeCommand(t))}if(8==t[0]){var _=this._find(t[4]),b=this._find(t[2]),s="*",y=_.data.indexOf(b);_&&b&&(_.data.splice(y,1),b.__removedAt=y,this._cmd(t,_,b),b.__p=null,e||l||this.writeCommand(t))}if(12==t[0]){var w,o=this._find(t[4]),s="*",x=o.data.length,C=0;for(C=0;x>C;C++){var I=o.data[C];if(I.__id==t[1]){w=I;break}}if(w){var j=parseInt(t[2]);v.fromIndex=C,o.data.splice(C,1),o.data.splice(j,0,w),this._cmd(t,o,w),e||l||this.writeCommand(t)}}}catch(T){console.error(T.message)}i._leaveCtx(n),this._virtualCommand(t,e||l)}},t.execCommandBackup2=function(){var t=this,i=e();if(this.isArray(a[0]))return console.log("Array of promises.... "),this._execCommandsPromise(a,isRemote).then(function(){i.resolve(!0)}),i;var n="::"+a[0]+"::"+a[1];if(!t._enterCtx(n))return console.log("===> could not enter"),i.resolve(!0),i;console.log("*** execCommand ",a);this._getExecInfo();try{if(1==a[0]){var r={data:{},__id:a[1]},o=this._getObjectHash();o[r.__id]=r,isRemote||l||this.writeCommand(a),i.resolve(!0)}if(2==a[0]){var r={data:[],__id:a[1]},o=this._getObjectHash();o[r.__id]=r,isRemote||l||this.writeCommand(a),i.resolve(!0)}if(4==a[0]){var s=this._find(a[4]),f=a[1];if(s){if(!reflection&&s.__rid)return console.log("**** sending command to the reflected object **** "),a[4]=s.__rid,t._leaveCtx(n),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(v.oldValue=s.data[f],s.data[f]=a[2],this._cmd(a,s,null),s.__rid||isRemote||l||this.writeCommand(a),p){var d=s.__id+"::"+f,h=p[d];h&&h.forEach(function(t){t(s,a[2])})}if(!reflection)return t._leaveCtx(n),console.log("**** commands to the refs... **** "),t._sendCmdToRefs(a,isRemote).then(function(){console.log("**** ... commands to refs done. **** "),i.resolve(!0)}),i;console.log(".... looks like this was reflection??? "),i.resolve(!0)}else i.resolve(!0)}if(13==a[0]){var s=this._find(a[4]),f=a[1];if(!reflection&&s.__rid)return console.log("**** sending ACE update command to the reflected object **** "),a[4]=s.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;var u=c();s.data[f]=u.runToString(s.data[f],a[2]),m=isRemote||l;var _=[4,f,s.data[f],null,a[4]];if(this._cmd(_,s,null),isRemote||l?this._cmd(a,s,null):this.writeCommand(a),m=!1,p){var d=s.__id+"::"+f,h=p[d];h&&h.forEach(function(t){t(s,s.data[f])})}if(!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}if(5==a[0]){var s=this._find(a[4]),f=a[1];if(setObj=this._find(a[2]),!s)return;if(!setObj)return;s.data[f]=setObj,setObj.__p=s.__id,this._cmd(a,s,setObj),this._moveCmdListToParent(setObj),isRemote||l||this.writeCommand(a),i.resolve(!0)}if(7==a[0]){var g=this._find(a[4]),y=this._find(a[2]),f="*",b=g.data.length;if(g&&y){if(console.log(" insert OK "),!reflection&&g.__rid)return console.log("**** sending INSERT to the reflected object **** "),a[4]=g.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(g.data.push(y),y.__p=g.__id,this._cmd(a,g,y),g.__rid||this._moveCmdListToParent(y),g.__rid&&console.log("Can not write command, because parent object has __rid"),g.__rid||isRemote||l||(console.log(" creating write "),this.writeCommand(a)),!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(8==a[0]){console.log("%c COMMAND 8 ","background: red; color: #bada55"),console.log("*** remove item command "),console.log(a);var g=this._find(a[4]),w=this._find(a[2]),f="*",b=g.data.indexOf(w);if(g&&w){var x=g.__rid&&w.__rid,C=!0;if(w.__vpid&&w.__vpid!=w.__pid&&(C=!1),!reflection){if(C&&w.__rid&&g.__rid)return console.log("**** sending remove command to the reflected object **** "),a[4]=g.__rid,a[2]=w.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;if(!C&&w.__rid&&g.__rid)return console.log("**** sending remove command to the reflected object **** "),a[4]=w.__vpid,a[2]=w.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i}if(console.log("*** was able to find the object to remove "),g.data.splice(b,1),w.__removedAt=b,this._cmd(a,g,w),w.__p=null,x||isRemote||l||this.writeCommand(a),!reflection)return t._leaveCtx(n),a[2]=w.__rid,t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(12==a[0]){var I,s=this._find(a[4]),f="*",j=s.data.length,T=0;for(T=0;j>T;T++){var O=s.data[T];if(O.__id==a[1]){I=O;break}}if(I){var A=parseInt(a[2]),k=this._find(a[1]),E=s.__rid&&k.__rid;if(!reflection&&E)return console.log("**** sending moveToIndex CMD to the reflected object **** "),a[4]=s.__rid,a[1]=k.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),i.resolve(!0),i;if(v.fromIndex=T,s.data.splice(T,1),s.data.splice(A,0,I),this._cmd(a,s,I),E||isRemote||l||this.writeCommand(a),!reflection)return t._leaveCtx(n),t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(!0)}),i;i.resolve(!0)}}if(16==a[0]){console.log("%c COMMAND 16 ","background: #222; color: #bada55"),console.log(a);var S=this._find(a[4]),N=a[1],M=a[2],F=a[3],L=a[4];if(S&&S.data){if(!reflection&&S.__rid)return a[4]=S.__rid,t._leaveCtx(n),console.log(JSON.stringify(a)),t.execCommand(a,isRemote).then(function(){i.resolve(!0)}),i;console.log(" - - - about to insert remote object into array - - - ");var r=_data({data:{},__id:F,__rid:M});t._waitingPromises||(t._waitingPromises=[]),t._waitingPromises.push(i),r.then(function(){console.log("%c COMMAND 16, did NEW object ","background: #222; color: #bada55"),console.log(r._docData),S.data.push(r._docData),r._docData.__radioURL=N,delete r._docData.__ctxCmdList,delete r._docData.__cmdList;var e=P()._changeToRemote(r._docData,N,M);e.then(function(e){console.log("%c COMMMAND 16 a new object creation, loader promise Returned with ","background: #222; color: #bada55"),console.log(e),console.log("The object to be changed is now ",r);var n=t._find(F);console.log("From cache it is ",F),console.log(n),r._docData.__p=L,r._docData.__vpid=L,r._initializeData(r._docData);var o=_data(F);o.then(function(){t._cmd([7,S.data.length,F,null,L],S,o),reflection?i.resolve(e):t._sendCmdToRefs(a,isRemote).then(function(){i.resolve(e)})})})}),isRemote||l||(console.log("Writing the command .... "),this.writeCommand(a)),t._leaveCtx(n)}}}catch(D){console.error(D.message),i.resolve(D.message)}return t._leaveCtx(n),i},t.findFromCache=function(t){return n?n[t]:void 0},t.getCommands=function(){return i},t.getObjectCache=function(){return n},t.getSetvalCmd=function(t,e){if(s[t]||(s[t]={}),!s[t][e]){s[t][e]=[]}return s[t][e]},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(this.initCmdIndex(),v={},y={},b={},C=1,w={1:[1],2:[1],4:[4],5:[2,4],7:[2,4],8:[2,4],10:[2,4],12:[4],13:[4],16:[3,4]},I={},x={})}),t.initCmdIndex=function(){r={},r.createObject=1,r.createArray=2,r.initProp=3,r.set=4,r.setMember=5,r.push=6,r.pushObj=7,r.removeItem=8,r.last=9,r.removeProperty=10,r.insertObjectAt=11,r.moveToIndex=12,o=[null,null,null,null,null],s={},d={},u={},h={time:(new Date).getTime(),list:[],index:{}},later().every(.05,function(){return})},t.isDoingRemote=function(){return m},t.isRecordingCommands=function(){return!this._isRecordCommandsOff},t.reverseCommand=function(t){var e=t.slice();return 4==t[0]&&(e[2]=t[3],e[3]=t[2]),e},t.saveCommand=function(t,e,n,a){if(i||(i=[]),!l){r||this.initCmdIndex();var o=r[t];if(o){var s=o+":"+e,c=this;if(c._enterCtx(s)){var d,h=this._guid;if(4==o){{this._createHotObject(this)}d=[],d[0]=o,d[1]=e,d[2]=n,d[3]=a,d[4]=this._guid}else d=[],d[0]=o,d[1]=e,d[2]=n,d[3]=a,d[4]=h;this._hotBuffer&&this._hotBuffer.push(d),f&&f(d);var u=this._findRootDoc();return u&&(u.__cmdList||(u.__cmdList=[]),u.__ctxCmdList||(u.__ctxCmdList=[]),u.__cmdList.push(d),u.__ctxCmdList.push({ctx:this._getCtx(),cmd:d}),this._addHotDoc(u)),c._leaveCtx(s),this}}}},t.setCommandRecOnOff=function(t){return this._isRecordCommandsOff=t?!1:!0,this},t.writeCommand=function(t,e){e||(e=this._find(t[4])),t[5]=(new Date).getTime();var i=this._findRootDoc(e),n=i;return n.__cmdList||(n.__cmdList=[]),n.__ctxCmdList||(n.__ctxCmdList=[]),n.__radio?void console.error("**** the RADIO should not be used with WRITE COMMAND ***** "):void n.__ctxCmdList.push({ctx:this._getCtx(),cmd:t})}}(this),function(t){var e,i;t._createContextVar=function(t){var e={};i||(i=this.guid());var n=i+""+t;return e[n]=1,e},t._enterCtx=function(t,n){e||(e={active:{}}),i||(i=this.guid());var r=i+t;return e.active[r]?n?!0:!1:(e.active[r]=1,!0)},t._getContextId=function(){return i},t._getCtx=function(){var t={},i=e.active;for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t},t._leaveCtx=function(t){var n=i+t;e.active[n]&&delete e.active[n]},t._resetCtx=function(){e.active={}},t._setCtx=function(t){e.active=t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i=this.guid()),e||(e={active:{}})})}(this),function(t){t.forEach=function(t,e,i){if(t){var r,a;if(i){if(!i._data)return;a=i.data[t],a&&(r=a.data)}else{if(!this._data)return;a=this._data.data[t],a&&(r=a.data)}if(r)if(this.isArray(r))for(var o=0,s=r.length;s>o;o++){var c=r[o];e(c)}else if(this.isObject(r))for(n in r)if(r.hasOwnProperty(n)){var c=r[n];e(c)}}}}(this),function(t){var e,i,n,r,a,o,s,c,f,l,d,h;t._callController=function(t,e,i){var n=t.split("/");if(t=n[0],n.shift(),console.log("Looking for '"+t+"' "),r&&r[t]){var a;if(console.log("Found it, data =  ",e),console.log(r),e){var a=this._find(e);r[t](a,i,n)}}},t._clickResponder=function(t){console.log("**** AT CLICK RESPONDER **** "),e||(e=templateCompiler());var i=(new Date).getTime();if(!(l.hasClick&&i-l.hasClick<80)){l.hasClick=(new Date).getTime();var a=this,o=e,c=t.target||t.srcElement;if(c){var d=c.getAttribute("data-click-pop"),u=!1;if(d){var _=a.findPushId(c);_&&a.popView(_)}var p=c.getAttribute("data-click-compile");if(p){var v=p.split("=>");console.log("Compiling",v);var m=v[0],g=v[1],y=c.getAttribute("data-id"),b=a._find(y);if(b&&m&&g){e||(e=templateCompiler());var o=e,a=this,w=o.compile(b.data[m]);a.set(b,g,JSON.stringify(w));var x=JSON.stringify(templateCompiler2().compile(b.data[m]));console.log(x),console.log("LENGTH",x.length),console.log("HTML size",b.data[m].length),console.log("Orig data size",JSON.stringify(w).length)}}var p=c.getAttribute("data-click-set");if(p){var v=p.split("="),C=v[0],I=v[1],y=c.getAttribute("data-id"),b=a._find(y);a.query(C,function(t,e){var i=e.obj,n=e.name;console.log("Calling set for ",i,n),i.data[n]!=I&&a.set(i,n,I)},b)}var p=c.getAttribute("data-click-clear");if(p){var j=p.split(",");j.forEach(function(t){var e=c.getAttribute("data-id"),i=a._find(e);a.set(i,t,"")})}var p=c.getAttribute("data-toggle-this");if(p){var v=p.split("/");console.log("Data Toggle This ",v);var C=v[0],T=v[1],O=v[2],y=c.getAttribute("data-id"),b=a._find(y);console.log("Calling set for ",b),b.data[C]!=T?a.set(b,C,T):a.set(b,C,O)}var p=c.getAttribute("data-toggle-sublevels");if(p){var v=p.split("/"),p=v[0],C=v[1],T=v[2],O=v[3],y=c.getAttribute("data-id"),A=a._find(y);if(A&&A.data[p]){var k=A.data[p];k.data.length&&k.data.forEach(function(t){t.data[C]!=T?(a.set(t,C,T),console.log("Setting to ",T)):a.set(t,C,O),console.log(t)})}}var p=c.getAttribute("data-click-select");if(p){var E,y=c.getAttribute("data-id");if(y){var E=a._find(y);s||(s={}),s[p]||(s[p]=[]);var S,N=s[p];if(E.__p){var P=a._find(E.__p);P&&(P.__selected||(P.__selected={}),P.__selected[p]||(P.__selected[p]=[]),S=P.__selected[p])}var M,F,L,D=c.getAttribute("data-sel-class");if(D){var v=D.split(":");F=v[0],F==p&&(M=v[1])}if((L=N.indexOf(y))>=0){if(M&&$(c).removeClass(M),N.splice(L,1),S){var R;(R=S.indexOf(y))>0&&S.splice(R,1)}}else if(M&&$(c).addClass(M),N.push(y),S){var R;(R=S.indexOf(y))>0||S.push(y)}u=!0}}var V=c.getAttribute("data-click-ctrl");if(V){var q=V.split("/");if(V=q[0],q.shift(),r&&r[V]){var E,y=c.getAttribute("data-id");if(y){var E=a._find(y);u=!0}r[V](E,c,q)}}var H=c.getAttribute("data-click-post-url");if(H){var E,y=c.getAttribute("data-id");if(y){u=!0;var E=a._find(y);c.getAttribute("data-post-only-id")&&(E=a.isArray(E.data)?{__id:E.__id,data:[]}:{__id:E.__id,data:{}}),$.ajax({type:"POST",url:H,data:JSON.stringify(E),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){console.log(t),t.__sCmds&&a.execCommand(t.__sCmds,!0),t.__uiCmds&&t.__uiCmds.forEach(function(t){var e=h[t.cmd];e&&e.apply(a,t.data)})},failure:function(){}})}}var B=c.getAttribute("data-click-create");if(B){var x="{"+B+"}",U=JSON.parse(x);console.log(x),console.log("To create ",JSON.stringify(U));for(var W in U){var y=c.getAttribute("data-id");if(y){u=!0;var E=a._find(y);a.push(E.data[W],U[W])}}}var B=c.getAttribute("data-click-copy");if(B){var y=c.getAttribute("data-id");if(y){var E=a._find(y),P=a._find(E.__p),z=a.duplicate(E);a.push(P,z),u=!0}}var B=c.getAttribute("data-click-to-clipboard");if(B){var y=c.getAttribute("data-id");if(y){var E=a._find(y),P=a._find(E.__p),z=a.toPlainData(E);f=z,u=!0}}var B=c.getAttribute("data-click-from-clipboard");if(B){var y=c.getAttribute("data-id");if(y){var G=a._find(y);if(G&&G.data){var E=G.data[B];E&&f&&E.data&&a.isArray(E.data)&&(a.push(E,f),u=!0)}}}var J=c.getAttribute("data-click-remove");if(J){var y=c.getAttribute("data-id");y&&(u=!0,confirm("Remove item?")&&a.removeItem(y))}var Q=c.getAttribute("data-click-moveup");if(Q){var y=c.getAttribute("data-id");y&&(u=!0,a.moveItemUp(y))}var Q=c.getAttribute("data-click-movedown");if(Q){var y=c.getAttribute("data-id");y&&(u=!0,a.moveItemDown(y))}var Y=c.getAttribute("data-click-view");if(Y){var X=Y.split(",");X.forEach(function(t){var e,i=t.split("/");if(i.length>1){var r=i[1];t=i[0]}var s,f=t.charAt(0);if("."==f){e=t.substring(1);for(var l=c.parentNode;l;)if(l.getAttribute){if(console.log("Looking for ",e),l.getAttribute("data-viewclass")==e){s=l;break}var d;if((d=l.getAttribute("class"))&&d.match(e)){s=l;break}l=l.parentNode}else l=l.parentNode}if("#"==f){e=t.substring(1);var s=document.getElementById(e)}if(s||console.log("Did not find ",t),s){u=!0;var h=c.getAttribute("data-id");if(console.log("data-id ",h),h){var _=a._find(h),p=!1,v=s.getAttribute("data-e-view");if(v&&n&&n[v]){var m=n[v](_);a.pushView(e,m._dom,{sourceElem:c}),p=!0}if(!p){var g;if(g=r?r:s.getAttribute("data-use-view"),console.log("looking view ",g),g){var y=a.findNamedView(g);if(console.log("found view ",y,"composing with",_),y){var b=o.composeTemplate(_,y);a.pushView(s,b,{sourceElem:c,animMs:400,animFn:function(t){$(t).addClass("bounceOut")},animEnd:function(t){$(t).removeClass("bounceOut")}})}}}}}})}return u}}},t._createUploadFrame=function(t){var e=D(),i=e.form("",{action:t.target,enctype:"multipart/form-data",method:"POST",name:e.guid()}),n=t.maxCnt||20,r=function(e){t.onComplete&&t.onComplete(e)},a="complete"+(new Date).getTime();if(window[a]=r,i.input("",{type:"hidden",value:a,name:"onComplete"}),i.label("control-label").text(t.title||"Valitse tiedostot"),t.vars)for(var o in t.vars)t.vars.hasOwnProperty(o)&&i.input("",{type:"hidden",value:t.vars[o],name:o});var s=i.div("form-group"),c=t.maxFileCnt||5,f=0,l=function(){if(!(f>=c)){var i=s.input("",{type:"file",name:"file_"+f});i.on("value",function(){t.autoUpload?e.uploadFiles():n>f&&l()}),f++}};l();var d=D("iframe"),h=e.guid();return d.q.attr("id",h),d.q.attr("name",h),d.absolute().x(-4e3).y(-4e3),e.add(d),e.uploadFiles=function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&i.input("",{type:"hidden",value:e[n],name:n});var r=t.tElem.getAttribute("data-upload-to");r&&i.attr({action:r}),i._dom.target=h,i._dom.submit(),s.clear(),f=0,l()},t.getUploader&&t.getUploader(e.uploadFiles),e},t._initUiCommands=function(){var t=this;e||(e=templateCompiler());var i=e;h.openView=function(e,r){var a=!1;if(e){var o=e.split(",");return o.forEach(function(e){var o,s=e.split("/");if(s.length>1){var c=s[1];e=s[0]}var f,l=e.charAt(0);if("#"==l){o=e.substring(1);var f=document.getElementById(o)}if(f&&f&&(a=!0,r)){var d=t._find(r),h=!1,u=f.getAttribute("data-e-view");if(u&&n&&n[u]){var _=n[u](d);t.pushView(o,_._dom,{sourceElem:elem}),h=!0}if(!h){var p;if(p=c?c:f.getAttribute("data-use-view")){var v=t.findNamedView(p);if(v){var m=i.composeTemplate(d,v);t.pushView(f,m,{})}}}}}),a}}},t._mouseDownHandler=function(){l.items=[],l.itemsHash={}},t._mouseMoveHandler=function(t){var e=t.target;if(e&&e.getAttribute){var i=e.getAttribute("data-id");i&&(l.itemsHash[i]||(l.itemsHash[i]=i,l.items.push(i)))}},t._mouseUpHandler=function(){console.log("Drag results"),console.log(l)},t._valueResponder=function(t,e,i,n){var r=t.data[e];if(t.data[e]=i,console.log("_valueResponder with ",e,i),P()._emitEvent(t.__id,"change",[4,e,i,r,t.__id]),n.getAttribute){var a;if(a=n.getAttribute("data-value-filter")){var o,s=a.split("=>"),c=this,f=$.trim(s[1]),l=$.trim(s[2]),d=l.split("/"),h=d[0],u=d[1],_=d[2],p=50;(o=n.getAttribute("data-filter-maxcnt"))&&(p=o),this.query($.trim(s[0]),function(t){t&&t.data&&t.data.forEach&&t.data.forEach(function(t){return 0>p?void c.set(t,h,_):void(t.data[f]&&t.data[f].toLowerCase().match(i.toLowerCase())?(c.set(t,h,u),p--):c.set(t,h,_))})})}}},t.bindBaseEvents=function(t){e||(e=templateCompiler()),l||(l={}),l.touchEnabled=!1;var i=this,n={};if(!t.addEventListener){var r={activeInput:null};return t.attachEvent("onkeyup",function(){if(r.activeInput&&r.routeId){var t=r.routeId,e=r.activeInput,n=t.split("::"),a=n[0],o=P()._find(a),s=n[1];if(!o)return;var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}r.activeInput=window.event.srcElement}),t.attachEvent("onfocusin",function(t){var t=t||window.event,e=t.srcElement;r.activeInput=e,r.routeId=e.getAttribute("data-value-id"),r.routeId}),t.attachEvent("onfocusout",function(t){var t=t||window.event,e=t.srcElement,i=e.getAttribute("data-value-id");r.activeInput&&r.routeId==i&&(r.activeInput=null,r.routeId=0)}),void t.attachEvent("onclick",function(t){t=window.event;var e=(new Date).getTime();n.clickFired&&e-n.clickFired<600||(i._clickResponder(t)&&(n.clickFired=e),n.clickFired=e)})}t.addEventListener("mousedown",function(t){i._mouseDownHandler(t)}),t.addEventListener("mousemove",function(t){i._mouseMoveHandler(t)}),t.addEventListener("mouseup",function(t){i._mouseUpHandler(t)}),t.addEventListener("click",function(t){if(!l.touchEnabled){var e=(new Date).getTime();if(!(n.clickFired&&e-n.clickFired<200)){return void(i._clickResponder(t)&&(n.clickFired=e))}}}),window.addEventListener("hashchange",function(){if(a.hashSet)return void console.log("In the middle of the hash setting");var t=document.location.hash;if(console.log("We have a new hash "+t),console.log("No react is ",a.noReactOn),a.noReactOn&&"#"+a.noReactOn==t)return void console.log("Should not react on ",t);var e=d.length;if(e>0){var n=d[e-1];i.popView(n.pushId)}}),t.addEventListener("input",function(t){var e=t.target;if(e){var n=e.getAttribute("data-value-id");if(n){var r=n.split("::"),a=r[0],o=P()._find(a),s=r[1];if(!o)return;var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}}},!0),t.addEventListener("change",function(t){console.log("**** GOT CHANGE EVENT ****");var e=t.target;if(e){var n=e.getAttribute("data-value-id");if(console.log("**** TARGET FOR CHANGE EVENT ****"),console.log(t.target),console.log(t.target.value),console.log(n),n){var r=n.split("::"),a=r[0],o=P()._find(a),s=r[1];if(!o)return void console.log("Could not find object with id ",a);console.log("==> value responder");var c=e.value,f=o.data[s];c!=f&&i._valueResponder(o,s,c,e)}}},!1);var o=function(t){l.touchEnabled=!0,n._touchItems=[];var e=t.touches;t.targetTouches&&(e=t.targetTouches),n._touchCount=e.length;for(var i=0;i<e.length;i++){var r={};r.startX=e[0].pageX,r.startY=e[0].pageY,n._touchItems[i]=r}n.touchStartMs=(new Date).getTime(),n.bTouchOn=!0,n.didMove=!1},s=function(t){var e=t.touches;t.targetTouches&&(e=t.targetTouches),n._touchCount=e.length;for(var i=0;i<e.length;i++){var r=n._touchItems[i];r.dx=t.touches[i].pageX-r.startX,r.dy=t.touches[i].pageY-r.startY}n.didMove=!0},c=function(t){n.bTouchOn=!1;var e=(new Date).getTime(),r=e-n.touchStartMs,a=e-(n.clickFired||0),o=0;if(n.didMove){var s=n._touchItems[0].dx,c=n._touchItems[0].dy;o=Math.sqrt(s*s+c*c)}500>r&&a>100&&20>o&&(n.clickFired=e,i._clickResponder(t)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,n.clickFired=e))};t.addEventListener("touchstart",o,!1),t.addEventListener("touchmove",s,!1),t.addEventListener("touchend",c,!1)},t.createController=function(t,e){r||(r={}),r[t]=e},t.createView=function(t,e){n||(n={}),n[t]=e},t.findPushId=function(t){if(t){if(t.getAttribute){var e=t.getAttribute("data-pushid");if(e&&c){var i=c[e];if(i)return e}}if(t.parentNode)return this.findPushId(t.parentNode)}},t.findSelection=function(t){return s&&s[t]?s[t]:[]},t.findViewElement=function(t){if(t){var e=t.getAttribute("id");if(e){var n=i[e];if(n)return e}if(t.parentNode)return this.findViewElement(t.parentNode)}},t.findViewIdFromElem=function(t){if(t){if(t.getAttribute){var e=t.getAttribute("id");if(e&&i){var n=i[e];if(n)return e}}if(t.parentNode)return this.findViewIdFromElem(t.parentNode)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){a||(a={bTransform:!1,hashSet:!1},d=[],l={itemsHash:{},items:[]},h={},this._initUiCommands(),e=templateCompiler()),o||(o=later())}),t.popView=function(t){if(!a.on){if(this.isObject(t)){t=this.findPushId(t)}if(c&&c[t]){d.pop();var e=c[t].pop();if(e){for(var i=e.parentDOM;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(e.viewFrag),console.log(e),this.scrollTo(e.sourceElem?e.sourceElem:i),a.hashSet=!0,a.noReactOn=(new Date).getTime(),document.location.hash=a.noReactOn,later().add(function(){a.hashSet=!1})}}}},t.pushView=function(t,e,n){console.log("pushView called ",t);var r,o,s=this;if(this.isObject(t)){if(o=t,t=o.getAttribute("data-viewid"),console.log("pushView with ",o,t),!t)return}else r=t,o=document.getElementById(t);if(!a.on&&o){n||(n={}),d||(d=[]),a.hashSet=!0,a.noReactOn=(new Date).getTime(),document.location.hash=a.noReactOn,later().add(function(){a.hashSet=!1}),i||(i={}),i[t]||(i[t]=[]);var f=this.guid();c||(c={}),c[f]||(c[f]=[]),e.setAttribute("data-pushid",f);for(var l=document.createDocumentFragment();o.firstChild;){var h=o.firstChild;o.removeChild(h),l.appendChild(h)}var u={viewFrag:l,parentDOM:o,sourceElem:n.sourceElem||null,pushId:f};return d.push(u),i[t].push(u),c[f].push(u),s.scrollTo(e),o.appendChild(e),this}},t.scrollTo=function(t){if(window){var e={left:0,top:0,width:800,height:800};try{"undefined"!=typeof t.getBoundingClientRect&&(e=t.getBoundingClientRect())}catch(i){e={left:0,top:0,width:800,height:800}}var n=window.pageXOffset,r=e.top;if(r<window.innerHeight/2)return;e.top<window.innerHeight?r/=2:r-=.2*window.innerHeight,window.scrollTo(n||0,parseInt(r))}},t.touchEvents=function(){var t=this._dom;if(t.addEventListener){var e=this;this._touchItems=[];var i=function(t){e._touchItems=[];var i=t.touches;t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var r={};r.startX=i[0].pageX,r.startY=i[0].pageY,e._touchItems[n]=r}e.trigger("touchstart"),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1},n=function(t){var i=t.touches;t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var r=e._touchItems[n];r.dx=t.touches[n].pageX-r.startX,r.dy=t.touches[n].pageY-r.startY}e.trigger("touchmove"),t.preventDefault&&t.preventDefault()},r=function(t){e.trigger("touchend"),t.preventDefault&&t.preventDefault(),t.returnValue=!1};t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",n,!1),t.addEventListener("touchend",r,!1)}}}(this),function(t){var e;t.getDataAccessMethods=function(t){for(;t&&t.length&&" "==t.charAt(0);)t=t.substring(1);var e,i,n=t.split("://"),r={bRemote:!1};if(n.length>1){var a=n.shift(),i=n.shift(),o=i.split(" ");o.length>0&&(i=o.shift(),e=o.join(" "),r.dataQuery=e,r.queryInfo=this.getQueryInfo(e)),r.remoteUrl=a+"://"+i,r.protocol=a,r.bRemote=!0;var s=i.split("/"),c=s.shift(),f=c.split(":"),l=f[0],d=f[1];r.port=d,r.ip=l;var h=s.shift(),u=s.pop(),_=s.join("/");r.remoteSandbox=h,r.removeFileName=u,r.remotePath=_}else r.bCurrentData=!0,r.dataQuery=n[0],r.queryInfo=this.getQueryInfo(r.dataQuery);return r},t.getQueryInfo=function(t){for(var e={};t&&t.length&&" "==t.charAt(0);)t=t.substring(1);var i=function(t){for(var e=t.length,i=!1,n=e-1;n>=0;)t[n]&&0!=t[n].length?(" "==t[n]?i?t.splice(n,1):i=!0:i=!1,n--):(t.splice(n,1),n--);return t};if(t){var n=t,r=t.split(" ");if(r=i(r),"#"==n.charAt(0)){var a=r.shift();e.bNamedView=!0,e.viewName=a.substring(1),n=r.join(" ")}if("@"==n.charAt(0)){var a=r.shift();e.bMetaData=!0,e.metaName=a.substring(1),n=r.join(" ")}r[0]&&("select"==r[0].toLowerCase()?(e.selectCmd=r.shift(),e.pathQuery=r.shift()):e.pathQuery=r.shift(),r[0]&&"as"==r[0].toLowerCase()&&(e.asCmd=r.shift(),e.asName=r.shift()))}if(e.pathQuery){var o=e.pathQuery.split(":");o.length>1&&(e.pathQuery=o[0],e.customType=o[1])}return e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e={})}),t.query=function(t,e,i){var n=this.getDataAccessMethods(t),r=this;if(n.bRemote){var a=P(n.remoteUrl);a.then(function(){var t=a.fetch(n.queryInfo.pathQuery);n.queryInfo.asName&&r.setNamedModel(n.queryInfo.asName,t),e(t)})}else{if(n.queryInfo.bNamedView&&(i=r.getNamedModel(n.queryInfo.viewName),!i))return void e(null,null);if(i||(i=r.getData()),n.queryInfo.bMetaData&&i&&(i=r.getMeta(i,n.queryInfo.metaName),!i))return void e(null,null);n.queryInfo.pathQuery||(n.queryInfo.pathQuery="/");var o=r.fetch(n.queryInfo.pathQuery,i);if(n.queryInfo.asName&&r.setNamedModel(n.queryInfo.asName,o),n.queryInfo.customType){var s=templateCompiler().createViewType(n.queryInfo.customType,o,{});s&&(o=s.textContent||s.innerText||"")}e(o,{obj:r._lastQueryObj,name:r._lastQueryVar})}}}(this),function(t){var i,n,r;t._disableChannel=function(t){var e=this._getChannelPoints(t);e.disabled||(e.disableIndex=e.i),e.disabled=!0},t._enableChannel=function(t){var e=this._getChannelPoints(t);e.disabled=!1},t._getChannelPoints=function(t){return n[t]||(n[t]={i:0,o:0,currentPointer:0,currentPromise:null,currentMainPromise:null,waitingList:[]}),n[t]},t._getCommandCnt=function(t){if(!i)return 0;if(!i[t])return 0;var e=this._getChannelPoints(t),n=e.i,r=i[t];
return r.length-n},t._getCommandHistory=function(t){return i&&i[t]?i[t]:[]},t._getCommandPointer=function(){return n.i},t._hasNewCommands=function(t){if(i&&i[t]){var e=this._getChannelPoints(t),n=e.i,r=i[t],a=r[n];return a?!0:!1}},t._isAtEndNoWaiting=function(t){var e=this._getChannelPoints(t);return 0!=this._getCommandCnt(t)||0!=e.waitingList.length||e.currentMainPromise?!1:!0},t._isChannelDisabled=function(t){var e=this._getChannelPoints(t);return e.disabled},t._popChannelCommand=function(t){if(i&&i[t]){var e=this._getChannelPoints(t),n=e.i,r=i[t],a=r[n];if(a)return e.i++,a}},t._pushChannelCommand=function(t,e,n,r,a){if(i[t]||(i[t]=[]),e=e.slice(),e[5]=i[t].length,this._isChannelDisabled(t))return void i[t].push({cmd:e,ctx:n,r:r,radio:a});if(r&&this._isAtEndNoWaiting(t)&&4==e[0]){this._realExecCmd(e,!0),i[t].push({cmd:e,ctx:n,r:r,radio:a,done:!0});var o=this._getChannelPoints(t);o.i++}else e[6]=(new Date).getTime(),i[t].push({cmd:e,ctx:n,r:r,radio:a})},t._startChannelLoop=function(t){if(!r[t]){r[t]=!0;var e=this;later().every(1/30,function(){e._isChannelDisabled(t)||e._hasNewCommands(t)&&e._stepCommandList(t)})}},t._stepCommandList=function(t){var i=this._getChannelPoints(t),n=!1;i.currentMainPromise&&(n=!0);for(var r,a,o=h(),s=(o.namespace(t),e()),c=e(),f=this,l=function(t,n){return t.then(function(){var t=!1;n.ctx&&(f.isObject(n.ctx)?f._setCtx(n.ctx):f._enterCtx(n.ctx));var r;return(r=n.r?f._realExecCmd(n.cmd,n.r,t):e())?(n.cmd=f._transformCmdFromNs(n.cmd),i.currentPromise=r,i.currentPromiseMs=(new Date).getTime(),r.then(function(){n.ctx&&(f.isObject(n.ctx)?f._resetCtx():f._leaveCtx(n.ctx))}).fail(function(){console.error("FAILED command ",n),n.ctx&&(f.isObject(n.ctx)?f._resetCtx():f._leaveCtx(n.ctx))}),r):(r=e(),r.resolve(!0),r)})},d=s,u=0,_=[];r=this._popChannelCommand(t);)r.done||(!r.r&&r.radio?(a=r.radio,_.push(this._wrapRemoteCmd(r))):(d=l(d,r),u++));return _.length&&a.send(t,_),d.then(function(){c.resolve(!0)}).fail(function(t){console.error("*** _stepCommandList failed "+t)}),c.then(function(){if(i.currentMainPromise=null,i.currentPromise=null,i.waitingList.length){var t=i.waitingList.shift();t.resolve(!0)}}),n?(i.waitingList.push(s),s.then(function(){i.currentMainPromise=c})):(i.currentMainPromise=c,s.resolve(!0)),c},t._wrapRemoteCmd=function(t){var e;return t.ctx&&(e=this.isObject(t.ctx)?t.ctx:this._createContextVar(t.ctx)),t.cmd=this._transformCmdFromNs(t.cmd.slice()),{ctx:e,cmd:t.cmd}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i={},n={},r={})})}(this),function(t){t.createForkedObject=function(t,e){if(!this.isObject(t)&&!this.isArray(t))return t;var i;i=this.isArray(t.data)?[]:{};var n={data:i,__id:this.guid(),__fork:t.__id};if(e?n.__p=e.__id:t.__radioURL&&(n.__forkURL=t.__radioURL),this.isArray(t.data))for(var r=t.data.length,a=0;r>a;a++)i[a]=this.createForkedObject(t.data[a],n);else for(var o in t.data)t.data.hasOwnProperty(o)&&(i[o]=this.createForkedObject(t.data[o],n));return n},t.fork=function(){}}(this),function(t){var i,n,r,a,o,s,c,f,l,d;t._addModelView=function(t,e){a||(a={}),a[t]||(a[t]=[]),a[t].push(e)},t._addToCache=function(t){t&&t.__id&&(i[t.__id]=t)},t._changeToRemote=function(t,i,n){if(t){console.log("change to remote called "+i);var r=e(),a=P()._find(n),o=this;if(a){var s=o._createReflection(a,i,t);return s.then(function(e){console.log("reflection done"),t.data=e.data,e.__vpid&&(t.__vpid=e.__vpid),e.__vcid&&(t.__vcid=e.__vcid),r.resolve(a)}),r}var c=P(i,{});return console.log("starting loader "),c.then(function(){console.log("finished loader ");var e=c._find(n);if(e){console.log("Remote data "),console.log(JSON.parse(JSON.stringify(e))),console.log("creating reflection ");var a=o._createReflection(e,i,t);a.then(function(i){console.log("reflection done"),t.data=i.data,i.__vpid&&(t.__vpid=i.__vpid),i.__vcid&&(t.__vcid=i.__vcid),r.resolve(e)})}else console.error(" did not find "+i+"/"+n),r.fail(" did not find "+i+"/"+n)}),r}},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){if(!this.isObject(t)&&t){var e;if(e=this._myClassCache(t))return e;this._myClassCache(t,this)}}),t._clearWorkers=function(t){var e=this;t.workers.forEach(function(t){e._removeWorker(t)}),t.childViews.forEach(function(t){e._clearWorkers(t)})},t._cmd=function(t,e,i){var n=t[4],a=r;if(e||(e=this._find(n)),a&&e){var o;if(o=a[n]){if(4==t[0]||13==t[0]){var s;if(s=o[t[1]]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var l=s[f][0],d=s[f][1],h=s[f][2];l.run(t,e,d,h)}}if(s=o["*"]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var l=s[f][0],d=s[f][1],h=s[f][2];l.run(t,e,d,h)}}}if(12==t[0]||7==t[0]||8==t[0]){var s;if(s=o["*"]){s=s.slice();for(var c=s.length,f=0;c>f;f++){var l=s[f][0],d=s[f][1],h=s[f][2];l.run(t,i,d,e,h)}}}}}},t._createModelCommands=function(t,e,i){i||(i=[]);var n;if(n=t.data&&t.__id?t.data:t,this.isObject(n)||this.isArray(n)){var r;if(r=t.__id?t:{data:n,__id:this.guid()},this.isArray(n))var a=[2,r.__id,[],null,r.__id];else var a=[1,r.__id,{},null,r.__id];e&&(r.__p=e.__id),i.push(a);for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];if(this.isObject(s)||this.isArray(s)){var c=this._createModelCommands(s,r,i),a=[5,o,c.__id,null,r.__id];i.push(a)}else{var a=[4,o,s,null,r.__id];i.push(a)}}return r}},t._createNewModel=function(t,e){if(this.isObject(t)||this.isArray(t)){var n={data:t,__id:this.guid()};if(i[n.__id]=n,this.isArray(t))var r=[2,n.__id,[],null,n.__id];else var r=[1,n.__id,{},null,n.__id];e&&(n.__p=e.__id),this.writeCommand(r,n);for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];if(this.isObject(o)||this.isArray(o)){var s=this._createNewModel(o,n);n.data[a]=s;var r=[5,a,s.__id,null,n.__id];this.writeCommand(r,n),this._moveCmdListToParent(s)}else{var r=[4,a,o,null,n.__id];this.writeCommand(r,n)}}return n}},t._createReflection=function(t,n,r){var a,o=e(),s=this,c=[];if(!n&&t.__radioURL&&t.__rid){var f=s._find(t.__rid);if(!f){var l=P(t.__radioURL);return l.then(function(){var e=s._createReflection(t,n,r);e.then(function(t){o.resolve(t)})}),o}}if(r?(a=r,a.__rid=t.__rid?t.__rid:t.__id,r.__vpid?(a.__vpid=r.__vpid,a.__vcid=r.__vcid):(a.__vpid=r.__p,a.__vcid=r.__id)):(a={__id:this.guid(),__rid:t.__id,__radioURL:n},t.__rid&&(a.__rid=t.__rid)),t.__vpid&&(a.__vpid=t.__vpid,a.__vcid=t.__vcid),t.__rid?this._addReflection(a.__rid,a.__id):this._addReflection(a.__rid,a.__id),a.__vcid&&this._addReflection(a.__vcid,a.__id),i[a.__id]=a,n&&(a.__radioURL=n),t.__radioURL&&(a.__radioURL=t.__radioURL),this.isArray(t.data)){a.data=[];for(var d=t.data.length,h=0;d>h;h++){var u=t.data[h];if(this.isObject(u)){var _=this._createReflection(u);c.push(_),function(t){_.then(function(e){a.data[t]=e,a.data[t].__p=a.__id})}(h)}else a.data[h]=u}}else{a.data={};for(var p in t.data)if(t.data.hasOwnProperty(p)){var u=t.data[p];if(this.isObject(u)){var _=this._createReflection(u);c.push(_),function(t){_.then(function(e){a.data[t]=e,a.data[t].__p=a.__id})}(p)}else a.data[p]=u}}if(c.length){var v=e();v.all(c).then(function(){o.resolve(a)}),v.resolve(!0)}else o.resolve(a);return o},t._createWorker=function(t,e,i,n,a){var o=r[t];o||(o=r[t]={});var s=o[e];s||(s=r[t][e]=[]);var c=[i,n,a];return s.push(c),[s,c]},t._emitEvent=function(t,e,r){var a=i[t];if(a){var o;n&&(o=n[t])&&o[e]&&o[e].forEach(function(t){t(r)}),a.__p?this._emitEvent(a.__p,e,r):(console.log("did not find the parent object..."),"change"!=e||n[t]||(console.log("Might trigger the change for this object"),a.__rid&&(console.log("it was also reflected object"),console.log(a),console.log(r),this.execCommand(r))))}},t._find=function(t){return i[t]},t._findObjects=function(t,n){var r=e();if(!this.isObject(t))return r.resolve(t),r;t=this._wrapData(t),t.__id&&(i[t.__id]=t);var a=this;if(t.__rid&&t.__radioURL){var o=P(t.__radioURL,{}),a=this;return o.then(function(){var e=o._find(t.__rid);if(e){var s=a._createReflection(e,t.__radioURL,t);s.then(function(){t.__p=n,i[t.__id]=t,r.resolve(t)})}else r.resolve(t)}),r}n&&(t.__p=n);var s=[];if(t.data){var c=t.data;for(var f in c)if(c.hasOwnProperty(f)){var l=c[f];if(this.isObject(l)){var d=this._findObjects(l,t.__id);s.push(d),function(e,i){d.then(function(n){n!==i&&(t.data[e]=n)})}(f,l)}}}if(s.length){var h=e();h.all(s).then(function(){r.resolve(t)}),h.resolve(!0)}else r.resolve(t);return r},t._findObjects2=function(){if(!this.isObject(data))return whenReady&&whenReady.resolve(data),data;data=this._wrapData(data),data.__id&&(i[data.__id]=data);var t=this;if(data.__rid&&data.__radioURL){console.log("_findObjects with ",data);var e=P(data.__radioURL,{}),t=this;return t._waitingPromises||(t._waitingPromises=[]),t._waitingPromises.push(e),e.then(function(){console.log("Finding ",data.__rid);var n=e._find(data.__rid);if(n){console.log("Creating reflection ",n,data.__radioURL,data);var r=t._createReflection(n,data.__radioURL,data);console.log(r),data.__p=parentId,i[data.__id]=data;var a=t._unresolved.indexOf(e);t._unresolved.splice(a,1),0==t._unresolved.length&&0==t._waitingPromises.length&&(console.log("**** unresolved == 0 ****, resolving this "),t.resolve(t._data))}}),data}if(data.__virtual){var e=P(data.__radioURL,{}),t=this;return t._unresolved.push(e),e.then(function(){console.log("Got remote data"),console.log(e),data.data=e._data.data,data.__radio=e._data.__radio,data.__id=e._data.__id,i[data.__id]=data;var n=t._unresolved.indexOf(e);t._unresolved.splice(n,1),0==t._unresolved.length&&t.resolve(t._data)}),data}if(parentId&&(data.__p=parentId),data.data){var n=data.data;for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];if(this.isObject(a)){var o=this._findObjects(a,data.__id);o!==a&&(data.data[r]=o)}}}return data},t._findRadioURL=function(t){return t||(t=this._data),t&&t.__radioURL?t.__radioURL:void 0},t._getAllWorkers=function(){return r},t._getChannelCommands=function(t){return d?d[t]:void 0},t._getCommandsFor=function(){},t._getModelViews=function(t){return a[t]},t._getObjectHash=function(){return i},t._getObjectInPath=function(t,e){if(t){var i=t.split("/");e||(e=this._data);var n=e,r=t;for(this._lastQueryObj=n,this._lastQueryVar=r;i.length>0;){var a=i.shift();if(0==a.length)break;if(e.data){if(".."==a){var o=this._find(e.__p);if(o){e=o,n=e;continue}return}var s=e.data[a];if(this.isObject(s)&&(n=s),s){r=a,e=s;continue}return}}return this._lastQueryObj=n,this._lastQueryVar=r,this.isObject(e)?e:e}},t._iterate=function(){},t._myClassCache=function(t,e){return l||(l={}),"undefined"==typeof e?l[t]:void(l[t]=e)},t._onValue=function(t,e,i){var r;n||(n={}),n[t]||(n[t]={}),n[t][e]||(n[t][e]=[]),r=n[t][e],r.indexOf(i)<0&&r.push(i)},t._prepareData=function(t){var e=this._wrapData(t);return i[e.__id]||(e=this._findObjects(e)),e},t._removeView=function(t){var e=t.dom;console.log("_removeView called "),e.parentNode&&e.parentNode.removeChild(e);var i;if(i=t.parentView){var n=i.childViews.indexOf(t);i.childViews.splice(n,1)}console.log("calling _clearWorkers "),this._clearWorkers(t)},t._removeWorker=function(t){if(t){var e=t[0],i=t[1];if(e&&i){var n=e.indexOf(i);n>=0&&e.splice(n,1)}}},t._triggerEvent=function(){i[objid]},t._wrapData=function(t){if(t&&t._wrapData)return t._data;if(t.__id&&t.data)return t;var e=this._createNewModel(t);return e},t.duplicate=function(t){var e=this.toPlainData(t),i=P(e);return i.getData()},t.fetch=function(t,e){var i=this._getObjectInPath(t,e);return i?i:void 0},t.findNamedView=function(t){return s||(s=templateCompiler()),s._getNamedView(t)},t.forTree=function(t,e){if(this.isFunction(t))e=t,t=this._data;else if(!this.isObject(t)||!this.isFunction(e))return;if(e(t),t.data){var i=t.data;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];this.isObject(r)&&this.forTree(r,e)}}return this},t.getData=function(){return this._data},t.getMeta=function(t,e){if(this.isObject(t)){if(!t.__meta)return;var i=t.__meta[e];if(i){var n=P(i);return n.getData()}}},t.getNamedModel=function(t){return f?f[t]:void 0},t.getNamedViews=function(){return s?s._getNamedViews():void 0},t.indexOf=function(t){if(t||(t=this._data),this.isObject(t)||(t=this._find(t)),t){var e=this._find(t.__p);if(e&&this.isArray(e.data))return e.data.indexOf(t)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._unresolved||(this._unresolved=[]),i||(i={},r={});var n=this;if(t&&!this.isObject(t)&&"http://"==t.substring(0,7)){console.log("##### Fetching data from ",t);var a=t,o={onCommand:function(t,e){t=n._transformCmdToNs(t,n._getNsFromUrl(a)),n._pushChannelCommand(a,t,e,!0)},onFile:function(e,i,r){console.log("---- ON FILE ---- "),e=n._transformObjToNs(e,n._getNsFromUrl(r)),n._data=e;var a=n._findObjects(e);a.then(function(e){if(n._data!=e&&(n._data=e),i&&i.length){i.forEach(function(t){t=n._transformCmdToNs(t,n._getNsFromUrl(r)),n._pushChannelCommand(r,t,{},!0)});var a=n._stepCommandList(r);a&&a.then(function(){n._data.__radioURL=t,n._data.__radio=s,n._startChannelLoop(n._data.__radioURL),n.resolve(n._data)}).fail(function(){})}else n._data.__radioURL=t,n._data.__radio=s,n._data._cmdList&&delete n._data._cmdList,n._data._ctxCmdList&&delete n._data._ctxCmdList,n._startChannelLoop(n._data.__radioURL),n.resolve(n._data)}).fail(function(e){console.error("Failed for "+t),console.error(e)}),c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){n.execCommand(t)}))}};e&&this.isObject(e)&&e.createWith&&(o.createWith=e.createWith),e&&this.isObject(e)&&e.dataNS&&(o.dataNS=e.dataNS);var s=h(),n=this;return void s.listen(t,o)}if(t){this._data=t;var f=this._findObjects(t);f.then(function(e){t!=e&&(n._data=e),n._data&&(c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){console.log("onValue ",JSON.stringify(t)),n.execCommand(t)}))),n.resolve(n._data)})}}),t.listNamedModels=function(){return f},t.loadRemoteData=function(t){var e=_connectManager().createSocketServer({ip:t.ip,port:t.port}),i=this,n=e.createChannel(t);n.then(function(){n.getFileData(function(t,e){i._data=t;var n=i._findObjects(t);i._data!=n&&(this._data=n),e&&e.length&&e.forEach(function(t){i.execCommand(t,!0)}),i.resolve(i._data)})})},t.loadRemoteUrls=function(){if(o)return o;o=!0;var t=[],e=document.querySelectorAll("[data-src]");console.log("Data src list",e);for(var i=0;i<e.length;i++){var n=e[i],r=function(e){var i=e.getAttribute("data-src"),n=this.parseRemoteUrl(i);t.push(n)};r(n)}return o=t,t},t.moveItemDown=function(t){var e,i=this._find(t);if(i){var n=this._find(i.__p);if(n&&this.isArray(n.data)){e=n.data.indexOf(i);var r=e-1,a=n.data.length;return r>=0&&a>r&&this.execCommand([12,i.__id,r,e,i.__p]),this}}},t.moveItemToPos=function(t,e){var i,n=this._find(t);if(n){var r=this._find(n.__p);if(r&&this.isArray(r.data)){i=r.data.indexOf(n);var a=r.data.length;return e>=0&&a>e&&this.execCommand([12,n.__id,e,i,n.__p]),this}}},t.moveItemUp=function(t){var e,i=this._find(t);if(i){var n=this._find(i.__p);if(n&&this.isArray(n.data)){e=n.data.indexOf(i);var r=e+1,a=n.data.length;return r>=0&&a>r&&(console.log("Got item up into ",r),this.execCommand([12,i.__id,r,e,i.__p])),this}}},t.onValue=function(t,e,i){return this.isFunction(t)?(this._data&&this._onValue(this._data.__id,"change",t),this):this.isFunction(e)?(this._data&&this._onValue(this._data.__id,t,e),this):this._onValue(t,e,i)},t.parseRemoteUrl=function(t){var e=t.split("://"),i=(e.shift(),e.shift()),n=i.split("/"),r=n.shift(),a=r.split(":"),o=a[0],s=a[1],c=n.shift(),f=n.pop(),l=n.join("/"),d={channel:{ip:o,port:s,sandbox:c,path:l,file:f,auth:{u:"abba",p:"nowp"}}};return d},t.push=function(t,i,n){var r=this,a=e();if(this.isObject(t)&&this.isObject(t.data)&&!this.isArray(t.data)){var o=t,s=P(i);return s.then(function(){var t=s._data;r.execCommand([5,n,t.__id,null,o.__id]).then(function(){a.resolve(!0)}),s._moveCmdListToParent(t)}),a}if(this.isObject(t)&&this.isArray(t.data)){console.log("Pushing new object to array, about to create the obj"),console.log("The new data is ",i);var o=t,s=P(i);return s.then(function(){console.log("... got the new data from tmpDoc ");var t=s._data;r.execCommand([7,o.data.length,t.__id,null,o.__id]).then(function(){a.resolve(!0)}),s._moveCmdListToParent(t)}),a}var o=this._getObjectInPath(t);if(o&&this.isArray(o.data)){var s=P(i);s.then(function(){var t=s._data;r.execCommand([7,o.data.length,t.__id,null,o.__id]).then(function(){a.resolve(!0)}),s._moveCmdListToParent(t)})}return a},t.removeItem=function(t){var e=this._find(t);if(console.log("removeItem",e),e&&e.__id){var i=this._find(e.__p);this.isObject(i)&&this.isArray(i.data)&&this.execCommand([8,0,e.__id,null,i.__id])}},t.render=function(t){s||(s=templateCompiler());var e,i=s,n=this;e=this.isObject(t)?t:i.compile(t);var r=i.composeTemplate(n._data,e);return c||(c={}),c[n._data.__id]||(c[n._data.__id]=!0,n.onValue(function(t){n.execCommand(t)})),r},t.renderFrom=function(t,e,i,n){{var r=P(t),a=this;new Date}r.then(function(){console.log("Got the DOC!"),console.log(r);var t="";t=a.isFunction(e)?e():e;var o,s=r.fetch(t),c=!1;s.data.compiledTemplate?(o=JSON.parse(s.data.compiledTemplate),c=!0):o=s.data[i];var f=(new Date,a.render(o));n&&n.appendChild(f),a.isFunction(e)&&e(function(){var t=e(),n=r.fetch(t),o=n.data[i],s=templateCompiler();s.clearTheView(f.getAttribute("data-viewid"));var c=a.render(o);f.parentNode&&(f.parentNode.replaceChild(c,f),f=c)}),c?r.addListener(t+".compiledTemplate",function(t,e){var i=templateCompiler();i.clearTheView(f.getAttribute("data-viewid"));var n=a.render(JSON.parse(e));f.parentNode&&(f.parentNode.replaceChild(n,f),f=n)}):r.addListener(t+"."+i,function(t,e){var i=templateCompiler();i.clearTheView(f.getAttribute("data-viewid"));var n=a.render(e);f.parentNode&&(f.parentNode.replaceChild(n,f),f=n)})})},t.set=function(t,e,i){if(this.isObject(i)){var n=P(i),r=this;n.then(function(){var i=n.getData();console.log("set has now data "),console.log(i),t.data[e]||i.__p||(console.log("going to run the command now"),console.log([5,e,i.__id,null,t.__id]),r.execCommand([5,e,i.__id,null,t.__id]))}).fail(function(t){console.log("creating the object failed "),console.log(t)})}else if(t&&t.data&&t.data[e]!=i){var a=t.data[e];this.execCommand([4,e,i,a,t.__id])}return this},t.setMeta=function(t,e,i){if(this.isObject(t)){t.__meta||(t.__meta={});var n=P(i);t.__meta[e]=n.getData()}},t.setNamedModel=function(t,e){f||(f={}),f[t]=e},t.toPlainData=function(t){if(!this.isObject(t))return t;var e;if(t.getData&&(t=t.getData()),this.isArray(t.data)){e=[];for(var i=t.data.length,n=0;i>n;n++)e[n]=this.toPlainData(t.data[n])}else{e={};for(var r in t.data)t.data.hasOwnProperty(r)&&(e[r]=this.toPlainData(t.data[r]))}return e},t.treeToList=function(t,e){P({list:[]});return this.forTree(function(i){t(i)&&e.data.push(i)}),e},t.unset=function(t,e){return this.isObject(t)||(t=this._find(t)),t&&t.data&&e&&this.execCommand([10,e,null,null,t.__id]),this}}(this)};N.prototype=e.prototype;var P=function(t,e,i,n,r,a,o,s){if(!(this instanceof P))return new P(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=P._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};P._classInfo={name:"_docUp"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_docUp",P),P.prototype=new N,"undefined"!=typeof window&&(window._docUp=P),"undefined"!=typeof window&&(window._docUp_prototype=N);var M=function(){var t=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.cont=function(t){if(this.isArray(t)){var i=this,n=this._list.slice(this._index+1);if(0==n.length)return void this.step();var r=[];t.forEach(function(t){var e=i._list.slice(i._index+1),n=F(i);n.addObserver(e),r.push(n.pushValue(t))});var a=e();a.all(r).then(function(){var t=[];r.forEach(function(e){t.push(e.value())}),i.resolve(t)}),a.resolve(!0)}else"undefined"!=typeof t&&(this._context.value=t),this.step()},t.ctxVar=function(t,e){if("undefined"==typeof e){var i=this._contextVars[t];return"undefined"==typeof i&&this._parent?this._parent.ctxVar(t):i}this._contextVars[t]=e},t.get=function(t){if(this._closure){var e=this._contextVars[t];return"undefined"==typeof e?this._parent.get(t):e}var e=this._contextVars[t];return"undefined"==typeof e&&this._parent?this._parent.get(t):e},t.getRest=function(){},t.getState=function(){return this._stopState},t.getValue=function(){return!this._context&&this._parent?this._parent.getValue():this._context&&!this._context.value&&!this._context.initWith&&this._parent?this._parent.getValue():this._context.value||this._context.initWith},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._context={},this._contextVars={},this._stopState=0,t&&(this._parent=t),e&&(this._closure=!0)}),t.run=function(t){if(this._closure){if(this._parent)return void this._parent.run(t);console.error("No parent for closure"),console.trace()}this._stopState=1,this.cont(t)},t.set=function(t,e){if("undefined"!=typeof e){if(this._closure)if("undefined"!=typeof this._contextVars[t])this._contextVars[t]=e;else if(this._parent)return this._parent.set(t,e),this;return"undefined"==typeof this._contextVars[t]&&this._parent?(this._parent.set(t,e),this):(this._contextVars[t]=e,this)}},t.setContext=function(t){this._context=t},t.setParent=function(t){this._parent=t},t.start=function(t){this._list=t,this._index=-1,this.step()},t.step=function(){this._index++;var t=this._index;if(this._list[t]){var e=this._list[t];this.isObject(e)&&!this.isFunction(e)?e.closure?(e.closure.setParent(this),e.fn(e.closure)):e.fn(this):e(this)}else"undefined"==typeof this._context.value&&(this._context.value=this._context.initWith),this._stopState<2&&(this._stopState=7),this.resolve(this._context.value)},t.stopStream=function(){this._context.value||(this._context.value=this._context.initWith),this._stopState=3,this.resolve(this._context.value)}}(this)};t.prototype=e.prototype;var i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"streamProcessor"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("streamProcessor",i),i.prototype=new t,"undefined"!=typeof window&&(window.streamProcessor=i),"undefined"!=typeof window&&(window.streamProcessor_prototype=t),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var n;t.addObserver=function(t,e){if(this.isArray(t)){var i=this;return void t.forEach(function(t){i.addObserver(t,e)})}return this.isObject(t)&&!this.isFunction(t)?void this._observers.push(t):(this._observers.push({fn:t,closure:e}),this)},t.branch=function(t,e){var i=this,n=(new Date).getTime();return i._lastBranch=n,this.addObserver(function(r){var a=((new Date).getTime(),r.getValue());setTimeout(function(){var o=(new Date).getTime();if(!(e>o-n)){var s=0;(s=i.isActiveRunning())||(r=i.getLastProcess(),3==r.getState()&&(i._lastBranch=o,n=o,t(a)))}},e),r.run()}),this},t.branchIfOk=function(t,e){var i=this,n=(new Date).getTime();return i._lastBranch=n,this.addObserver(function(r){var a=((new Date).getTime(),r.getValue());setTimeout(function(){var o=(new Date).getTime();if(!(e>o-n)){var s=0;(s=i.isActiveRunning())||(r=i.getLastProcess(),7==r.getState()&&(i._lastBranch=o,n=o,t(a)))}},e),r.run()}),this},t.collectValuesFor=function(t){var e=this,i=(new Date).getTime();return e._lastBranch=i,this.addObserver(function(n){(new Date).getTime(),n.getValue();setTimeout(function(){var r=(new Date).getTime();if(!(t>r-i)){var a=e.isActiveRunning(),o=e.getLastProcess();return a>1&&n!=o?void n.stopStream(n.getValue()):void o.run()}},t)}),this},t.combineLatest=function(t){var e=this,i=[],n=t.length,r=function(){for(var t=!0,e=0;n>e;e++)"undefined"==typeof i[e]&&(t=!1);return t};return t.forEach(function(t,n){t.addObserver(function(t){i[n]=t.getValue(),r()&&e.pushValue(i),t.run()})}),this},t.filter=function(t){var e=this;return this.addObserver(function(i){var n=i.getValue(),r=[];return e.isArray(n)?(n.forEach(function(e){t(e)&&r.push(e)}),void(r.length?i.run(r):i.stopStream())):t(n)?void i.run(n):void i.stopStream()}),this},t.forContext=function(t){var e=this;e.addObserver(function(i){var n=i.getValue(),r=[];e.isArray(n)?n.forEach(function(e,n){r.push(t(e,n,i))}):r.push(t(n,0,i)),i.run(n)})},t.forEach=function(t){var e=this;return e.addObserver(function(i){var n=i.getValue(),r=[];e.isArray(n)?n.forEach(function(e){r.push(t(e))}):r.push(t(n)),i.run(n)}),this},t.getLastProcess=function(){var t=this._active.length;return t>0?this._active[t-1]:this._lastProcess},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._childIndex=0,this._childStreams=[],this._values=[],this._active=[],this._lastProcess,this._observers=[],this._id=this.guid(),n||(n={}),n[this._id]=this,t&&(this._parentProcessor=t)}),t.isActiveRunning=function(){return this._active.length},t.map=function(t){var e=this;return e.addObserver(function(i){var n=i.getValue(),r=[];e.isArray(n)?n.forEach(function(e){r.push(t(e))}):r.push(t(n)),i.run(r)}),this},t.pushValue=function(t){var i=e();return this.startProcess({initWith:t},i),i},t.reduce=function(t,e){var i=this;return i.addObserver(function(n){var r=n.getValue(),a=[];a=i.isArray(r)?r.reduce(t,e):[r].reduce(t,e),n.run(a)}),this},t.startProcess=function(t,e){var n=this._observers.slice(),r=i(this._parentProcessor);r.setContext(t),r.start(n),this._active.push(r);var a=this;r.then(function(t){var i=a._active.indexOf(r);a._active.splice(i,1),e.resolve(t),a._lastProcess=r})},t.step=function(){}}(this)},F=function(t,e,i,n,r,a,o,s){if(!(this instanceof F))return new F(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=F._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};F._classInfo={name:"simpleStream"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("simpleStream",F),F.prototype=new M,"undefined"!=typeof window&&(window.simpleStream=F),"undefined"!=typeof window&&(window.simpleStream_prototype=M);var L=function(){var t=function(){!function(t){t.attr=function(t,e){if(this._host._svgElem){if(this._host.isArray(e)){var i,n=e[0],r=e[1],a=n[r](),o=this,s=o._dom,c=this._host;return i="xlink:href"==t?c.uniqueListener("attr:"+t,function(t,e){"undefined"!=typeof e&&null!==e&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",e)}):c.uniqueListener("attr:"+t,function(e,i){"undefined"!=typeof i&&null!==i&&s.setAttributeNS(null,t,i)}),n.on(r,i),"undefined"!=typeof a&&null!==a&&("xlink:href"==t?this._dom.setAttributeNS("http://www.w3.org/1999/xlink","href",a):this._dom.setAttributeNS(null,t,a)),this}if(this._host.isFunction(e)){var i,a=e(),n=e(null,!0),o=this,s=o._dom,c=this._host;return i="xlink:href"==t?c.uniqueListener("attr:"+t,function(t,e){"undefined"!=typeof e&&null!==e&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",e)}):c.uniqueListener("attr:"+t,function(e,i){"undefined"!=typeof i&&null!==i&&s.setAttributeNS(null,t,i)}),n.me.on(n.name,i),"undefined"!=typeof a&&null!==a&&("xlink:href"==t?this._dom.setAttributeNS("http://www.w3.org/1999/xlink","href",a):this._dom.setAttributeNS(null,t,a)),this}return"undefined"!=typeof e&&("xlink:href"==t?this._dom.setAttributeNS("http://www.w3.org/1999/xlink","href",e):this._dom.setAttributeNS(null,t,e)),this}if(this._host.isFunction(e)){var a=e(),n=e(null,!0),o=this,s=o._dom,c=this._host,i=c.uniqueListener("attr:"+t,function(e,i){"undefined"!=typeof i&&s.setAttribute(t,i)});return n.me.on(n.name,i),"undefined"!=typeof a&&this._dom.setAttribute(t,a),this}return"undefined"!=typeof e&&this._dom.setAttribute(t,e),this},t.bindSysEvent=function(t,e,i){if(t=t.toLowerCase(),this._sys||(this._sys={}),this._sys[t])return!1;this._sys[t]=!0;var n=this;return this._dom.attachEvent?this._dom.attachEvent("on"+t,function(t){t=t||window.event,n._event=t,e(),i&&(t=window.event,t&&(t.cancelBubble=!0))}):this._dom.addEventListener(t,function(t){t=t||window.event,n._event=t,i&&(t&&t.stopPropagation?t.stopPropagation():(t=window.event,t.cancelBubble=!0)),e()}),!0},t.blur=function(){this._dom.blur&&this._dom.blur()},t.css=function(t,e){return"background-color"==t&&(t="backgroundColor"),"margin-left"==t&&(t="marginLeft"),"font-size"==t&&(t="fontSize",e=this.pxParam(e)),("left"==t||"top"==t||"bottom"==t||"right"==t||"width"==t||"height"==t)&&(e=this.pxParam(e)),e.substring&&"NaN"==e.substring(0,3)?void 0:(this._dom.style[t]=e,this)},t.focus=function(){this._dom.focus&&this._dom.focus()},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this._dom=t,this._host=e}),t.pxParam=function(t){if("auto"==t)return t;if("undefined"!=typeof t.slice){if("%"==t.slice(-1))return t;if("em"==t.slice(-2))return t;if("px"==t.slice(-2))return t}if(isNaN(parseInt(t)))return"";if("string"==typeof t)return parseInt(t)+"px";var e=parseInt(t);return isNaN(e)?void 0:e+"px"}}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"_qc"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_qc",i),i.prototype=new t;var n=function(){!function(t){var e,i,n,r,a;t.add=function(t,e,n){if(e||n){var r;"[object Array]"===Object.prototype.toString.call(n)?r=n:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),i.push([e,t,r])}else i.push(t)},t.after=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,e,i){i||(i="time"+(new Date).getTime()+Math.random(1e7)),r[i]={step:Math.floor(1e3*t),fn:e,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!e){this.polyfill();
var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(e){t||(t=window[e+"RequestAnimationFrame"],o=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),i=[],n={},r={},a=[];var s=0,c=function(){for(var e,o=(new Date).getTime();e=i.shift();)"[object Array]"===Object.prototype.toString.call(e)?e[1].apply(e[0],e[2]):e();for(var f=0;f<a.length;f++){var l=a[f];l()}for(var d in n)if(n.hasOwnProperty(d)){var h=n[d];h[0](h[1]),delete n[d]}for(var d in r)if(r.hasOwnProperty(d)){var h=r[d];h.nextTime<o&&(h.remove?h.nextTime>0?(h.fn(),delete r[d]):h.nextTime=o+h.step:(h.fn(),h.nextTime=o+h.step)),h.until&&h.until<o&&delete r[d]}t(c),s=o};c(),e=!0}}),t.once=function(t,e,i){n[t]=[e,i]},t.onFrame=function(t){a.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var e=a.indexOf(t);return e>=0?(t._onRemove&&t._onRemove(),a.splice(e,1),!0):!1}}(this)},r=function(t,e,i,n,a,o,s,c){if(!(this instanceof r))return new r(t,e,i,n,a,o,s,c);var f=[t,e,i,n,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=r._classInfo.name)return new l(t,e,i,n,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"later"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("later",r),r.prototype=new n,"undefined"!=typeof window&&(window.later=r),"undefined"!=typeof window&&(window.later_prototype=n);var a=function(){!function(t){var e,i;t.arcTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.bezierCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.copyFrom=function(t){t.m&&(t=t.m);for(var e=this.m,i=!1,n=0;6>n;n++)e[n]!=t[n]&&(i=!0);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],i},t.fillStyle=function(t){this.setStyle("fillStyle",t)},t.font=function(t){var e=t.split(" ");this.setStyle("font-size",e[0]),this.setStyle("font-family",e[1])},t.getStyle=function(t){var e=this._fillState[this._fillState.length-1];return e?e[t]:void 0},t.getSvgTransform=function(){var t=this.m;return"matrix("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+")"},t.globalAlpha=function(t){this.setStyle("globalAlpha",t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(i={x:0,y:0}),this.reset(),this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0}}),t.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=o},t.lineTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.lineWidth=function(t){this.setStyle("lineWidth",t)},t.moveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=o},t.quadraticCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.reset=function(){if(this.m){var t=this.m;t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this._point.x=0,this._point.y=0,this._point.tx1=0,this._point.ty1=0,this._point.tx0=0,this._point.ty0=0}else this.m=[1,0,0,1,0,0],this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0};this._fillState=[{globalAlpha:1,fillStyle:"none",strokeStyle:"black","font-size":10,lineWidth:1,"font-family":"Arial"}]},t.restore=function(){this.m=this._oldies.pop(),this._fillState.pop()},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,r=this.m[1]*e+this.m[3]*i,a=this.m[0]*-i+this.m[2]*e,o=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=o},t.rotateAround=function(t,e,i){this.translate(t,e),this.rotate(i*Math.PI/180),this.translate(-t,-e)},t.save=function(){var t=this.m.slice(0);this._oldies||(this._oldies=[]),this._oldies.push(t);var e=this._fillState[this._fillState.length-1],i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);this._fillState.push(i)},t.scale=function(t,e){isNaN(t)||isNaN(e)||(this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e)},t.setStyle=function(t,e){var i=this._fillState[this._fillState.length-1];i&&(i[t]=e)},t.strokeStyle=function(t){this.setStyle("strokeStyle",t)},t.transformDelta=function(t,e){return i.x=t*this.m[0]+e*this.m[2],i.y=t*this.m[1]+e*this.m[3],i},t.transformPoint=function(t,e){var n=t,r=e;return i.x=n*this.m[0]+r*this.m[2]+this.m[4],i.y=n*this.m[1]+r*this.m[3]+this.m[5],i},t.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},t.translateAbsolute=function(t,e){this.m[4]=this.m[0]*t+this.m[2]*e,this.m[5]=this.m[1]*t+this.m[3]*e},t.updateContext=function(t){var e=this.m;t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},t.xScaleFactor=function(){var t=this.m[0],e=this.m[2];return Math.sqrt(t*t+e*e)}}(this)},s=function(t,e,i,n,r,a,o,c){if(!(this instanceof s))return new s(t,e,i,n,r,a,o,c);var f=[t,e,i,n,r,a,o,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=s._classInfo.name)return new l(t,e,i,n,r,a,o,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"ocTransform"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("ocTransform",s),s.prototype=new a;var c=function(){var t=function(){!function(t){var e;t.colorMix=function(t,e,i){var n=this.toRGB(t),r=this.toRGB(e),a=this.yuvConversion2(n,r,function(t,e){return{y:(1-i)*t.y+i*e.y,u:(1-i)*t.u+i*e.u,v:(1-i)*t.v+i*e.v}});return a},t.colorToHex=function(t){if("#"===t.substr(0,1))return t;var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),i=parseInt(e[2]),n=parseInt(e[3]),r=parseInt(e[4]),a=r|n<<8|i<<16;return e[1]+"#"+a.toString(16)},t.colourNameToHex=function(t){return"undefined"!=typeof e[t.toLowerCase()]?e[t.toLowerCase()]:!1},t.componentToHex=function(t){t=parseInt(t);var e=t.toString(16);return 1==e.length?"0"+e:e},t.hexToRgb=function(t){if("#"==t[0]&&(t=t.substr(1)),3==t.length){var e=t;t="",e=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(e).slice(1);for(var i=0;3>i;i++)t+=e[i]+e[i]}if(!t)return null;if(null!=t){var n=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(t).slice(1);return{r:parseInt(n[0],16),g:parseInt(n[1],16),b:parseInt(n[2],16)}}},t.hexToYuv=function(t){var e=this;return e.rgbToYuv(e.toRGB(t))},t.hsvToRgb=function(t){var e,i,n,r,a,o,s,c,f=Math.max(0,Math.min(360,t.h)),l=Math.max(0,Math.min(100,t.s)),d=Math.max(0,Math.min(100,t.v));if(l/=100,d/=100,0==l)return e=i=n=d,{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*n)};switch(f/=60,r=Math.floor(f),a=f-r,o=d*(1-l),s=d*(1-l*a),c=d*(1-l*(1-a)),r){case 0:e=d,i=c,n=o;break;case 1:e=s,i=d,n=o;break;case 2:e=o,i=d,n=c;break;case 3:e=o,i=s,n=d;break;case 4:e=c,i=o,n=d;break;default:e=d,i=o,n=s}return{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*n)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e={none:"#ffffff",aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}}),t.rgbToHex=function(t){var e=this;return"#"+e.componentToHex(t.r)+e.componentToHex(t.g)+e.componentToHex(t.b)},t.rgbToHsv=function(t){var e,i,n,r,a,o=t.r/255,s=t.g/255,c=t.b/255,f=Math.max(o,s,c),l=f-Math.min(o,s,c),d=function(t){return(f-t)/6/l+.5};return 0==l?r=a=0:(a=l/f,e=d(o),i=d(s),n=d(c),o===f?r=n-i:s===f?r=1/3+e-n:c===f&&(r=2/3+i-e),0>r?r+=1:r>1&&(r-=1)),{h:Math.round(360*r),s:Math.round(100*a),v:Math.round(100*f)}},t.rgbToYuv=function(t){var e=t.r/255,i=t.g/255,n=t.b/255;return{y:.299*e+.587*i+.114*n,u:-.14713*e-.28885*i+.436*n,v:.615*e-.51499*i-.10001*n}},t.toRGB=function(t){if("object"==typeof t)return t;var e=this,i=e.colourNameToHex(t);return i||(i=e.colorToHex(t)),e.hexToRgb(i)},t.toRSpace=function(t){return Math.max(0,Math.min(255,Math.round(t)))},t.yuvConversion=function(t,e){var i=this,n=i.rgbToYuv(i.toRGB(t));n=e(n);var r=i.yuvToRgb(n);return i.rgbToHex(r)},t.yuvConversion2=function(t,e,i){var n=this,r=n.rgbToYuv(n.toRGB(t)),a=n.rgbToYuv(n.toRGB(e));r=i(r,a);var o=n.yuvToRgb(r);return n.rgbToHex(o)},t.yuvPixelConversion=function(t,e){var i=me.rgbToYuv(t);i=e(i);var n=me.yuvToRgb(i);return t.r=n.r,t.g=n.g,t.b=n.b,t},t.yuvToRgb=function(t){var e=t.y,i=t.u,n=t.v;return{r:this.toRSpace(255*(e+0*i+1.13983*n)),g:this.toRSpace(255*(e-.39465*i-.5806*n)),b:this.toRSpace(255*(e+2.03211*i))}}}(this),function(t){t.add=function(t,e){var i=this.toRGB(t),n=i.r+":"+i.g+":"+i.b;return this._colorIndex[n]=e,!0},t.find=function(t){var e=this.toRGB(t),i=e.r+":"+e.g+":"+e.b;return this._colorIndex[i]},t.getIndex=function(){return this._colorIndex},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._colorIndex={}})}(this)},i=function(t,e,n,r,a,o,s,c){if(!(this instanceof i))return new i(t,e,n,r,a,o,s,c);var f=[t,e,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=i._classInfo.name)return new l(t,e,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"ocColorIndex"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("ocColorIndex",i),i.prototype=new t;var n=function(){!function(t){t.directionVector=function(){var t=Math.PI*this._angle/180,e={i:Math.cos(t),j:Math.sin(t)};return e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e,i){this._ctx=t,this._w=e||100,this._h=i||100,this._x=.5,this._y=1,this._angle=90}),t.line=function(t,e,i){this.turn(t);var n=this.stepVector(e/2,i),r=this.stepVector(e,0);return this._ctx.quadraticCurveTo(n.x,n.y,r.x,r.y),this._x=r.x,this._y=r.y,this},t.startFrom=function(t,e){return this._x=t,this._y=e,this._ctx.moveTo(this._x,this._y),this},t.stepVector=function(t,e){e||(e=0);var i=Math.PI*(this._angle+e)/180,n={x:this._x+Math.cos(i)*t,y:this._y+Math.sin(i)*t};return console.log(n),n},t.turn=function(t){return t?"left"==t?(this._angle=180,this):"right"==t?(this._angle=0,this):"up"==t?(this._angle=90,this):"down"==t?(this._angle=-90,this):(this._angle+=t,this):this}}(this)},a=function(t,e,i,n,r,o,s,c){if(!(this instanceof a))return new a(t,e,i,n,r,o,s,c);var f=[t,e,i,n,r,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=a._classInfo.name)return new l(t,e,i,n,r,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};a._classInfo={name:"ocPaintHead"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("ocPaintHead",a),a.prototype=new n;var o=function(){!function(t){t.arrow=function(t){var e=.5;this.symmetricPath({start:{x:t.start.x,y:t.start.y,bend:-.1},points:[{xstep:.15,ystep:.15*e,bend:-.1},{xstep:.12,ystep:.03*e,bend:0},{xstep:1,ystep:.08*e,bend:-.2}],end:{x:t.end.x,y:t.end.y}})},t.dynArrow=function(t){var e=.5,i=function(){return{start:{x:t.start.x(),y:t.start.y()},points:[{xstep:.15,ystep:.15*e,bend:-.1},{xstep:.12,ystep:.03*e,bend:0},{xstep:1,ystep:.08*e,bend:-.2}],end:{x:t.end.x(),y:t.end.y()}}},n=f(),r=n.shapes(),a=_data({svgPath:""}),o=D("g"),s="yellow";t.fill&&(s=t.fill);var c=(o.path("",{d:a.svgPath,fill:s}),function(){n.clear();var t=i();r.symmetricPath(t);var e=n.svgPathString();a.svgPath(e)});return c(),t.onValue("childChange",function(){c()}),o},t.dynPath=function(t){var e=f(),i=e.shapes(),n=_data({svgPath:""}),r="purple";t.fillStyle&&(r=t.fillStyle());var a=D("g"),o=(a.path("",{d:n.svgPath,fill:r}),function(){e.clear(),i.pathDyn(t);var r=e.svgPathString();n.svgPath(r)});return o(),t.onValue("childChange",function(){o()}),a},t.dynShape=function(t){var e=f(),i=e.shapes(),n=_data({svgPath:""}),r="purple";t.fillStyle&&(r=t.fillStyle());var a=D("g"),o=(a.path("",{d:n.svgPath,fill:r}),function(){e.clear(),i.symmetricPathDyn(t);var r=e.svgPathString();n.svgPath(r)});return o(),t.onValue("childChange",function(){o()}),a},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._ctx=t}),t.line=function(t,e,i){this.turn(t);var n=this.stepVector(e/2,i),r=this.stepVector(e,0);return this._ctx.quadraticCurveTo(n.x,n.y,r.x,r.y),this._x=r.x,this._y=r.y,this},t.lineBetween=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=Math.sqrt(i*i+n*n),a=i/r,o=n/r,s=-n/r,c=i/r,f=0;t.bend&&(f=t.bend);var l=r/2,d=r*f,h=t.x+a*l+d*s,u=t.y+o*l+d*c;this._ctx.quadraticCurveTo(h,u,e.x,e.y)},t.pathDyn=function(t){var e=this._ctx;e.moveTo(t.start.x(),t.start.y());var i=t.end.x()-t.start.x(),n=t.end.y()-t.start.y(),r=(Math.sqrt(i*i+n*n),i),a=n,o=t.start.x(),s=t.start.y(),c=-n,f=i,l=t.points.length()+2,d=new Array(l);d[0]={x:t.start.x(),y:t.start.y()},t.start.bend&&(d[0].bend=t.start.bend()),d[l-1]=d[0];for(var h=0;h<t.points.length();h++){var u=t.points.item(h),_={x:o+u.xstep()*r+u.ystep()*c,y:s+u.xstep()*a+u.ystep()*f};u.bend&&(_.bend=u.bend()),d[h+1]=_}for(var h=0;h<d.length-1;h++)this.lineBetween(d[0+h],d[1+h])},t.startFrom=function(t,e){return this._x=t,this._y=e,this._ctx.moveTo(this._x,this._y),this},t.stepVector=function(t,e){e||(e=0);var i=Math.PI*(this._angle+e)/180,n={x:this._x+Math.cos(i)*t,y:this._y+Math.sin(i)*t};return console.log(n),n},t.svgArrow=function(t){var e=f(this._ctx);e.save(),e.beginPath(),e.fillStyle(t.fillStyle||"#449944"),e.lineWidth(t.lineWidth||1);var i=e.shapes();i.arrow({start:{x:t.start.x||30,y:t.start.y||30},end:{x:t.end.x||160,y:t.end.y||190}}),e.fill(),e.stroke(),e.restore();var n=e.renderSvg(testOut||D().g());return n},t.symmetricPath=function(t){var e=this._ctx;e.moveTo(t.start.x,t.start.y);var i=t.end.x-t.start.x,n=t.end.y-t.start.y,r=(Math.sqrt(i*i+n*n),i),a=n,o=t.start.x,s=t.start.y,c=-n,f=i,l=t.points.length+1,d=new Array(2*l);d[0]=t.start,d[2*l-1]=t.start;for(var h=0;h<t.points.length;h++){var u=t.points[h];u.x=o+u.xstep*r+u.ystep*c,u.y=s+u.xstep*a+u.ystep*f,d[h+1]=u;var _={};_.x=o+u.xstep*r-u.ystep*c,_.y=s+u.xstep*a-u.ystep*f,_.bend=d[h].bend,d[2*l-2-h]=_}for(var h=0;h<d.length-1;h++)this.lineBetween(d[0+h],d[1+h])},t.symmetricPathDyn=function(t){var e=this._ctx;e.moveTo(t.start.x(),t.start.y());var i=t.end.x()-t.start.x(),n=t.end.y()-t.start.y(),r=(Math.sqrt(i*i+n*n),i),a=n,o=t.start.x(),s=t.start.y(),c=-n,f=i,l=t.points.length()+1,d=new Array(2*l);d[0]={x:t.start.x(),y:t.start.y()},t.start.bend&&(d[0].bend=t.start.bend()),d[2*l-1]=d[0];for(var h=0;h<t.points.length();h++){var u=t.points.item(h),_={x:o+u.xstep()*r+u.ystep()*c,y:s+u.xstep()*a+u.ystep()*f};u.bend&&(_.bend=u.bend()),d[h+1]=_;var p={x:o+u.xstep()*r-u.ystep()*c,y:s+u.xstep()*a-u.ystep()*f};p.bend=d[h].bend,d[2*l-2-h]=p}for(var h=0;h<d.length-1;h++)this.lineBetween(d[0+h],d[1+h])},t.turn=function(t){return t?"left"==t?(this._angle=180,this):"right"==t?(this._angle=0,this):"up"==t?(this._angle=90,this):"down"==t?(this._angle=-90,this):(this._angle+=t,this):this}}(this)},s=function(t,e,i,n,r,a,o,c){if(!(this instanceof s))return new s(t,e,i,n,r,a,o,c);var f=[t,e,i,n,r,a,o,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=s._classInfo.name)return new l(t,e,i,n,r,a,o,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};s._classInfo={name:"ocPathLib"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("ocPathLib",s),s.prototype=new o;var c=function(){!function(t){var e,i;t.arcTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.bezierCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.copyFrom=function(t){t.m&&(t=t.m);for(var e=this.m,i=!1,n=0;6>n;n++)e[n]!=t[n]&&(i=!0);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],i},t.fillStyle=function(t){this.setStyle("fillStyle",t)},t.font=function(t){var e=t.split(" ");this.setStyle("font-size",e[0]),this.setStyle("font-family",e[1])},t.getStyle=function(t){var e=this._fillState[this._fillState.length-1];return e?e[t]:void 0},t.getSvgTransform=function(){var t=this.m;return"matrix("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+")"},t.globalAlpha=function(t){this.setStyle("globalAlpha",t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(i={x:0,y:0}),this.reset(),this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0}}),t.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=o},t.lineTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.lineWidth=function(t){this.setStyle("lineWidth",t)},t.moveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=o},t.quadraticCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var e=this.transformPoint(this._point.x,this._point.y);this._point.tx1=e.x,this._point.ty1=e.y},t.reset=function(){if(this.m){var t=this.m;t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this._point.x=0,this._point.y=0,this._point.tx1=0,this._point.ty1=0,this._point.tx0=0,this._point.ty0=0}else this.m=[1,0,0,1,0,0],this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0};this._fillState=[{globalAlpha:1,fillStyle:"none",strokeStyle:"black","font-size":10,lineWidth:1,"font-family":"Arial"}]},t.restore=function(){this.m=this._oldies.pop(),this._fillState.pop()},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,r=this.m[1]*e+this.m[3]*i,a=this.m[0]*-i+this.m[2]*e,o=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=o},t.rotateAround=function(t,e,i){this.translate(t,e),this.rotate(i*Math.PI/180),this.translate(-t,-e)},t.save=function(){var t=this.m.slice(0);this._oldies||(this._oldies=[]),this._oldies.push(t);var e=this._fillState[this._fillState.length-1],i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);this._fillState.push(i)},t.scale=function(t,e){isNaN(t)||isNaN(e)||(this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e)},t.setStyle=function(t,e){var i=this._fillState[this._fillState.length-1];i&&(i[t]=e)},t.strokeStyle=function(t){this.setStyle("strokeStyle",t)},t.transformDelta=function(t,e){return i.x=t*this.m[0]+e*this.m[2],i.y=t*this.m[1]+e*this.m[3],i},t.transformPoint=function(t,e){var n=t,r=e;return i.x=n*this.m[0]+r*this.m[2]+this.m[4],i.y=n*this.m[1]+r*this.m[3]+this.m[5],i},t.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},t.translateAbsolute=function(t,e){this.m[4]=this.m[0]*t+this.m[2]*e,this.m[5]=this.m[1]*t+this.m[3]*e},t.updateContext=function(t){var e=this.m;t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])},t.xScaleFactor=function(){var t=this.m[0],e=this.m[2];return Math.sqrt(t*t+e*e)}}(this)},l=function(t,e,i,n,r,a,o,s){if(!(this instanceof l))return new l(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,d=this;if(this.__factoryClass.forEach(function(t){f=t.apply(d,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=l._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};l._classInfo={name:"ocTransform"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("ocTransform",l),l.prototype=new c,function(t){var i,n,r,a;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(n={},r={},a={},i=!0)}),t.promiseImage=function(t){var i=e();if(n[t])return i.resolve(n[t]),r[t]=!1,i;if(a[t]||(a[t]=[]),a[t].push(i),r[t])return i;r[t]=!0;var o=new Image;return o.addEventListener("load",function(){n[t]=o;for(var e;e=a[t].pop();)e.resolve(o);r[t]=!1}),o.src=t,i}}(this),function(t){t.add=function(t,e){return e?(this.hasOwnProperty("_inserts")||(this._inserts={}),this._inserts[t]||(this._inserts[t]=[]),e.parent(this),void this._inserts[t].push(e)):void this.add("children",t)},t.addClipMask=function(t){this.hasOwnProperty("_clipMasks")||(this._clipMasks=[]),this._clipMasks.push(t)},t.autoRender=function(){if(!this._autoRender){var t=this;this._autoRender=!0,r().every(1/60,function(){t.isDirty()&&(t.reset(),t.exec(),t.isDirty(!1))})}},t.clear=function(){this._commands=[],this._inserts={}},t.createColorIndex=function(){return i()},t.createHandle=function(t){this._colorIndex||(this._colorIndex=this.createColorIndex());var e=this._colorIndex,i=function(t,i,n,r,a,o){var s=t.create("handleCtx");s.save(),s.beginPath(),o._x=i,o._y=n,o.ctx=s,o.color=a,o.position=s.create("position"),o.position.translate(i,n),s.insert("shape"),s.add("shape",r),s.fillStyle(a),s.fill(),s.restore(),s.stroke(),e.add(a,o)},n=D();i(this,t.x||0,t.y||0,t.shape,t.color,t.obj);var r=this;if(n._handleData=t,t.obj.handleObj=n,n.moveToPoint=function(e){t.obj.position.replace("translate",e.x,e.y)},!this._dragSet&&this._canvas){var a=this._canvas;this._dragSet=!0;var o;a.draggable(function(t,i){if(o=e.find(r.getPixel(i.x,i.y))){var n=o.handleObj;o.ctx.replace("fillStyle","yellow"),n.trigger("startdrag",i)}},function(t,e){if(o){var i=o.handleObj;o.position.replace("translate",o._x+e.dx,o._y+e.dy),o.ctx.replace("fillStyle","yellow"),i.trigger("drag",e)}},function(t,e){if(o){var i=o.handleObj;o.ctx.replace("fillStyle",o.color),o._x=o._x+e.dx,o._y=o._y+e.dy,i.trigger("enddrag",e)}})}return n},t.exec=function(t){t||(t=this._ctx),t._ctx&&(t=t._ctx);var e=this;this._commands.forEach(function(i){var n=i[0],r=i[1];if("circle"==n){var a=r[0],o=r[1],s=r[2];return void t.arc(a,o,s,0,2*Math.PI,!1)}if("drawImage"==n){var c=r[0];return void(c===Object(c)?t[n].apply(t,r):e.promiseImage(c).then(function(e){console.log("image loaded ok"),console.log(e),console.log(typeof e),r[0]=e,t[n].apply(t,r)}))}if("insert"==n)return void e.forInserts(r[0],function(e){e.exec(t)});if("clipMask"==n)return void e.forClipMasks(function(e){e.exec(t)});if("children"==n)return void e.forChildren(function(e){e.exec(t)});if("setProperty"==n){var f=r[0],l=r[1];t[f]=l}else t[n].apply(t,r)})},t.execFn=function(t,e){var i=e||this._transform;e||i.reset();var n=this;this._commands.forEach(function(e){var r=e[0],a=e[1];if("insert"==r)return void n.forInserts(a[0],function(e){e.execFn(t,i)});if("clipMask"==r)return void n.forClipMasks(function(e){e.execFn(t,i)});if("children"==r)return void n.forChildren(function(e){e.execFn(t,i)});if("setProperty"==r){var o=a[0],s=a[1];t(o,a,i),i[o]&&i[o].apply(i,[s])}else i[r]&&i[r].apply(i,a),t(r,a,i)})},t.forChildren=function(t){this.forInserts("children",t)},t.forClipMasks=function(t){this.forInserts("clipMask",t)},t.forInserts=function(t,e){this._inserts&&this._inserts[t]&&this._inserts[t].forEach(e)},t.getPixel=function(t,e){return this._ctx?(data=this._ctx.getImageData(t,e,1,1).data,data?{x:t,y:e,r:data[0],g:data[1],b:data[2],a:data[3]}:null):null},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._commands||(this._commands=[]),this._undoBuffer=[],this._ctx=t,this._transform=new l;var e=this,i=["rect","fillRect","strokeRect","clearRect","fill","stroke","beginPath","moveTo","closePath","lineTo","clip","quadraticCurveTo","bezierCurveTo","arc","arcTo","scale","rotate","translate","transform","setTransform","fillText","strokeText","createImageData","putImageData","drawImage","circle","save","restore","setTransform"],n=["createLinearGradient","createPattern","createRadialGradient","addColorStop","isPointInPath","measureText","getImageData","toDataURL"],a=["width","height","data"],o=["globalAlpha","fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","font","textAlign","textBaseline","lineCap","lineJoin","lineWidth","miterLimit"],s=(new Date).getTime();r().onFrame(function(){s=(new Date).getTime()}),e.insert=function(){var t=Array.prototype.slice.call(arguments);return e._commands.push(["insert",t,s]),f()},e.create=function(){var t=Array.prototype.slice.call(arguments);e._commands.push(["insert",t,s]);var i=f();return e.add(t[0],i),i},e.clipMask=function(){e.insert("clipMask")},e.children=function(){e.insert("children")},i.forEach(function(t){e[t]=function(){e._undoBuffer=[];var i=Array.prototype.slice.call(arguments);e._commands.push([t,i,s])}}),n.forEach(function(i){e[i]=function(){var e=Array.prototype.slice.call(arguments);return t[i].apply(t,e)}}),a.forEach(function(t){e[t]=function(){return e._ctx[t]}}),o.forEach(function(t){e[t]=function(i){return"undefined"!=typeof i?(e._commands.push(["setProperty",[t,i],s]),e):e._ctx[t]}})}),t.isDirty=function(t){if("undefined"!=typeof t){this._dirty=t;var e;return(e=this.parent())&&e.isDirty(!0),this}return this._dirty},t.paintHead=function(){return a(this)},t.parent=function(t){return"undefined"!=typeof t?(this._parent=t,this):this._parent},t.redo=function(){if(this._commands){var t,e=this._undoBuffer.pop();if(e){for(t=e[2];e&&e[2]==t;)this._commands.push(e),e=this._undoBuffer.pop();e&&this._undoBuffer.push(e)}}},t.renderPath=function(t,e,i){var n=d();n.parse(t),n.makePathAbsolute(),n.fitPathInto(e,i),n.drawPath(this)},t.renderSvg=function(t){var e,i=[],n=null,r=null,a=!1,o=this,s="black";e=t?t.g():D().g();return o.execFn(function(t,o,c){if("beginPath"==t&&(i=[],a=!1,s="none",n=e.path("",{d:"",stroke:c.getStyle("strokeStyle"),fill:c.getStyle("fillStyle"),"fill-opacity":c.getStyle("globalAlpha")})),"drawImage"==t&&(i=[],n=e.image("",{"xlink:href":o[0],x:o[1],y:o[2],width:o[3],height:o[4]})),"circle"==t&&(i=[],n=e.circle("",{cx:o[0],cy:o[1],r:o[2],transform:c.getSvgTransform(),stroke:c.getStyle("strokeStyle"),fill:c.getStyle("fillStyle")})),"rect"==t&&(i=[],n=e.rect("",{x:o[0],y:o[1],width:o[2],height:o[3],transform:c.getSvgTransform(),stroke:c.getStyle("strokeStyle"),fill:c.getStyle("fillStyle")})),"arc"==t){var f=c.transformPoint(o[0],o[1]),l=f.x,d=f.y,h=c.transformDelta(o[2],o[2]);
d-=h.y,i.push("M "+l+" "+d),i.push("A "+h.x+","+h.y+" 0 1,0 "+(l+.1)+" "+d+" ")}if("fillText"==t){var u=o[0],f=c.transformPoint(o[1],o[2]),l=f.x,d=f.y,h=c.transformDelta(parseInt(c.getStyle("font-size")),parseInt(c.getStyle("font-size"))),_=h.x,p=c.getStyle("font-family");n=e.svg_text("",{x:o[1],y:o[2]}),n.text(u),n.q.attr("font-size",parseInt(c.getStyle("font-size"))),n.q.attr("font-family",p),n.q.attr("fill",c.getStyle("fillStyle")),n.q.attr("fill-opacity",c.getStyle("globalAlpha")),n.q.attr("transform",c.getSvgTransform()),a=!1,i=[],n=null}if("strokeText"==t){var u=o[0],f=c.transformPoint(o[1],o[2]),l=f.x,d=f.y,h=c.transformDelta(parseInt(c.getStyle("font-size")),parseInt(c.getStyle("font-size"))),_=h.x,p=c.getStyle("font-family");n=e.svg_text("",{x:l,y:d}),n.text(u),n.q.attr("fill","none"),n.q.attr("font-size",_),n.q.attr("font-family",p),n.q.attr("stroke",c.getStyle("strokeStyle")),n.q.attr("stroke-opacity",c.getStyle("globalAlpha")),a=!1,i=[],n=null}if("quadraticCurveTo"==t){var v=c._point.tx0,m=c._point.ty0,f=c.transformPoint(o[0],o[1]),g=f.x,y=f.y,f=c.transformPoint(o[2],o[3]),b=f.x,w=f.y;0==i.length&&i.push("M "+v+" "+m),i.push("Q "+g+" "+y+" "+b+" "+w+" ")}if("bezierCurveTo"==t){var v=c._point.tx0,m=c._point.ty0,f=c.transformPoint(o[0],o[1]),g=f.x,y=f.y,f=c.transformPoint(o[2],o[3]),b=f.x,w=f.y,f=c.transformPoint(o[4],o[5]),x=f.x,C=f.y;0==i.length&&i.push("M "+v+" "+m),i.push("C "+g+" "+y+" "+b+" "+w+" "+x+" "+C+" ")}if("moveTo"==t){var I=c._point.tx1,j=c._point.ty1,v=c._point.tx0,m=c._point.ty0;i.push("M "+I+" "+j)}if("lineTo"==t){var I=c._point.tx1,j=c._point.ty1,v=c._point.tx0,m=c._point.ty0;console.log("lineTo",v,m,I,j),0==i.length&&i.push("M "+v+" "+m),i.push("L "+I+" "+j)}if("stroke"==t){n&&(r=n),n=null,s="black";var T=i.join(" ");console.log("path",T),i.length&&r.q.attr("d",T),console.log("new way"),r.attr({stroke:c.getStyle("strokeStyle"),"stroke-opacity":c.getStyle("globalAlpha"),"stroke-width":c.transformDelta(c.getStyle("lineWidth")>>0,c.getStyle("lineWidth")>>0).x||1}),a=!0}if("fill"==t){n&&(r=n),n=null,a||i.push("z");var T=i.join(" ");console.log("path",T),i.length&&r.q.attr("d",T),r.q.attr("stroke",c.getStyle("strokeStyle")),r.q.attr("fill",c.getStyle("fillStyle")),r.q.attr("fill-opacity",c.getStyle("globalAlpha")),a=!0}}),e},t.replace=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var i=this;this._commands.forEach(function(n){var r=n[0];r==t&&(n[1]=e,i.isDirty(!0)),"setProperty"==r&&n[1][0]==t&&(n[1][1]=e[0],i.isDirty(!0))})},t.reset=function(){var t=this._ctx;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height)},t.serialize=function(){var t={};t.commands=this._commands,t.inserts={};var e=this._inserts;if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=[];e[i].forEach(function(t){n.push(t.serialize())}),t.inserts[i]=n}return t},t.shadow=function(t,e){this.shadowBlur(t),this.shadowOffsetX(0),this.shadowOffsetY(0),this.shadowColor(e||"#000000")},t.shapes=function(){return s(this)},t.svgPathString=function(){var t=[],e=!1,i=this,n="",r="black";return i.execFn(function(i,a,o){if("beginPath"==i&&(t=[],e=!1,r="none"),"arc"==i){var s=o.transformPoint(a[0],a[1]),c=s.x,f=s.y,l=o.transformDelta(a[2],a[2]);f-=l.y,t.push("M "+c+" "+f),t.push("A "+l.x+","+l.y+" 0 1,0 "+(c+.1)+" "+f+" ")}if("quadraticCurveTo"==i){var d=o._point.tx0,h=o._point.ty0,s=o.transformPoint(a[0],a[1]),u=s.x,_=s.y,s=o.transformPoint(a[2],a[3]),p=s.x,v=s.y;0==t.length&&t.push("M "+d+" "+h),t.push("Q "+u+" "+_+" "+p+" "+v+" ")}if("bezierCurveTo"==i){var d=o._point.tx0,h=o._point.ty0,s=o.transformPoint(a[0],a[1]),u=s.x,_=s.y,s=o.transformPoint(a[2],a[3]),p=s.x,v=s.y,s=o.transformPoint(a[4],a[5]),m=s.x,g=s.y;0==t.length&&t.push("M "+d+" "+h),t.push("C "+u+" "+_+" "+p+" "+v+" "+m+" "+g+" ")}if("moveTo"==i){var y=o._point.tx1,b=o._point.ty1,d=o._point.tx0,h=o._point.ty0;t.push("M "+y+" "+b)}if("lineTo"==i){var y=o._point.tx1,b=o._point.ty1,d=o._point.tx0,h=o._point.ty0;0==t.length&&t.push("M "+d+" "+h),t.push("L "+y+" "+b)}"stroke"==i&&t.length>0&&(n||(n=t.join(" "))),"fill"==i&&t.length>0&&(n||(n=t.join(" ")))}),t.length>0&&(n||(n=t.join(" "))),n},t.undo=function(){if(this._commands){var t,e=this._commands.pop();if(e){for(t=e[2];e&&e[2]==t;)this._undoBuffer.push(e),e=this._commands.pop();e&&this._commands.push(e)}console.log(this._commands)}},t.unserialize=function(t){var e=f();e._commands=t.commands;var i=t.inserts;if(i){e._inserts={};for(var n in i)if(i.hasOwnProperty(n)){var r=[];i[n].forEach(function(t){r.push(f().unserialize(t))}),e._inserts[n]=r}}return e}}(this)},f=function(t,e,i,n,r,a,o,s){if(!(this instanceof f))return new f(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,c)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=f._classInfo.name)return new l(t,e,i,n,r,a,o,s)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};f._classInfo={name:"canvasContext"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("canvasContext",f),f.prototype=new c,"undefined"!=typeof window&&(window.canvasContext=f),"undefined"!=typeof window&&(window.canvasContext_prototype=c);var l=function(){var t=function(){!function(t){var e,i,n,r,a,o,s,c;t.add=function(t,e){t.x=t.x+e.x,t.y=t.y+e.y},t.angleBetween=function(t,e){var i=this.normalize({x:t.x,y:t.y}),n=this.normalize({x:e.x,y:e.y}),r=this.crossProd(i,n),a=this.dotProd(i,n),o=Math.acos(a);return 0>r&&(o=-1*o),o},t.calc_cat=function(t,e,i,n,r){var a=t*t,o=a*t;return.5*(2*i+(-e+n)*t+(2*e-5*i+4*n-r)*a+(-e+3*i-3*n+r)*o)},t.crossProd=function(t,e){return t.x*e.y-t.y*e.x},t.diff=function(t,e){return{x:e.x-t.x,y:e.y-t.y}},t.dist=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},t.dotProd=function(t,e){return t.x*e.x+t.y*e.y},t.getBarCoeffs=function(t,e,i){var n=s;return n.A=.5*(-e.y*i.x+t.y*(-e.x+i.x)+t.x*(e.y-i.y)+e.x*i.y),n.sign=n.A<0?-1:1,n.s1=(t.y*i.x-t.x*i.y+(i.y-t.y))*n.sign,n.s2=(i.y-t.y)*n.sign,n.s3=(t.x-i.x)*n.sign,n.t1=(t.x*e.y-t.y*e.x)*n.sign,n.t2=(t.y-e.y)*n.sign,n.t3=(e.x-t.x)*n.sign,n},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){a||(a={x:0,y:0},o={x:0,y:0},e=[0,0,0,0],i={x:0,y:0},n={x:0,y:0},r={x:0,y:0},s={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},c={x:0,y:0})}),t.initProjection=function(t,e){n.y=e.y-t.y,n.x=e.x-t.x,i.y=n.y,i.x=n.x,this.normalize(n),this.normalize(i),this.rotate(i,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)},t.linesIntersect=function(t,e,i,n){var r=t.x,a=t.y,o=e.x,s=e.y,c=i.x,f=i.y,l=n.x,d=n.y,h=((r*s-a*o)*(c-l)-(r-o)*(c*d-f*l))/((r-o)*(f-d)-(a-s)*(c-l)),u=((r*s-a*o)*(f-d)-(a-s)*(c*d-f*l))/((r-o)*(f-d)-(a-s)*(c-l));if(isNaN(h)||isNaN(u))return!1;if(r>=o){if(!(h>=o&&r>=h))return!1}else if(!(h>=r&&o>=h))return!1;if(a>=s){if(!(u>=s&&a>=u))return!1}else if(!(u>=a&&s>=u))return!1;if(c>=l){if(!(h>=l&&c>=h))return!1}else if(!(h>=c&&l>=h))return!1;if(f>=d){if(!(u>=d&&f>=u))return!1}else if(!(u>=f&&d>=u))return!1;return!0},t.mirrorVector=function(t,e,i){a.x=e.x-i.x,a.y=e.y-i.y,o.x=-a.y,o.y=a.x,t.x=t.x-i.x,t.y=t.y-i.y,this.dotProd(t,o)>0&&this.rotate(o,Math.PI),this.normalize(a),this.normalize(o);var n=Math.abs(this.dotProd(t,o)),r=this.dotProd(t,a);return t.x=o.x*n+a.x*r,t.y=o.y*n+a.y*r,t.x+=i.x,t.y+=i.y,t},t.normalize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);if(0==e)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/e,t.y=t.y/e,t},t.opposeVector=function(t,e){a.x=e,x,a.y=e.y,o.x=-a.y,o.y=a.x,this.normalize(a),this.normalize(o),this.rotate(a,Math.PI);var i=Math.abs(jsMath.dotProd(t,o)),n=Math.abs(jsMath.dotProd(t,a));return this.dotProd(t,o)<0&&this.rotate(o,Math.PI),t.x=o.x*i+a.x*n,t.y=o.y*i+a.y*n,t},t.pointInTriangle=function(t,e,i,n){var r=.5*(-i.y*n.x+e.y*(-i.x+n.x)+e.x*(i.y-n.y)+i.x*n.y),a=0>r?-1:1,o=(e.y*n.x-e.x*n.y+(n.y-e.y)*t.x+(e.x-n.x)*t.y)*a,s=(e.x*i.y-e.y*i.x+(e.y-i.y)*t.x+(i.x-e.x)*t.y)*a;return o>0&&s>0&&2*r*a>o+s},t.pointInTriangleBc=function(t,e){var i=e.A,n=e.sign,r=e.s1+e.s2*t.x+e.s3*t.y,a=e.t1+e.t2*t.x+e.t3*t.y;return r>0&&a>0&&2*i*n>r+a},t.project=function(t){var e=t;return pVector.x=e.x-r.x,pVector.y=e.y-r.y,prodResult.i=this.dotProd(pVector,n),prodResult.j=this.dotProd(pVector,i),prodResult},t.rotate=function(t,e){var i=Math.sin(e),n=Math.cos(e),r=t.x,a=t.y;return t.x=r*n+a*i,t.y=-r*i+a*n,t},t.rotateAround=function(t,e,i){this.sub(e,i),this.rotate(e,t),this.add(e,i)},t.sub=function(t,e){t.x=t.x-e.x,t.y=t.y-e.y},t.tangentNormal=function(t,e,i){var n={};n.x=e.x-t.x,n.y=e.y-t.y;var r={};r.x=i.x-e.x,r.y=i.y-e.y;var a={x:n.x+r.x,y:n.y+r.y};return this.normalize(a)},t.triangleArea=function(t,e,i){var n=t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y);return Math.abs(n/2)},t.triangleInTriangle=function(t,e,i,n,r,a){var o=this.getBarCoeffs(t,e,i);if(this.pointInTriangleBc(n,o))return!0;if(this.pointInTriangleBc(r,o))return!0;if(this.pointInTriangleBc(a,o))return!0;var o=this.getBarCoeffs(n,r,a);return this.pointInTriangleBc(t,o)?!0:this.pointInTriangleBc(e,o)?!0:this.pointInTriangleBc(i,o)?!0:this.linesIntersect(t,e,n,r)?!0:this.linesIntersect(e,i,n,r)?!0:this.linesIntersect(i,t,n,r)?!0:this.linesIntersect(t,e,r,a)?!0:this.linesIntersect(e,i,r,a)?!0:this.linesIntersect(i,t,r,a)?!0:this.linesIntersect(t,e,a,n)?!0:this.linesIntersect(e,i,a,n)?!0:this.linesIntersect(i,t,a,n)?!0:!1},t.unProject=function(t){var e=t;return c.x=e.i*n.x+e.j*i.x,c.y=e.i*n.y+e.j*i.y,c.x+=r.x,c.y+=r.y,c}}(this)},e=function(t,i,n,r,a,o,s,c){if(!(this instanceof e))return new e(t,i,n,r,a,o,s,c);var f=[t,i,n,r,a,o,s,c];if(this.__factoryClass){var l,d=this;if(this.__factoryClass.forEach(function(t){l=t.apply(d,f)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=e._classInfo.name)return new l(t,i,n,r,a,o,s,c)}else if(l)return l}if(this.__traitInit){var d=this;this.__traitInit.forEach(function(t){t.apply(d,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};e._classInfo={name:"jsVectors"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("jsVectors",e),e.prototype=new t,"undefined"!=typeof window&&(window.jsVectors=e),"undefined"!=typeof window&&(window.jsVectors_prototype=t),function(t){var i;t.drawPath=function(t){var e,i;t.beginPath(),this._all.forEach(function(n){if("M"==n.name&&(e=n.points[0],i=n.points[1],t.moveTo(e,i)),"m"==n.name&&(e+=n.points[0],i+=n.points[1],t.moveTo(e,i)),"q"==n.name)for(var r=0;r<n.points.length;r+=4){var a=n.points,o=e+a[r+0],s=i+a[r+1],c=e+a[r+2],f=i+a[r+3];e=c,i=f,t.quadraticCurveTo(o,s,c,f,d,h)}if("Q"==n.name)for(var a=n.points,l=n.points.length,r=0;l>r;r+=4)t.quadraticCurveTo(a[r+0],a[r+1],a[r+2],a[r+3]);if("c"==n.name)for(var r=0;r<n.points.length;r+=6){var a=n.points,o=e+a[r+0],s=i+a[r+1],c=e+a[r+2],f=i+a[r+3],d=e+a[r+4],h=i+a[r+5];e=d,i=h,t.bezierCurveTo(o,s,c,f,d,h)}if("C"==n.name)for(var a=n.points,l=n.points.length,r=0;l>r;r+=6)t.bezierCurveTo(a[r+0],a[r+1],a[r+2],a[r+3],a[r+4],a[r+5]);if("l"==n.name)for(var r=0;r<n.points.length;r+=2){var a=n.points,o=e+a[r+0],s=i+a[r+1];e=o,i=s,t.lineTo(o,s)}if("H"==n.name)for(var r=0;r<n.points.length;r++){var a=n.points,o=a[r+0];e=o,t.lineTo(o,i)}if("V"==n.name)for(var r=0;r<n.points.length;r++){var a=n.points,s=a[r+0];i=s,t.lineTo(e,s)}if("L"==n.name)for(var r=0;r<n.points.length;r+=2){var a=n.points,o=a[r+0],s=a[r+1];e=o,i=s,t.lineTo(o,s)}"z"==n.name&&t.closePath()})},t.findDimensions=function(){if(this._limits)return this._limits;var t,e,i,n,r,a,o=function(r,a){"undefined"==typeof t&&(t=r,i=r,e=a,n=a),t=Math.min(t,r),e=Math.min(e,a),i=Math.max(i,r),n=Math.max(n,a)};return this._all.forEach(function(t){if("M"==t.name&&(r=t.points[0],a=t.points[1],o(r,a)),"m"==t.name&&(r+=t.points[0],a+=t.points[1],o(r,a)),"c"==t.name)for(var e=0;e<t.points.length;e+=6){var i=t.points,n=r+i[e+0],s=a+i[e+1],c=r+i[e+2],f=a+i[e+3],l=r+i[e+4],d=a+i[e+5];o(n,s),o(c,f),o(l,d),r=l,a=d}if("C"==t.name)for(var i=t.points,h=t.points.length,e=0;h>e;e+=6)o(i[e+0],i[e+1]),o(i[e+2],i[e+3]),o(i[e+4],i[e+5]);if("l"==t.name)for(var e=0;e<t.points.length;e+=2){var i=t.points,n=r+i[e+0],s=a+i[e+1];r=n,a=s,o(r,a)}if("L"==t.name)for(var e=0;e<t.points.length;e+=2){var i=t.points,n=i[e+0],s=i[e+1];r=n,a=s,o(r,a)}}),this._limits=[t,e,i,n],this._limits},t.fitPathInto=function(t,e){for(var i=this.findDimensions(),n=!0,r=0;4>r;r++)(i[r]<0||i[r]>t)&&(n=!1);var a=Math.abs(i[2]-i[0]),o=Math.abs(i[3]-i[1]),s=!1;Math.abs(i[3])<Math.abs(i[1])&&(s=!0);var c=t/a,f=e/o,l=-i[0],d=-i[1],h=Math.min(c,f),u=h;s&&(u=-u,d=-i[3]);var _=function(t){return(t+l)*h},p=function(t){return(t+d)*u};this._all.forEach(function(t){if("M"==t.name&&(t.points[0]=_(t.points[0]),t.points[1]=p(t.points[1])),"m"==t.name&&(t.points[0]*=h,t.points[1]*=u),"L"==t.name)for(var e=0;e<t.points.length;e+=2){var i=t.points;i[e+0]=_(i[e+0]),i[e+1]=p(i[e+1])}if("c"==t.name)for(var e=0;e<t.points.length;e+=6){var i=t.points;i[e+0]*=h,i[e+2]*=h,i[e+4]*=h,i[e+1]*=u,i[e+3]*=u,i[e+5]*=u}if("C"==t.name)for(var i=t.points,n=t.points.length,e=0;n>e;e+=6)i[e+0]=_(i[e+0]),i[e+2]=_(i[e+2]),i[e+4]=_(i[e+4]),i[e+1]=p(i[e+1]),i[e+3]=p(i[e+3]),i[e+5]=p(i[e+5]);if("Q"==t.name)for(var i=t.points,n=t.points.length,e=0;n>e;e+=4)i[e+0]=_(i[e+0]),i[e+2]=_(i[e+2]),i[e+1]=p(i[e+1]),i[e+3]=p(i[e+3]);if("l"==t.name)for(var e=0;e<t.points.length;e+=2){var i=t.points;i[e+0]*=h,i[e+1]*=u}}),this._limits=null},t.forCmds=function(t){this._all.forEach(t)},t.fromBezierArray=function(t){{var e,i=t.length;this._all}this._all=[];for(var e=0;i>e;e++){var n=t[e];if(0==e){var r={name:"M",points:[n.point_x(0),n.point_y(0)]};this._all.push(r)}var r={name:"C",points:[n.point_x(1),n.point_y(1),n.point_x(2),n.point_y(2),n.point_x(3),n.point_y(3)]};this._all.push(r)}this.saveToOriginals()},t.getCommands=function(){return this._all},t.getPath=function(t){return this._all[t]},t.getSegmentCount=function(){var t=this._all.length;return"z"==this._all[t-1].name&&t--,t},t.getSubPaths=function(){return this._subPaths},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,i||(i={})}),t.initCmd=function(t){return this._activeCmd={name:t,points:[]},this._all.push(this._activeCmd),this._activeCmd},t.inverse=function(){var t,e=this.originals(),i=e.length;this._all.reverse();var e=(this._all,this._all),n=[],r=function(t,e){for(var i=[],n=t.points.length/2,r=t.points.length-4;n>0;){if(1==n){if(!e)return i;r=e.points.length-2,i.push(e.points[r]),i.push(e.points[r+1])}else i.push(t.points[r]),i.push(t.points[r+1]),r-=2;n--}return i};"z"==e[0].name&&e.shift();for(var t=0;i>t;t++){{var a,o=e[t];e[t],e[t+1]}if(!o)break;if(t>0&&(a=e[t-1]),0==t){var s=o.points.length-2,c={name:"M",points:[o.points[s],o.points[s+1]]};n.push(c)}else{var c={name:a.name,points:r(a,o)};n.push(c)}}var c={name:"z",points:[]};n.push(c),this._all=n},t.makePathAbsolute=function(){var t,e,i,n,r=!0,a=function(){r&&(i=t,n=e);var a=t-i,o=e-n;return{x:t+a,y:e+o}};this._all.forEach(function(o){if("M"==o.name&&(t=o.points[0],e=o.points[1],r=!0),"L"==o.name&&(t=o.points[0],e=o.points[1],r=!0),"m"==o.name&&(t+=o.points[0],e+=o.points[1],o.points[0]=t,o.points[1]=e,o.name="M",r=!0),"q"==o.name){for(var s=0;s<o.points.length;s+=4){var c=o.points;c[s+0]=t+c[s+0],c[s+1]=e+c[s+1],c[s+2]=t+c[s+2],c[s+3]=e+c[s+3],t=c[s+2],e=c[s+3],o.name="Q"}r=!0}if("C"==o.name){var c=o.points;i=c[2],n=c[3],t=c[4],e=c[5],r=!1}if("c"==o.name){for(var s=0;s<o.points.length;s+=6){var c=o.points;c[s+0]=t+c[s+0],c[s+1]=e+c[s+1],c[s+2]=t+c[s+2],c[s+3]=e+c[s+3],c[s+4]=t+c[s+4],c[s+5]=e+c[s+5],t=c[s+4],e=c[s+5],i=c[s+2],n=c[s+3],o.name="C"}r=!1}if("S"==o.name){var c=o.points,f=a(),l=[];l[0]=f.x,l[1]=f.y,l[2]=c[0],l[3]=c[1],l[4]=c[2],l[5]=c[3],t=l[4],e=l[5],i=l[2],n=l[3],o.name="C",o.points=l,r=!1}if("s"==o.name){var c=o.points,f=a(),l=[];l[0]=f.x,l[1]=f.y,l[2]=t+c[0],l[3]=e+c[1],l[4]=t+c[2],l[5]=e+c[3],t=l[4],e=l[5],i=l[2],n=l[3],o.name="C",o.points=l,r=!1}if("h"==o.name){r=!0;for(var s=0;s<o.points.length;s++){var c=o.points,d=t+c[s+0];return t=d,c[s+0]=d,o.points=[d,e],void(o.name="L")}}if("H"==o.name){r=!0;for(var s=0;s<o.points.length;s++){var c=o.points,d=c[s+0];return t=d,c[s+0]=d,o.points=[d,e],void(o.name="L")}}if("V"==o.name){r=!0;for(var s=0;s<o.points.length;s++){var c=o.points,h=c[s+0];return e=h,o.points=[t,h],void(o.name="L")}}if("v"==o.name){r=!0;for(var s=0;s<o.points.length;s++){var c=o.points,h=e+c[s+0];return e=h,o.points=[t,h],void(o.name="L")}}if("l"==o.name){r=!0;for(var s=0;s<o.points.length;s+=2){var c=o.points,d=t+c[s+0],h=e+c[s+1];t=d,e=h,c[s+0]=d,c[s+1]=h,o.name="L"}}})},t.normalize=function(){this.makePathAbsolute(),this.fitPathInto(800,800)},t.originals=function(){return this._original||(this._original=JSON.parse(JSON.stringify(this._all))),this._original},t.parse=function(t){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,this._usedCommands={},t||(t="M25.979,12.896 L 5.979,12.896,5.979,19.562,25.979,19.562z");var e=t,i=0,n=1e4;for(this._subPaths=t.split("M"),this._subIndex=0;(e=this.popCommand(e))&&0!=e.length&&e.length!=i&&!(n--<0);)i=e.length;return this._all},t.path=function(){return this._all},t.pathFunction=function(){},t.popCommand=function(t){t=t.trim();var e=t.charAt(0),i=null;if("M"==e&&(i=this.initCmd(e),t=t.substring(1)),"m"==e&&(i=this.initCmd(e),t=t.substring(1)),"Q"==e&&(i=this.initCmd(e),t=t.substring(1)),"q"==e&&(i=this.initCmd(e),t=t.substring(1)),"S"==e&&(i=this.initCmd(e),t=t.substring(1)),"s"==e&&(i=this.initCmd(e),t=t.substring(1)),"C"==e&&(i=this.initCmd(e),t=t.substring(1)),"c"==e&&(i=this.initCmd(e),t=t.substring(1)),"H"==e&&(i=this.initCmd(e),t=t.substring(1)),"h"==e&&(i=this.initCmd(e),t=t.substring(1)),"V"==e&&(i=this.initCmd(e),t=t.substring(1)),"v"==e&&(i=this.initCmd(e),t=t.substring(1)),"L"==e&&(i=this.initCmd(e),t=t.substring(1)),"l"==e&&(i=this.initCmd(e),t=t.substring(1)),"Z"==e&&(i=this.initCmd(e),t=t.substring(1)),"z"==e&&(i=this.initCmd(e),t=t.substring(1)),i){this._usedCommands[e]="true",t=t.trim();for(var n=!0;n&&t.length>0;){var r=t.charAt(0);","==r&&(t=t.substring(1),t=t.trim());for(var a=["-","1","2","3","4","5","6","7","8","9","0","."],o="",s=0;a.indexOf(t.charAt(0))>=0&&!("-"==t.charAt(0)&&(s++,s>1));)o+=t.charAt(0),t=t.substring(1),s=1;if(!(o.length>0))break;i.points.push(parseFloat(o)),t=t.trim()}}return i||(console.error("No command found for"),console.error(t)),this._activeCmd=i,this._stringLeft=t,t},t.relativePosition=function(t){var e=this.toBezierArray(),i=e.length,n=i*t,r=Math.floor(n);r>=i&&(r=i-1),0>r&&(r=0);var a=e[r],o=1/i,s=r/i,c=t,f=c-s,l=f/o,d={x:0,y:0,normal:{x:0,y:0}};d.x=a.x(l),d.y=a.y(l);var h=a.tangent(l,!0);return d.normal.x=h.x,d.normal.y=h.y,d},t.replacePartWith=function(t,i,n){var r=function(t,i){var n=d();n.parse(t),n.makePathAbsolute();var r=n.toBezierArray();n.fromBezierArray(r),i&&n.inverse();var a=n.toQuaternionPath(),o=function(t,i){var n=pathIterator(a),r=n.endPoint(),o="M 0 0 "+n.toSvgPath(),s=t;if(0==i.x&&0==i.y)return"";var c=Math.sqrt(r.x*r.x+r.y*r.y),f=Math.sqrt(i.x*i.x+i.y*i.y),l=f/c;if(0==c)return o;var d=e(),h=d.angleBetween(r,i),o=n.toSvgPath(s,quaternion().rotate(h),function(t){return t.d=t.d*l,t});return o};return o},a=this.getPath(t);a.replaceFunction=r(i,n)},t.saveToOriginals=function(){this._original=JSON.parse(JSON.stringify(this._all))},t.scaleFactor=function(t,e){var i=this.findDimensions(),n=Math.abs(i[2]-i[0]),r=Math.abs(i[3]-i[1]),a=t/n,o=e/r,s=Math.min(a,o);return s},t.svgString=function(){var t,e,i="";return this._all.forEach(function(n){if("M"==n.name&&(t=n.points[0],e=n.points[1],i+="M"+t+","+e+" "),"m"==n.name&&(t+=n.points[0],e+=n.points[1],i+="M"+t+","+e+" "),"q"==n.name){i+="Q";for(var r=0;r<n.points.length;r+=4){var a=n.points,o=t+a[r+0],s=e+a[r+1],c=t+a[r+2],f=e+a[r+3];t=c,e=f,i+=o+","+s+" "+c+","+f+" "}}if("Q"==n.name){var a=n.points,l=n.points.length;i+="Q";for(var r=0;l>r;r+=4){var o=a[r+0],s=a[r+1],c=a[r+2],f=a[r+3];t=c,e=f,i+=o+","+s+" "+c+","+f+" "}}if("c"==n.name){i+="C";for(var r=0;r<n.points.length;r+=6){var a=n.points,o=t+a[r+0],s=e+a[r+1],c=t+a[r+2],f=e+a[r+3],d=t+a[r+4],h=e+a[r+5];t=d,e=h,i+=o+","+s+" "+c+","+f+" "+d+","+h+" "}}if("C"==n.name){var a=n.points,l=n.points.length;if(n.replaceFunction){for(var u={x:t,y:e},r=0;l>r;r+=6)t=a[r+4],e=a[r+5];var _={x:t-u.x,y:e-u.y},p=n.replaceFunction(u,_);console.log("The inserted path ",p),i+=" "+p+" "}else{i+="C";for(var r=0;l>r;r+=6)i+=a[r+0]+","+a[r+1]+" "+a[r+2]+","+a[r+3]+" "+a[r+4]+","+a[r+5]+" ",t=a[r+4],e=a[r+5]}}if("l"==n.name){i+="L";for(var r=0;r<n.points.length;r+=2){var a=n.points,o=t+a[r+0],s=e+a[r+1];t=o,e=s,i+=o+","+s+" "}}if("H"==n.name){i+="L";for(var r=0;r<n.points.length;r++){var a=n.points,o=a[r+0];t=o,i+=o+","+e+" "}}if("V"==n.name){i+="L";for(var r=0;r<n.points.length;r++){var a=n.points,s=a[r+0];e=s,i+=t+","+s+" "}}if("L"==n.name)if(n.replaceFunction){for(var u={x:t,y:e},r=0;r<n.points.length;r+=2){var a=n.points,o=a[r+0],s=a[r+1];t=o,e=s}var _={x:t-u.x,y:e-u.y},p=n.replaceFunction(u,_);console.log("The inserted path ",p),i+=" "+p+" "}else{i+="L";for(var r=0;r<n.points.length;r+=2){var a=n.points,o=a[r+0],s=a[r+1];t=o,e=s,i+=o+","+s+" "}}"z"==n.name&&(i+="z")}),i},t.toBezierArray=function(){var t,e,i="",n=[];return this._all.forEach(function(r){if("M"==r.name&&(t=r.points[0],e=r.points[1]),"Q"==r.name)for(var a=r.points,o=r.points.length,s=0;o>s;s+=4){var c=a[s+0],f=a[s+1],l=a[s+2],d=a[s+3],h=new jsBezierCurve;h.fromQuadCurve({x:t,y:e},{x:c,y:f},{x:l,y:d}),n.push(h),t=l,e=d}if("C"==r.name)for(var a=r.points,o=r.points.length,s=0;o>s;s+=6){var c=a[s+0],f=a[s+1],l=a[s+2],d=a[s+3],u=a[s+4],_=a[s+5],h=new jsBezierCurve;h.fromPoints({x:t,y:e},{x:c,y:f},{x:l,y:d},{x:u,y:_}),n.push(h),t=u,e=_}if("L"==r.name){i+="L";for(var s=0;s<r.points.length;s+=2){var a=r.points,c=a[s+0],f=a[s+1],h=new jsBezierCurve;h.fromLine({x:t,y:e},{x:c,y:f}),n.push(h),t=c,e=f}}}),n},t.toQuaternionPath=function(){var t=!0,i={x:0,y:0},n={x:100,y:0},r={x:100,y:0},a=e(),o=[];return this.forCmds(function(e){var s={cmd:e.name,path:[]},c=function(e,o){n.x=e-i.x,n.y=o-i.y;var c=Math.sqrt(n.x*n.x+n.y*n.y);0==c&&(n.x+=.2,n.y+=.2,e+=.02,o+=.02,c=Math.sqrt(n.x*n.x+n.y*n.y));var f=a.angleBetween(r,n),l=quaternion();l.setFromAxisRotation({x:0,y:0,z:1},f),t||s.path.push({q:l,d:c}),t=!1,i.x=e,i.y=o,r.x=n.x,r.y=n.y};"M"==e.name&&c(e.points[0],e.points[1]),"L"==e.name&&c(e.points[0],e.points[1]),"Q"==e.name&&(c(e.points[0],e.points[1]),c(e.points[2],e.points[3])),"C"==e.name&&(c(e.points[0],e.points[1]),c(e.points[2],e.points[3]),c(e.points[4],e.points[5])),s.path.length&&o.push(s)}),o},t.transformPoints=function(t){for(var e,i=this.originals(),n={x:0,y:0},r=i.length,e=(this._all,0);r>e;e++){var a=i[e],o=this._all[e];if(!a)return;if("M"==a.name&&(n.x=a.points[0],n.y=a.points[1],t(n),o.points[0]=n.x,o.points[1]=n.y),"Q"==a.name)for(var s=a.points,c=o.points,f=a.points.length,l=0;f>l;l+=4)n.x=s[l+0],n.y=s[l+1],t(n),c[l+0]=n.x,c[l+1]=n.y,n.x=s[l+2],n.y=s[l+3],t(n),c[l+2]=n.x,c[l+3]=n.y;if("C"==a.name)for(var s=a.points,c=o.points,f=a.points.length,l=0;f>l;l+=6)n.x=s[l+0],n.y=s[l+1],t(n),c[l+0]=n.x,c[l+1]=n.y,n.x=s[l+2],n.y=s[l+3],t(n),c[l+2]=n.x,c[l+3]=n.y,n.x=s[l+4],n.y=s[l+5],t(n),c[l+4]=n.x,c[l+5]=n.y;if("L"==a.name)for(var l=0;l<a.points.length;l+=2){var s=a.points,c=o.points;n.x=s[l+0],n.y=s[l+1],t(n),c[l+0]=n.x,c[l+1]=n.y}}}}(this)},d=function(t,e,i,n,r,a,o,s){if(!(this instanceof d))return new d(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=d._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};d._classInfo={name:"svgPathParser"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("svgPathParser",d),d.prototype=new l,"undefined"!=typeof window&&(window.svgPathParser=d),"undefined"!=typeof window&&(window.svgPathParser_prototype=l),function(t){t.add=function(t){t instanceof Array||(t=Array.prototype.slice.call(arguments,0));var e=this;return t.forEach(function(t){if("[object Function]"==Object.prototype.toString.call(t)){var i=t(),n=t(null,!0);if("string"==typeof i)n.me.on(n.name,function(t,i){e._dom.innerHTML=i}),e._dom.innerHTML=i;else if("undefined"!=typeof i._dom){var t=i;t._parent&&t._parent.removeChild(t),e._children||(e._children=[]);var r=e._children.length;t._index=r,e._children.push(t),t._parent=e,t._svg=e._svg,e._dom.appendChild(t._dom),t.trigger("parent",e),e.trigger("child",t),n.me.on(n.name,function(t,i){i!=e&&e.replaceWith(i)})}return e}if("string"==typeof t)return e._dom.innerHTML=t,e;if("undefined"!=typeof t&&"undefined"!=typeof t._dom){t._parent&&t._parent.removeChild(t),e._children||(e._children=[]);var r=e._children.length;t._index=r,e._children.push(t),t._parent=e,t._svg=e._svg,e._dom.appendChild(t._dom),t.trigger("parent",e),e.trigger("child",t)}}),this},t.addItem=function(t){t instanceof Array||(t=Array.prototype.slice.call(arguments,0));var e=this;return t.forEach(function(t){if("string"==typeof t)return e._dom.innerHTML=t,e;if("undefined"!=typeof t&&"undefined"!=typeof t._dom){t._parent&&t._parent.removeChild(t),e._children||(e._children=[]);var i=e._children.length;t._index=i,e._children.push(t),t._parent=e,t._svg=e._svg,e._dom.appendChild(t._dom),t.trigger("parent",e),e.trigger("child",t)}}),this},t.clear=function(){for(this._children=[];this._dom.firstChild;)this._dom.removeChild(this._dom.firstChild);return this},t.collectFromDOM=function(t){for(var e=D(t),i=t.childNodes.length,n=t.attributes.length,r=0;n>r;r++){var a=t.attributes[r];e.q.attr(a.name,a.value)}var o=t.className;if(o){o+=" ",console.log(o);for(var s=o.split(" "),c=s.length,r=0;c>r;r++){var a=s[r];a&&e.addClass(a)}}(t.innerText||t.textContent)&&e.text(t.innerText||t.textContent);for(var r=0;i>r;r++){var f=t.childNodes[r];e.add(this.collectFromDOM(f))}return e},t.insertAfter=function(t){if(this._parent&&this._parent._children){if(t==this)return void console.log("The items were the same!!!");console.log("--- insert after ----");var e=this._index,i=this._parent._children;if(t._parent&&t._parent!=this._parent){t._parent.removeChild(t);var e=i.indexOf(this);i.splice(e+1,0,t),this._parent.reIndex()}else{if(t._parent){var n=i.indexOf(t);i.splice(n,1);var e=i.indexOf(this);console.log("--- insert placing into ",e+1," ----"),i.splice(e+1,0,t)}else t._parent=this._parent,i.splice(e+1,0,t);this._parent.reIndex()}var r=t._dom,a=this._dom;a.parentNode.insertBefore(r,a.nextSibling)}},t.insertAt=function(t,e){if(console.log("Insert at, children len ",this._children.length," and i = ",t),t<this._children.length){var i=this.child(t);i.insertBefore(e)}else this.add(e)},t.insertBefore=function(t){if(this._parent&&this._parent._children){if(t==this)return void console.log("The items were the same!!!");var e=this._index,i=this._parent._children;if(console.log("Parent Child list length ",i.length),t._parent&&t._parent!=this._parent){t._parent.removeChild(t),t._parent=this._parent;var e=i.indexOf(this);i.splice(e,0,t),this._parent.reIndex()}else{if(t._parent){var n=i.indexOf(t);n>=0&&i.splice(n,1);var e=i.indexOf(this);i.splice(e,0,t),console.log("Splicing at index ",e)}else t._parent=this._parent,i.splice(e,0,t);this._parent.reIndex()}console.log("Parent Child list length after ",i.length);var r=t._dom,a=this._dom;return a.parentNode.insertBefore(r,a),this}},t.moveDown=function(){if("undefined"!=typeof this._index&&this._parent){var t=this._index;if(!this._parent)return;if(!this._parent._children)return;if(t>=this._parent._children.length-1)return;if(this._parent._children){var e=this._parent._children[t+1];e._index--,this._index++;var i=this._parent._children;i.splice(t+1,0,i.splice(t,1)[0]);var n=e._dom,r=this._dom;r.parentNode.insertBefore(r,n.nextSibling)}}},t.moveUp=function(){if(this._index&&this._parent){var t=this._index;if(!t)return;if(0>=t)return;if(this._parent._children){var e=this._parent._children[t-1];e._index++,this._index--;var i=this._parent._children;i.splice(t-1,0,i.splice(t,1)[0]);var n=e._dom,r=this._dom;n.parentNode.insertBefore(r,n)}}},t.parent=function(){return this._parent},t.prepend=function(t){t instanceof Array||(t=Array.prototype.slice.call(arguments,0));var e=this;return t.forEach(function(t){if("string"==typeof t)return e._dom.innerHTML=t,e;if("undefined"!=typeof t&&"undefined"!=typeof t._dom){t._parent&&t._parent.removeChild(t),e._children||(e._children=[]),t._index=0,e._children.unshift(t),t._parent=e,e._dom.insertBefore(t._dom,e._dom.firstChild);for(var i=e._children.length,n=0;i>n;n++)e._children[n]._index=n;t.trigger("parent",e),e.trigger("child",t)}}),this},t.reIndex=function(){var t=this._children,e=0;t.forEach(function(t){t._index=e++})},t.remove=function(){if(this.removeChildEvents(),this._parent)this._parent.removeChild(this);else{var t=this._dom.parentElement;t&&t.removeChild(this._dom)}this._children=[],this.removeAllHandlers()},t.removeChild=function(t){if(this._children){var e=this._children.indexOf(t);e>=0&&(this._children.splice(e,1),this._dom.removeChild(t._dom)),this.reIndex()}},t.removeChildEvents=function(){this.forChildren(function(t){t.removeAllHandlers(),t.removeChildEvents()})},t.removeIndexedChild=function(t){if(this._children){var e=this._children.indexOf(t);e>=0&&this._children.splice(e,1)}},t.replaceWith=function(t){var e=this.parent();if(e){var i=e._children.indexOf(this);e._dom.replaceChild(t._dom,this._dom),e._children.splice(i,1,t),t._parent=e,t._svg=this._svg}}}(this),function(t){var e;t.draggable=function(t,e,i){var n=this.__singleton();n.draggable(this),t&&this.on("startdrag",t),e&&this.on("drag",e),i&&this.on("enddrag",i)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._touchItems=[]}),t.mousePos=function(){e||(e={});var t=this.offset(),i=this.__singleton(),n=i.mouse();return e.sx=n.x,e.sy=n.y,e.x=n.x-t.left,e.y=n.y-t.top,e},t.pauseEvents=function(t){return t=t||window.event,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1},t.touch=function(t){return this._touchItems[t]},t.touchclick=function(){this.touchevents();this.on("touchstart",function(t){t.trigger("click")})},t.touchevents=function(){var t=this._dom;if(t.addEventListener){var e=this;this._touchItems=[];var i=function(t){e._touchItems=[];var i=t.touches;t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var r={};r.startX=i[0].pageX,r.startY=i[0].pageY,e._touchItems[n]=r}e.trigger("touchstart"),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1},n=function(t){var i=t.touches;t.targetTouches&&(i=t.targetTouches),e._touchCount=i.length;for(var n=0;n<i.length;n++){var r=e._touchItems[n];r.dx=t.touches[n].pageX-r.startX,r.dy=t.touches[n].pageY-r.startY}e.trigger("touchmove"),t.preventDefault&&t.preventDefault()},r=function(t){e.trigger("touchend"),t.preventDefault&&t.preventDefault(),t.returnValue=!1};return t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",n,!1),void t.addEventListener("touchend",r,!1)}}}(this),function(t){t.absolute=function(){return this.q.css("position","absolute"),this.x(0).y(0).z(this.baseZ()),this},t.baseZ=function(t){return"undefined"!=typeof t?(this._baseZ=t,this):("undefined"==typeof this._baseZ&&(this._baseZ=0),this._baseZ)},t.box=function(){var t={left:0,top:0,width:800,height:800},e=this._dom;
try{"undefined"!=typeof e.getBoundingClientRect&&(t=e.getBoundingClientRect())}catch(i){t={left:0,top:0,width:800,height:800}}return t},t.getTransform=function(){return this._tMatrix||(this._tMatrix=s()),this._tMatrix},t.height=function(t){if("undefined"==typeof t)return this._h;if(this.isFunction(t)){var e=t(!1,!0),i=this;return e.me.on(e.name,function(t,e){i.height(e)}),this.height(t()),this}if("auto"==t)return this._dom.style.height=t,this._h=t,this;if(t.slice){if("%"==t.slice(-1))return this._dom.style.height=t,this;if("em"==t.slice(-2))return this._dom.style.height=t,this}var n=this.pxParam(t);return"undefined"!=typeof n&&(this._dom.style.height=n),this},t.hoverLayer=function(t,e){var i=D().absolute(),n=this.__singleton();i._dom.zIndex=e||1e5,t&&(i.addClass("Hoverlayer"),i.draggable(function(){console.log("hover, start drag")},function(){console.log("dragging ")},function(){console.log("end drag")}),i.bindSysEvent("mouseenter",function(){i.trigger("mouseenter")},!0),i.bindSysEvent("mouseleave",function(){i.trigger("mouseleave")},!0),i.bindSysEvent("click",function(){i.trigger("click")},!0),i.bindSysEvent("mousedown",function(){i.trigger("mousedown"),n.dragMouseDown(i)},!0),i.bindSysEvent("mouseup",function(){i.trigger("mouseup"),n.dragMouseUp()},!0));var r=this.offset();i.width(r.width),i.height(r.height);var a=D().relative();return this.insertBefore(a),a.add(i),i},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.offset=function(){var t=document.documentElement,e=(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0),i=(window.pageYOffset||t.scrollTop)-(t.clientTop||0),n=this.box();return{top:n.top+i,left:n.left+e,width:n.width,height:n.height}},t.pxParam=function(t){if("string"==typeof t)return parseInt(t)+"px";var e=parseInt(t);return isNaN(e)?void 0:e+"px"},t.relative=function(){return this.q.css("position","relative"),this.x(0).y(0).z(this.baseZ()),this},t.width=function(t){if("undefined"==typeof t)return this._w;if(this.isFunction(t)){var e=t(!1,!0),i=this;return e.me.on(e.name,function(t,e){i.width(e)}),this.width(t()),this}if("auto"==t)return this._dom.style.width=t,this._w=t,this;if(t.slice){if("%"==t.slice(-1))return this._dom.style.width=t,this;if("em"==t.slice(-2))return this._dom.style.width=t,this}var n=this.pxParam(t);return"undefined"!=typeof n&&(this._dom.style.width=n),this},t.x=function(t){if("undefined"!=typeof t){if(this._svgElem){var e=this.getTransform();this._y||(this._y=0),this._x||(this._x=0);var i=t-this._x;return this._x=t,0!=i&&(e.translate(i,0),this.q.attr("transform",e.getSvgTransform()),this.trigger("x")),this}return this.q.css("left",t+"px"),this._x=t,this.trigger("x"),this}return"undefined"==typeof this._x&&(this._x=0),this._x},t.y=function(t){if("undefined"!=typeof t){if(this._svgElem){var e=this.getTransform();this._y||(this._y=0),this._x||(this._x=0);var i=t-this._y;return this._y=t,0!=i&&(e.translate(0,i),this.q.attr("transform",e.getSvgTransform()),this.trigger("y")),this}return this.q.css("top",t+"px"),this._y=t,this.trigger("y"),this}return"undefined"==typeof this._y&&(this._y=0),this._y},t.z=function(t){var e=this._baseZ||0;return"undefined"!=typeof t?(this.q.css("zIndex",t+e),this._z=t,this.trigger("z"),this):("undefined"==typeof this._z&&(this._z=0),this._z)}}(this),function(t){t.applyTransforms=function(t){var e=this._dom;return e.style.transform=t,e.style["-webkit-transform"]=t,e.style["-moz-transform"]=t,e.style["-ms-transform"]=t,this.trigger("transform"),this},t.hide=function(){this._dom.style.display="none",this.trigger("hide")},t.show=function(){this._dom.style.display="",this.trigger("show")},t.style=function(t){if(!this._localStyle){var e="localstyle"+(new Date).getTime()+"_"+guid();this._localStyle=css().css("width","auto"),this._localStyle.writeRule(e),this.addClass(e)}return this._localStyle},t.styleString=function(t){if(this.isFunction(t)){var e=t(),i=t(null,!0),n=this,a=(n._dom.style,r()),o=this.guid(),s=function(t){n.styleString(t)};return i.me.on(i.name,function(t,e){a.once(o,s,e)}),this._dom.style.cssText=e,this}return this._dom.style.cssText=t,this},t.transform=function(t,e){this._transforms||(this._transforms=[]);{if("undefined"!=typeof e){if(-1==this._transforms.indexOf(t))this._transforms.push(t),this._transforms.push("("+e+")"),this._transforms.push(" ");else{var i=this._transforms.indexOf(t);this._transforms[i+1]="("+e+")"}var n=this._transforms.join("");return this.applyTransforms(n),this}if(this._transforms.indexOf(t)>=0){var i=this._transforms.indexOf(t),r=this._transforms[i+1],a=r.substr(1,r.length-2);return a}}},t.transformOrigin=function(t){var e=this._dom;return e.style["transform-origin"]=t,e.style["-webkit-transform-origin"]=t,e.style["-moz-transform-origin"]=t,e.style["-ms-transform-origin"]=t,this.trigger("transform-origin"),this},t.transformString=function(){return this._transforms?this._transforms.join(""):""}}(this),function(t){t.addRow=function(t){var e=new D("tr");this.addItem(e),e.addClass("row"+this._children.length),"[object Array]"!==Object.prototype.toString.call(t)&&(t=Array.prototype.slice.call(arguments,0));var i=0,n=this;return t.forEach(function(t){var r=new D("td");r._dom.setAttribute("valign","top"),n.isObject(t)?r.addItem(t):r.text(t),e.addItem(r),r.addClass("col"+i),i++}),this}}(this),function(t){t.child=function(t){return this._children[t]?this._children[t]:void 0},t.domAttrIterator=function(t,e){if(t&&t.attributes)for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i];n.specified&&e(n.name,n.value)}},t.domIterator=function(t,e,i){if(t){var n={textarea:!0},r=t.childNodes;if(r)for(var a=r.length,o=0;a>o;o++){var s=r[o];if("svg"==s.tagName&&(i="svg"),s){var c=e(s,i);if(c);else{var f=s instanceof HTMLElement;if(f){var l=s.tagName.toLowerCase();n[l]||this.domIterator(s,e,i)}}}}}},t.forChildren=function(t){this._children&&this._children.forEach(function(e){t(e)})},t.forEach=function(t){this._children&&this._children.forEach(function(e){t(e)})},t.searchTree=function(t,e){e||(e=[]);var i;return(i=t(this))&&e.push(i),this._children&&this._children.forEach(function(i){i.searchTree(t,e)}),e}}(this),function(t){t.addClass=function(t){if(this._svg)return this;if(this._classes||(this._classes=[]),this.isFunction(t)){var e=t(),i=t(null,!0),n=e,r=this;return i.me.on(i.name,function(t,e){r.removeClass(n),r.addClass(e),n=e}),this._classes.push(e),this._dom.className=this._classes.join(" "),this}return this._classes.push(t),this._dom.className=this._classes.join(" "),this},t.hasClass=function(t){return this._classes&&this._classes.indexOf(t)>=0?!0:!1},t.removeClass=function(t){if(!this._classes)return this;for(var e;(e=this._classes.indexOf(t))>=0;)e>=0&&(this._classes.splice(e,1),this._dom.className=this._classes.join(" "));return this}}(this),function(t){var e;t.bacon=function(t,e){return Bacon.fromEvent(this._dom,t,e)},t.bindSysEvent=function(t,e,i){if(t=t.toLowerCase(),this._sys||(this._sys={}),this._sys[t])return!1;this._sys[t]=!0;var n=this;return this._dom.attachEvent?i?this._dom.attachEvent("on"+t,function(t){t=t||window.event,n._event=t,e(),i&&(t=window.event,t&&(t.cancelBubble=!0))}):this._dom.attachEvent("on"+t,e):i?this._dom.addEventListener(t,function(t){t=t||window.event,n._event=t,i&&(t&&t.stopPropagation?t.stopPropagation():(t=window.event,t.cancelBubble=!0)),e()}):this._dom.addEventListener(t,e),!0},t.delegate=function(t){this._delegates||(this._delegates=[]),this._delegates.push(t)},t.emitValue=function(t,e){return this._controller&&this._controller[t]?void this._controller[t](e):void(this._valueFn&&this._valueFn[t]?this._valueFn[t](e):this._parent&&this._parent.emitValue(t,e))},t.eventBinder=function(t,e,i,n){var r=this;t.attachEvent?t.attachEvent("on"+e,function(t){t=t||window.event,r._event=t,i(),n&&(t=window.event,t&&(t.cancelBubble=!0))}):t.addEventListener(e,function(t){t=t||window.event,r._event=t,n&&(t&&t.stopPropagation?t.stopPropagation():(t=window.event,t.cancelBubble=!0)),i()})},t.eventSourceObj=function(){},t.isHovering=function(){if(!this._hoverable){this._hovering=!1;var t=this;this.on("mouseenter",function(){t._hovering=!0}),this.on("mouseleave",function(){t._hovering=!1}),this._hoverable=!0}return this._hovering},t.namedListener=function(t,e){if("undefined"!=typeof e)return this._namedListeners||(this._namedListeners={}),this._namedListeners[t]=e,e._listenerName=t,this;if(this._namedListeners)return this._namedListeners[t]},t.on=function(t,e){this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(e);var i=this;if(e._unbindEvent=function(){i.removeListener(t,e)},"click"==t&&this.bindSysEvent("click",function(){i.trigger("click")},!0),"dblclick"==t&&this.bindSysEvent("dblclick",function(){i.trigger("dblclick")},!0),"mousedown"==t&&this.bindSysEvent("mousedown",function(){i.trigger("mousedown")}),"mouseup"==t&&this.bindSysEvent("mouseup",function(){i.trigger("mouseup")}),"checked"==t&&this.bindSysEvent("change",function(){"checkbox"==i._type?(i._checked=i._dom.checked?!0:!1,i.trigger("checked")):i._value=i._dom.value,i.trigger("value")}),"value"==t&&(this.bindSysEvent("change",function(){"checkbox"==i._type?(i._checked=i._dom.checked?!0:!1,i.trigger("checked")):i._value=i._dom.value,i.trigger("value")}),"input"==this._type||"textarea"==this._type)){var n="";this.bindSysEvent("keyup",function(){var t=!1;n!=i._dom.value&&(t=!0),i._value=i._dom.value,t&&i.trigger("value"),n=i._dom.value})}return"focus"==t&&this.bindSysEvent("focus",function(){i._value=i._dom.value,i.trigger("focus")}),"play"==t&&this.bindSysEvent("play",function(){i.trigger("play")}),"mousemove"==t&&this.bindSysEvent("mousemove",function(){i.trigger("mousemove")}),"blur"==t&&this.bindSysEvent("blur",function(){i._value=i._dom.value,i.trigger("blur")}),"mouseenter"==t&&(this._dom.attachEvent?(this.bindSysEvent("mouseenter",function(t){t=t||window.event,i._hover||(i._event=t,i._hover=!0,i.trigger("mouseenter"))}),this.bindSysEvent("mouseleave",function(t){t=t||window.event,i._hover&&(i._event=t,i._hover=!1,i.trigger("mouseleave"))})):(this.bindSysEvent("mouseover",function(t){t=t||window.event,i._hover||(i._hover=!0,i._event=t,i._parent&&(i._parent._hover||i._parent.trigger("mouseenter")),i.trigger("mouseenter"))}),this.bindSysEvent("mouseout",function(){if(i._hover){var t=!1;i.forChildren(function(e){e._hover&&(t=!0)}),t||(i._hover=!1,i.trigger("mouseleave"))}}))),this},t.onValue=function(t,e){this._valueFn||(this._valueFn={}),this._valueFn[t]=e},t.removeAllHandlers=function(){if(this._ev){for(var t in this._ev)if(this._ev.hasOwnProperty(t)){var e=this._ev[t],i=this;e.forEach(function(t){if(i._namedListeners){var e=t._listenerName;i._namedListeners[e]&&delete i._namedListeners[e]}t._unbindEvent&&t._unbindEvent()})}for(var t in this._namedListeners)if(this._namedListeners.hasOwnProperty(t)){var n=this._namedListeners[t];n._unbindEvent&&n._unbindEvent(),delete this._namedListeners[t]}}},t.removeListener=function(t,e){if(this._ev&&this._ev[t]){var i=this._ev[t].indexOf(e);i>=0&&this._ev[t].splice(i,1),0==this._ev[t].length&&delete this._ev[t]}},t.router=function(t,i){this._dom.addEventListener(t,function(t){var n=t.target;if(n){var r=n.getAttribute("data-routeid");if(r){var a=e[r];a&&i(a)}}})},t.setRoute=function(t,i){var n=this.guid();this._dom.setAttribute("data-routeid",n),e||(e={}),i&&this.forChildren(function(e){e.setRoute(t,i)}),e[n]=t},t.trigger=function(t,e,i){if(this._delegates&&this._delegates.forEach(function(n){n&&n.trigger&&n.trigger(t,e,i)}),this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,e,i)}),this}},t.uniqueListener=function(t,e){var i=this.namedListener(t);return i&&i._unbindEvent&&i._unbindEvent(),this.namedListener(t,e),e}}(this),function(t){t.bind=function(t,e){var i=this;if(this.isFunction(t[e])){{var n=t[e](),i=this,r=function(i){t[e](i)},a=!1,o=!1,s=this.uniqueListener("bind:valueIn",function(t,e){a||("checkbox"==i._type?i.checked(e):i.val(e),n=e)}),c=this.uniqueListener("bind:valueOut",function(){a=!0,r("checkbox"==i._type?i.checked():o?parseFloat(i.val()):i.val()),a=!1});this.uniqueListener("bind:invalidIn",function(t,e){i.trigger("invalid",e)}),this.uniqueListener("bind:validIn",function(t,e){i.trigger("valid",e)})}t.on(e,s),this.on("value",c);return"checkbox"==i._type?i.checked(n):i.val(n),this}var f=this.__singleton();f.bind(t,e,this);var i=this;return this.on("datachange",function(){"checkbox"==i._type?i.checked(t[e]?!0:!1):"undefined"!=typeof t[e]&&i.val(t[e])}),this.on("value",function(){t&&(t[e]="checkbox"==i._type?i.checked()?!0:!1:i.val()),f.send(t,e,"datachange",i)}),t&&("checkbox"==i._type?i.checked(t[e]?!0:!1):t[e]&&i.val(t[e])),i},t.blur=function(){this._dom.blur&&this._dom.blur()},t.checked=function(t){if("undefined"==typeof t)return this._checked=this._dom.checked,this._checked;var e=this._dom.checked;return this._dom.checked=t,(e&&!t||!e&&t)&&this.trigger("value"),this},t.clearOptions=function(){if(this._dataList){var t=this._dataList._dom;t.parentNode&&t.parentNode.removeChild(t),this._options={},this._dataList=null}},t.focus=function(){this._dom.focus&&this._dom.focus()},t.options=function(t){if("input"==this._tag){if(this._dataList){var e=this._dataList._dom;e.parentNode&&e.parentNode.removeChild(e),this._options={},this._dataList=null}if(!this._dataList){if(this._options={},this._dataList=D("datalist"),this._dataListId=guid(),this._dataList.q.attr("id",this._dataListId),"[object Array]"===Object.prototype.toString.call(t)){var i=this;t.forEach(function(t){var e=D("option");e.q.attr("value",t),e.text(t),i._options[t]=e,i._dataList.add(e)})}else for(var n in t)if(!this._options[n]&&t.hasOwnProperty(n)){var r=D("option");r.q.attr("value",n),r.text(t[n]),this._options[n]=r,this._dataList.add(r)}this.q.attr("list",this._dataListId),document.body&&document.body.appendChild(this._dataList._dom)}}return this},t.val=function(t){return"undefined"==typeof t?(("select"==this._type||"input"==this._type||"textarea"==this._type)&&(this._value=this._dom.value),this._value):("undefined"!=typeof this._dom.value||"option"==this._type?this._dom.value=t:this._dom.innerHTML=t,this._value=t,this.trigger("value"),this)}}(this),function(t){t.a=function(t,e){var i=this.shortcutFor("a",t,e);return i},t.attr=function(t,e){if(this.isObject(t))for(var i in t)t.hasOwnProperty(i)&&this.q.attr(i,t[i]);else this.q.attr(t,e);return this},t.b=function(t,e){var i=this.shortcutFor("b",t,e);return i},t.button=function(t,e){var i=this.shortcutFor("button",t,e);return i},t.canvas=function(t,e){var i=this.shortcutFor("canvas",t,e);return i},t.checkbox=function(t,e){var i=this.shortcutFor("checkbox",t,e);return i},t.context=function(){if(this._dom.getContext){var t=(this._dom.getContext("2d"),f(this._dom.getContext("2d")));t._canvas=this}else var t=f();return t},t.div=function(t,e){var i=this.shortcutFor("div",t,e);return i},t.form=function(t,e){var i=this.shortcutFor("form",t,e);return i},t.h1=function(t,e){var i=this.shortcutFor("h1",t,e);return i},t.h2=function(t,e){var i=this.shortcutFor("h2",t,e);return i},t.h3=function(t,e){var i=this.shortcutFor("h3",t,e);return i},t.h4=function(t,e){var i=this.shortcutFor("h4",t,e);return i},t.img=function(t,e){var i=this.shortcutFor("img",t,e);return i},t.input=function(t,e){var i=this.shortcutFor("input",t,e);return i},t.label=function(t,e){var i=this.shortcutFor("label",t,e);return i},t.li=function(t,e){var i=this.shortcutFor("li",t,e);return i},t.ol=function(t,e){var i=this.shortcutFor("ol",t,e);return i},t.p=function(t,e){var i=this.shortcutFor("p",t,e);return i},t.pre=function(t,e){var i=this.shortcutFor("pre",t,e);return i},t.shortcutFor=function(t,e,i){var n=D(t);if(this.isObject(e)&&!this.isFunction(e)?i=e:e&&n.addClass(e||""),i)for(var r in i)i.hasOwnProperty(r)&&n.q.attr(r,i[r]);return this.add(n),n},t.span=function(t,e){var i=this.shortcutFor("span",t,e);return i},t.src=function(t){if("img"==this._tag&&!this._hasLoadL){var e=this;this.__singleton().addEventListener(this._dom,"load",function(){e.trigger("load")}),this._hasLoadL=!0}return this.q.attr("src",t),this},t.strong=function(t,e){var i=this.shortcutFor("strong",t,e);return i},t.table=function(t,e){var i=this.shortcutFor("table",t,e);return i},t.textarea=function(t,e){var i=this.shortcutFor("textarea",t,e);return i},t.ul=function(t,e){var i=this.shortcutFor("ul",t,e);return i}}(this),function(t){t._setDomText=function(t,e){if("undefined"!=typeof t.textContent)t.textContent=e;else{var i=e,n=document.createElement("div");n.innerHTML=i;var r=n.innerText||"";t.innerHTML=r}},t.html=function(t){if(this.isFunction(t)){var e=t(),i=t(null,!0),n=this;return i.me.on(i.name,n.uniqueListener("text:value",function(t,e){n._dom.innerHTML=e})),this._dom.innerHTML=e,this}return"undefined"==typeof t?this._dom.innerHTML:(this._dom.innerHTML=t,this)},t.text=function(t){if("undefined"==typeof t)return this._html;if(this.isFunction(t)){var e=t(),i=t(null,!0),n=this,a=(r(),!1);if("tspan"==n._tag&&(a=!0),this._svgElem||"undefined"!=typeof n._dom.textContent?i.me.on(i.name,n.uniqueListener("text:value",function(t,e){a&&(e=e.trim()),n._dom.textContent=!a||e&&0!=e.length?e:""})):i.me.on(i.name,n.uniqueListener("text:value",function(t,e){var i=e,r=document.createElement("div");r.innerHTML=i;var a=r.textContent||r.innerText||"";n._dom.innerHTML=a})),this._svgElem||"undefined"!=typeof this._dom.textContent)a&&(e=e.trim()),!a||e&&0!=e.length?this._dom.textContent=e:(this._dom.textContent="",n._dom.textContent="");else{var o=document.createElement("div");o.innerHTML=e;var s=o.textContent||o.innerText||"";this._dom.innerHTML=s}return this}if(this._svgElem||"undefined"!=typeof this._dom.textContent)this._dom.textContent=t;else{var c=t,o=document.createElement("div");o.innerHTML=c;var s=o.textContent||o.innerText||"";this._dom.innerHTML=s}return this._html=t,this}}(this),function(t){var e,i,n,r,a;t.bottom=function(){return this.createLayoutElement("bottom")},t.createLayoutElement=function(t){this.__layout||(this.__layout={});var e=this.__layout[t];if(!e){if(e=D("div"),e.addClass("layout-"+t),"top"==t)this.prepend(e);else if("bottom"==t)this.add(e);else{var i=null;"middle"==t&&(this.__layout.right&&(i=this.__layout.right),!i&&this.__layout.bottom&&(i=this.__layout.bottom),i?i.insertBefore(e):this.add(e)),"left"==t&&(this.__layout.middle&&(i=this.__layout.middle),!i&&this.__layout.right&&(i=this.__layout.right),!i&&this.__layout.bottom&&(i=this.__layout.bottom),i?i.insertBefore(e):this.add(e)),"right"==t&&(this.__layout.bottom&&(i=this.__layout.bottom),i?i.insertBefore(e):this.add(e))}this.__layout[t]=e}return e},t.detectMediaType=function(){},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(this.eventBinder(window,"hashchange",function(){"#"+i.lastSetValue!=document.location.hash&&i.pushing}),i={inited:!0})}),t.initScreenEvents=function(){n={w:0,h:0};var t=[700],e=0;if(r=[],window.matchMedia)a=window.matchMedia("(max-width:700px)"),a.addListener(function(t){e++,r.forEach(t.matches?function(t){t({w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight,limit:700,width_less:!0,eCnt:e})}:function(t){t({w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight,limit:700,width_more:!0,eCnt:e})})});else{var i=(document.addEventListener?!1:!0,window);this.eventBinder(i,"resize",function(){e++;var i=window.innerWidth||document.documentElement.clientWidth,a=!1,o=700;t.forEach(function(t){var e=(t-i)*(t-n.w);0>e&&(o=t,a=!0)}),n.w=window.innerWidth||document.documentElement.clientWidth,n.h=window.innerHeight||document.documentElement.clientHeight,a&&r.forEach(function(t){var i={limit:o,w:n.w,h:n.h,eCnt:e};n.w>o?i.width_more=!0:i.width_less=!0,t(i)})})}},t.left=function(){return this.createLayoutElement("left")},t.middle=function(){return this.createLayoutElement("middle")},t.navigation=function(t){this._navigation=t,this._activeNavi=null,this._viewStack||(this._viewStack=[]);var e=this,i=this;t.items.forEach(function(n){n.navi||(n.navi=n.naviFn()),n.navi.on("highlight",function(){e._activeNavi&&e._activeNavi.navi.removeClass(t.activeNaviClass||"active-navi"),e._activeNavi=n,e._activeNavi.navi.addClass(t.activeNaviClass||"active-navi")}),n.navi.on("prepareNavi",function(){n.navi.trigger("highlight"),n.content||(n.content=n.contentFn()),n.content._naviItem||(n.content._naviItem=n)}),n.prepareNavigation=function(){if(n==e._activeNavi)return!1;if(t.onNavigation){var i=t.onNavigation(n);if(!i)return!1}return n.navi.trigger("prepareNavi"),!0},n.navi.on("navigate",function(){n!=e._activeNavi&&n.prepareNavigation()&&i.pushView(n.content)}),n.navi.on("click",function(){n.navi.trigger("navigate")}),n.navi.addClass(t.naviClass||"navi-item")}),this.onValue("popView",function(){console.log("Got the popview"),i.popView()}),this.onValue("pushView",function(t){var n=!1;return t==Object(t)?t._naviItem?void t._naviItem.trigger("navigate"):(e._navigation.items.forEach(function(e){n||e.content==t&&(e.navi.trigger("navigate"),n=!0)}),void(n||i.pushView(t))):(e._navigation.items.forEach(function(e){n||e.tag==t&&(e.navi.trigger("navigate"),n=!0)}),void(n||i.parent()&&i.parent().emitValue("pushView",t)))})},t.onMediaChange=function(t){r.push(t)},t.popView=function(t){if(!this._views)return this._views=[],this;var i=this;if(0==this._views.length&&t)return void this.pushView(t);if(e=this,t){var n=!0,r=this;return void i.forChildren(function(e){$(e._dom).fadeOut(200,function(){e.remove(),n&&($(t._dom).fadeIn(200,function(){$(t._dom).show()}),i.add(t),n=!1,t.scrollTo())})})}var a=this._views.pop();if(a.oldChildren&&a.oldChildren._children&&1==a.oldChildren._children.length&&a.oldChildren._children[0]._naviItem){var o=a.oldChildren._children[0]._naviItem;if(!o.prepareNavigation())return;var n=!0,r=this;return void i.forChildren(function(t){$(t._dom).fadeOut(200,function(){n&&($(o.content._dom).fadeIn(200,function(){$(o.content._dom).show()}),i.add(o.content),n=!1,o.content.scrollTo()),t.remove()})})}var n=!0,r=this;i.forChildren(function(t){$(t._dom).fadeOut(200,function(){if(n){var e=[];a.oldChildren.forChildren(function(t){$(t._dom).fadeIn(200,function(){$(t._dom).show()}),e.push(t)}),e.forEach(function(t){i.add(t)}),e[0]&&e[0].scrollTo(),a.oldTitle&&r.setTitle&&r.setTitle(a.oldTitle),n=!1}t.remove()})})},t.pushView=function(t,n){this._views||(this._views=[]);var r=this;if(!r._children||r._children[0]!=t){n||(n=null);var a=D("div"),o={parentView:null,oldTitle:this.__currentTitle,oldChildren:a,params:n},s=!0,c=!1,f=this;return this.onValue("pushView",function(t){f.pushView(t)}),this.onValue("popView",function(t){f.popView(t)}),e=this,i.lastSetValue=(new Date).getTime(),i.pushing=!0,document.location.hash=i.lastSetValue,r.forChildren(function(e){c=!0,$(e._dom).fadeOut(200,function(){s&&(r.add(t),$(t._dom).fadeIn(200),s=!1),a.add(e),t.scrollTo()})}),this._views.push(o),c||(r.add(t),$(t._dom).fadeIn(200),s=!1,t.scrollTo()),i.pushing=!1,this}},t.right=function(){return this.createLayoutElement("right")},t.scrollTo=function(){if(window){var t=this.offset(),e=window.pageXOffset,i=t.top;if(i<window.innerHeight/2)return;t.top<window.innerHeight?i/=2:i-=.2*window.innerHeight,window.scrollTo(e||0,parseInt(i))}},t.top=function(){return this.createLayoutElement("top")}}(this),function(t){var e,i,n,a,o,s,c;t._addCustomDir=function(t,e){c||(c={}),c[t]=e},t._addModelTemplate=function(t,i){var n=this.guid();e||(e={}),e[n]=i,t&&t.setAttribute&&t.setAttribute("data-tpl",n)},t._callCustom=function(t,e,i){c[t]&&c[t](e,i)},t._clearWorkers=function(t){t.workers.forEach(function(t){s._removeWorker(t)}),t.childViews.forEach(this._clearWorkers)},t._createViewDef=function(t,e){var i={dataid:t,baseTpl:null,parentView:e,workers:[],childViews:[]};return e&&e.childViews&&e.childViews.push(i),s._addModelView(t,i),i},t._eventActionFor=function(t,e,i){var n=t.target;if(n){var r=n.getAttribute(e),a=this;if(r){for(var o,s=10,c=n;c&&!(o=c.getAttribute("data-id"))&&s--;)c=c.parentNode;if(c&&o){var f=r.split("("),r=f.shift(),l=f.pop(),d=null;if(l)var h=l.split(")"),d=h.shift().split(",");var u=i.findFromCache(o);a.isFunction(u[r])&&(console.log("fires ",r,d),a.isArray(d)?u[r].apply(u,d):u[r]())}}}},t._findModelTemplate=function(t){if(t&&t.getAttribute){var i=t.getAttribute("data-tpl");if(e)return e[i]}},t._getNamedViews=function(){return o},t._getViewsOfModel=function(t){return e[t]},t._saveViewTemplate=function(t,e){n||(n={}),n[t]=e},t._searchNamedAreas=function(){for(var t=rootElement.querySelectorAll("[data-view]"),e=0;e<t.length;e++){var i=t[e];if(i&&i.getAttribute){var n=i.getAttribute("data-view");if("@"==n.charAt(0)){n.substring(1)}}}},t._setNamedModel=function(t,e){return a[t]=e,this},t._setNamedView=function(t,e){o[t]=e},t.broadcastDOMChange=function(t,e){return void s.execCommand(e)},t.compileTplRaw=function(t,e,i){if(i){var n=document.createElement(i);n.innerHTML=e}else{var n=document.createElement("DIV");n.innerHTML=e}var a=this;a.domIterator(n,function(e,i){if(8==e.nodeType)return!0;if("svg"==i)for(var n=0;n<e.childNodes.length;n++){e.childNodes[n]}else{if(e&&e.getAttribute){var o=e.getAttribute("data-view");if(o){var s=e.parentNode,c=e.innerHTML;console.log("*** FOUND VIEW TEMPLATE ***");var f={name:o,elem:e,baseTpl:c.trim(),parentTag:s.tagName};console.log(f),a._saveViewTemplate(o,f)}var l=e.getAttribute("data-model");if(l){var d,h={},u=!1;if(d=e.getAttribute("data-class-switch")){u=!0;for(var _=0;_<e.childNodes.length;_++){var p=e.childNodes[_];if(p.getAttribute){var v=p.getAttribute("data-class");v&&(h[v]=p.outerHTML)}}}var c=e.innerHTML;if(a._addModelTemplate(e,{baseTpl:c.trim(),classTpl:h,cProp:d}),e.innerHTML="",t.data[l]){var m=t.data[l];e.setAttribute("data-id",m.__id),e.setAttribute("data-sub-id",m.__id),m.forEach&&(c=c.trim(),m.forEach(function(t){if(d){if(t.data[d]){var i=t.data[d],n=h[i];if(n){n=n.trim();var r=a.createNewTemplate(t,n,e.tagName);e.appendChild(r)}}}else{var r=a.createNewTemplate(t,c,e.tagName);e.appendChild(r)}}))}return!0}var g=e.getAttribute("data-props");if(g){var y=g.split(","),b=e.innerHTML;return e.innerHTML="",b=b.trim().split("\n").join(" "),y.forEach(function(i){if(t.data[i]){var n=b.replace("{{propValue}}","{{"+i+"}}");n=n.replace("{{propName}}",i);var r=a.createNewTemplate(t,n,e.tagName);e.appendChild(r)}}),!0}}if(e.tagName&&"textarea"==e.tagName.toLowerCase())for(var w=e.value,y=a.findTemplateList(w),n=0;n<y.length;n++){var x=y[n];if(x.length>3&&"{"==x.charAt(0)&&"{"==x.charAt(1)){var C=x.substring(2,x.length-2);e.setAttribute("data-value-id",t.__id+"::"+C),e.value=t.data[C]}}if(e.tagName&&"style"==e.tagName.toLowerCase()){var w=e.innerHTML;w=w.trim();for(var y=a.findTemplateList(w),n=0;n<y.length;n++){var x=y[n];if(x.length>3&&"{"==x.charAt(0)&&"{"==x.charAt(1)){var C=x.substring(2,x.length-2);e.setAttribute("data-text-id",t.__id+"::"+C),e.textContent=t.data[C]}}}if(e.tagName&&"select"==e.tagName.toLowerCase()){var w=e.value,I=e.getAttribute("data-name");I&&e.setAttribute("data-value-id",t.__id+"::"+I)}var j=e instanceof HTMLElement;if(e.textContent&&!j&&"svg"!=i){var T=e.textContent;T.trim();var y=a.findTemplateList(T),O=document.createElement("span"),A=e.parentNode;if("textarea"!=A.tagName&&"style"!=A.tagName.toLowerCase()){e.parentNode.replaceChild(O,e),O.setAttribute("data-sid",t.__id);for(var n=0;n<y.length;n++){var k=document.createElement("span");k.setAttribute("data-sid",t.__id);var x=y[n];if(x.length>3&&"{"==x.charAt(0)&&"{"==x.charAt(1)){var C=x.substring(2,x.length-2);t.data[C]&&(a._setDomText(k,t.data[C]),k.setAttribute("data-text-id",t.__id+"::"+C)),O.appendChild(k)}else a._setDomText(k,x),O.appendChild(k)}return!0}}}"svg"==i?a.domAttrIterator(e,function(i,n){if("data-text"==i)e.setAttributeNS(null,"data-text-id",t.__id),a._setDomText(e,t.data[n]);else for(var r=a.findTemplateList(n),o=0;o<r.length;o++){var s=r[o];if(s.length>3&&"{"==s.charAt(0)&&"{"==s.charAt(1))if("value"==i){var c=s.substring(2,s.length-2);e.setAttributeNS(null,"data-value-id",t.__id+"::"+c),t.data[c]&&(e.value=t.data[c])}else{var c=s.substring(2,s.length-2);e.setAttributeNS(null,"data-attr-"+t.__id+"-"+c,i),t.data[c]&&e.setAttribute(i,t.data[c])}}},i):a.domAttrIterator(e,function(i,n){if("data-select"==i)return e.setAttribute("data-select-id",t.__id),e.setAttribute("data-select-value",n),void r().add(function(){a.domIterator(e,function(e){e&&e.setAttribute&&(e.setAttribute("data-select-id",t.__id),e.setAttribute("data-select-value",n))})});if("data-text"==i)e.setAttribute("data-text-id",t.__id),a._setDomText(e,t.data[n]);else for(var o=a.findTemplateList(n),s=0;s<o.length;s++){var c=o[s];if(c.length>3&&"{"==c.charAt(0)&&"{"==c.charAt(1))if("value"==i){var f=c.substring(2,c.length-2);e.setAttribute("data-value-id",t.__id+"::"+f),t[f]&&(e.value=t.data[f])}else{var f=c.substring(2,c.length-2);e.setAttribute("data-attr-"+t.__id+"-"+f,i),t[f]&&e.setAttribute(i,t.data[f])}}})});var o=n.childNodes[0];return o&&o.getAttribute&&(o.getAttribute("data-id")||o.setAttribute("data-id",t.__id)),o},t.composeModelView=function(t,e,i,n){var r,a=e,o=this,c=i.baseTpl;if(r=n?n:o._createViewDef(a.__id,i),c.classSwitch){var f;if(f=a.data[c.classSwitch]){var l=c.classTemplates[f];if(l){var d=o.composeTemplate(a,l,r);n?(console.log("Using Render to View ..."),n.dom.parentNode.replaceChild(d,n.dom)):t.appendChild(d),r.dom=d;var h=s._createWorker(a.__id,c.classSwitch,_workers().fetch(5),t,{view:r,template:c,m:a,dom:d});r.workers.push(h)}}}else{var u=c.children[0],d=o.composeTemplate(a,u,i);t.appendChild(d),r.dom=d}},t.composeTemplate=function(t,e,i){if(i||(i=this._createViewDef(t.__id),i.baseTpl=e),3==e.type){var n;if(e.txtParts&&e.txtParts.bHas)for(var n=document.createDocumentFragment(),r=e.txtParts.list,a=e.txtParts.tokens,o=0;o<r.length;o++){var f;if(f=a[o]){var l="";"undefined"!=typeof t.data[f]&&(l=t.data[f]||"");var d=document.createTextNode(l);n.appendChild(d);var h=s._createWorker(t.__id,f,_workers().fetch(1),d,null);i.workers.push(h)}else n.appendChild(document.createTextNode(r[o]||""))}else n=document.createTextNode(e.text||"")}if(1==e.type){var n,u=!1;if("svg"==e.tagName)n=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");else if("svg"==e.ns)var n=document.createElementNS("http://www.w3.org/2000/svg",e.tagName);else var n=document.createElement(e.tagName);var _=!1;if(i.dom||(i.dom=n),!u){if(e.valueParts&&e.valueParts.bHas){for(var r=e.valueParts.list,a=e.valueParts.tokens,o=0;o<r.length;o++){var f;if(f=a[o]){var l="";"undefined"!=typeof t.data[f]&&(l=t.data[f]||""),n.value=l;var h=s._createWorker(t.__id,f,_workers().fetch(2),n,null);i.workers.push(h),e._seta(n,"data-value-id",t.__id+"::"+f)}else n.appendChild(document.createTextNode(r[o]||""))}_=!0}e.attributes&&e.attributes.forEach(function(r){var a=r[0],o=r[1],f=r[2];if("value"!=a||!_){var l=!1;if(c[a]){var d,h={},u={currentView:i,model:t,binds:f,name:a,vars:h,value:d};if(f)for(var p=f.list,v=f.tokens,m=0;m<p.length;m++){var g;if(g=v[m]){var y="";"undefined"!=typeof t.data[g]&&(y=t.data[g]||""),h[g]=y,u.vars=h,u.value=y;var b=s._createWorker(t.__id,g,_workers().fetch(6),n,u);i.workers.push(b)}}c[a](n,u)}if(e.dataAttrs[a]&&"data-attr-fwd"==a){var w=o.split(",");w.forEach(function(r){r=r.trim();var a="",o=r,c=r.split("=>");if(c.length>1&&(o=c[1].trim(),r=c[0].trim()),"undefined"!=typeof t.data[r]&&(a=t.data[r]||""),e._seta(n,o,a),"svg"==e.ns)var f=s._createWorker(t.__id,r,_workers().fetch(4),n,o);else var f=s._createWorker(t.__id,r,_workers().fetch(3),n,o);i.workers.push(f),l=!0})}if(f)for(var p=f.list,v=f.tokens,m=0;m<p.length;m++){var g;if(g=v[m]){var y="";if("undefined"!=typeof t.data[g]&&(y=t.data[g]||""),e._seta(n,a,y),"svg"==e.ns)var b=s._createWorker(t.__id,g,_workers().fetch(4),n,a);
else var b=s._createWorker(t.__id,g,_workers().fetch(3),n,a);i.workers.push(b),l=!0}}l||e._seta(n,a,o)}})}if(e.children){var p=this;e.children.forEach(function(r){var a=r.dataAttrs["data-model"],o=r.dataAttrs["data-view"];if(a){if("svg"==r.ns)var c=document.createElementNS("http://www.w3.org/2000/svg",e.tagName);else var c=document.createElement(r.tagName);if("undefined"!=typeof t.data[a]){var f=t.data[a],l=p._createViewDef(f.__id,i);l.dom=c,o&&p._setNamedView(o,l),r._seta(c,"data-id",f.__id),l.tagName=r.tagName,l.baseTpl=r;var d=s._createWorker(f.__id,"*",_workers().fetch(7),l);l.workers.push(d),f.data.forEach&&f.data.forEach(function(t){p.composeModelView(c,t,l)}),n.appendChild(c)}}else{var c=p.composeTemplate(t,r,i);c&&n.appendChild(c)}})}}return n},t.createElemFromTpl=function(t,e){var i=this._findModelTemplate(t);console.log("Tpl",i);var n=i.cProp,r=i.baseTpl,a=e,o=this;if(!n){var s=o.createNewTemplate(a,r,t.tagName);return s}var c=i.classTpl;if(a.data[n]){var f=a.data[n],l=c[f];if(l){l=l.trim();var s=o.createNewTemplate(a,l,t.tagName);return s}}},t.createItemView=function(t){var e,i=this.getViewFunction(t),n=this;if(i&&(e=i(t),t.viewClass&&this.isFunction(t.viewClass))){var r=t.viewClass(null,!0),a=t.viewClass(),o=function(i,s){if(a!=s){console.log("Replaced to "+s);var c=n.createItemView(t);a=s,e.replaceWith(c),e=c,r.me.removeListener(r.name,o)}};r.me.on(r.name,o)}return e},t.createNewTemplate=function(t,e,i){if(i){var n=document.createElement(i.tagName);n.innerHTML=e}else{var n=document.createElement("DIV");n.innerHTML=e}var a=this._createViewDef(t.__id,i);a.baseTpl=e;var o=this;o.domIterator(n,function(e,i){if(8==e.nodeType)return!0;if("svg"==i)for(var n=0;n<e.childNodes.length;n++){e.childNodes[n]}else{if(e&&e.getAttribute){var c=e.getAttribute("data-view"),f=e.getAttribute("data-model");if(c&&!f&&o._setNamedView(c,a),f){var l,d={},h=!1;if(l=e.getAttribute("data-class-switch")){h=!0;for(var u=0;u<e.childNodes.length;u++){var _=e.childNodes[u];if(_.getAttribute){var p=_.getAttribute("data-class");p&&(d[p]=_.outerHTML)}}}var v=e.innerHTML;if(o._addModelTemplate(e,{baseTpl:v.trim(),classTpl:d,cProp:l}),e.innerHTML="","undefined"!=typeof t.data[f]){var m=t.data[f],g=o._createViewDef(m.__id,a);g.dom=e,c&&o._setNamedView(c,g),e.setAttribute("data-id",m.__id),e.setAttribute("data-sub-id",m.__id),g.tagName=e.tagName,m.data.forEach&&(v=v.trim(),m.data.forEach(function(t){if(l){if("undefined"!=typeof t.data[l]){var i=t.data[l],n=d[i];if(n){n=n.trim();var r=o.createNewTemplate(t,n,g);e.appendChild(r)}}}else{var r=o.createNewTemplate(t,v,g);e.appendChild(r)}}))}return!0}var y=e.getAttribute("data-props");if(y){var b=y.split(","),w=e.innerHTML;return e.innerHTML="",w=w.trim().split("\n").join(" "),b.forEach(function(i){if("undefined"!=typeof t.data[i]){var n=w.replace("{{propValue}}","{{"+i+"}}");n=n.replace("{{propName}}",i);var r={tagName:e.tagName},a=o.createNewTemplate(t,n,r);e.appendChild(a)}}),!0}}if(e.tagName&&"textarea"==e.tagName.toLowerCase())for(var x=e.value,b=o.findTemplateList(x),n=0;n<b.length;n++){var C=b[n];if(C.length>3&&"{"==C.charAt(0)&&"{"==C.charAt(1)){var I=C.substring(2,C.length-2);e.setAttribute("data-value-id",t.__id+"::"+I),e.value=t.data[I]}}if(e.tagName&&"style"==e.tagName.toLowerCase()){var x=e.innerHTML;x=x.trim();for(var b=o.findTemplateList(x),n=0;n<b.length;n++){var C=b[n];if(C.length>3&&"{"==C.charAt(0)&&"{"==C.charAt(1)){var I=C.substring(2,C.length-2);e.setAttribute("data-text-id",t.__id+"::"+I),e.textContent=t.data[I]}}}if(e.tagName&&"select"==e.tagName.toLowerCase()){var x=e.value,j=e.getAttribute("data-name");j&&e.setAttribute("data-value-id",t.__id+"::"+j)}var T=e instanceof HTMLElement;if(e.textContent&&!T&&"svg"!=i){var O=e.textContent;O.trim();var b=o.findTemplateList(O),A=document.createElement("span"),k=e.parentNode;if("textarea"!=k.tagName&&"style"!=k.tagName.toLowerCase()){e.parentNode.replaceChild(A,e),A.setAttribute("data-sid",t.__id);for(var n=0;n<b.length;n++){var E=document.createElement("span");E.setAttribute("data-sid",t.__id);var C=b[n];if(C.length>3&&"{"==C.charAt(0)&&"{"==C.charAt(1)){var I=C.substring(2,C.length-2);if("undefined"!=typeof t.data[I]){var S=s._createWorker(t.__id,I,_workers().fetch(1),E,null);a.workers.push(S),o._setDomText(E,t.data[I]),E.setAttribute("data-text-id",t.__id+"::"+I)}A.appendChild(E)}else o._setDomText(E,C),A.appendChild(E)}return!0}}}"svg"==i?o.domAttrIterator(e,function(i,n){if("data-text"==i)e.setAttributeNS(null,"data-text-id",t.__id),o._setDomText(e,t.data[n]);else for(var r=o.findTemplateList(n),a=0;a<r.length;a++){var s=r[a];if(s.length>3&&"{"==s.charAt(0)&&"{"==s.charAt(1))if("value"==i){var c=s.substring(2,s.length-2);e.setAttributeNS(null,"data-value-id",t.__id+"::"+c),t.data[c]&&(e.value=t.data[c])}else{var c=s.substring(2,s.length-2);e.setAttributeNS(null,"data-attr-"+t.__id+"-"+c,i),t.data[c]&&e.setAttribute(i,t.data[c])}}},i):o.domAttrIterator(e,function(i,n){if("data-select"==i)return e.setAttribute("data-select-id",t.__id),e.setAttribute("data-select-value",n),void r().add(function(){o.domIterator(e,function(e){e&&e.setAttribute&&(e.setAttribute("data-select-id",t.__id),e.setAttribute("data-select-value",n))})});if("data-text"==i)e.setAttribute("data-text-id",t.__id),o._setDomText(e,t.data[n]);else for(var c=o.findTemplateList(n),f=0;f<c.length;f++){var l=c[f];if(l.length>3&&"{"==l.charAt(0)&&"{"==l.charAt(1))if("value"==i){var d=l.substring(2,l.length-2);e.setAttribute("data-value-id",t.__id+"::"+d);var h=s._createWorker(t.__id,d,_workers().fetch(2),e,null);a.workers.push(h),"undefined"!=typeof t.data[d]&&(e.value=t.data[d])}else{var d=l.substring(2,l.length-2);e.setAttribute("data-attr-"+t.__id+"-"+d,i),"undefined"!=typeof t.data[d]&&e.setAttribute(i,t.data[d])}}})});var c=n.childNodes[0];return c&&c.getAttribute&&(c.getAttribute("data-id")||c.setAttribute("data-id",t.__id)),a.dom=c,c},t.findTemplateList=function(t){var e=t.split("{{"),i=e.length;if(2>i)return[t];for(var n=[],r=0;r<e.length;r++){var a=e[r];if(0!=a.length){var o=a.split("}}");o.length>1?(n.push("{{"+o[0]+"}}"),n.push(o[1])):n.push(a)}}return n},t.getViewFunction=function(t){if(this.isFunction(this._view))return this._view;if(t.viewClass){var e;if(e=this._view[t.viewClass()])return e}for(var i in this._view)if(this._view.hasOwnProperty(i)){var e=this._view[i];if(this.isFunction(e))return e}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){a||(a={},o={},s=P())}),t.mvc=function(t,e,i){var n=this;return e&&(this._view=e),t&&(this._model=t,this._model.on&&(this._model.on("insert",function(t,e){var i=n._model.item(e),r=n.createItemView(i);r&&n.insertAt(e,r)}),this._model.on("move",function(t,e){var i=n.child(e.from),r=n.child(e.to);return r&&i?void(e.to<e.from?r.insertBefore(i):r.insertAfter(i)):(console.log("**** could not perform move ****"),console.log(e),console.log(n),console.log(n._children.length),console.log(i),console.log(r),void console.trace())}),this._model.on("remove",function(t,e){var i=n.child(e);i&&i.remove()}),this._model.on("sort",function(t,e){if(0!=e.length&&!n.isObject(e[0][1])){for(var i=new Array,r=0;r<e.length;r++)e[r][1]!=e[r][2]?(i[r]=new Array(3),i[r][1]=n.child(e[r][1]),i[r][2]=n.child(e[r][2])):e[r][0]=null;for(var r=0;r<i.length;r++){var a=i[r][1],o=i[r][2],s=e[r][0];"a"==s&&o.insertBefore(a),"b"==s&&o.insertAfter(a)}}})),this._model.forEach&&this._model.forEach(function(t){var e=n.createItemView(t);e&&n.add(e)})),i&&(this._controller=i),this},t.popCurrentView=function(t){if(n){i||(i={});var e=document.querySelector("[data-view='"+t+"']");if(e){console.log("*** FOUND The view...*****"),i[t]||(i[t]=[]);var r=i[t].pop();if(!r)return;var a=n[t],o=this.createNewTemplate(r.model,a.baseTpl,a.parentTag);console.log("Created newDom ",o.innerHTML),e.innerHTML="",e.appendChild(o)}}},t.pushToView=function(t,e){if(n){i||(i={});var r=document.querySelector("[data-view='"+t+"']"),a=this;if(r){console.log("*** FOUND The view...*****"),i[t]||(i[t]=[]);var o=n[t],s=this.createNewTemplate(e,o.baseTpl,o.parentTag);console.log("Created newDom ",s.innerHTML),r.innerHTML="",r.appendChild(s),e._didBindA||(e._didBindA=!0,e.onValue("change",function(t){a.broadcastDOMChange(document,t)}));var c={model:e};i[t].push(c)}}},t.renderTemplate=function(t,e){var i,n=this,r=this;if(this.isFunction(e)){var a=e(null,!0);a.me.on(a.name,function(){r.renderTemplate(t,e())}),i=e()}else i=e;r.clear(),r.evenInfo||(r.evenInfo={isOn:!1}),n._hasRenderCh||(n._dom.addEventListener("dblclick",function(e){r._eventActionFor(e,"data-dbl-click",t)}),n._dom.addEventListener("mouseenter",function(e){r._eventActionFor(e,"data-mouseenter",t)}),n._dom.addEventListener("mouseleave",function(e){r._eventActionFor(e,"data-mouseleave",t)}),n._dom.addEventListener("mousemove",function(e){r._eventActionFor(e,"data-mousemove",t)}),n._dom.addEventListener("keydown",function(e){r._eventActionFor(e,"data-keydown",t)}),n._dom.addEventListener("keyup",function(e){r._eventActionFor(e,"data-keyup",t)}),n._dom.addEventListener("change",function(e){r._eventActionFor(e,"data-change",t)}),n._dom.addEventListener("click",function(e){var i=e.target;if(i){var a=i.getAttribute("data-sid"),o=i.getAttribute("data-id");if(a&&!o){i=i.parentNode;var a=i.getAttribute("data-sid"),o=i.getAttribute("data-id");a&&!o&&(i=i.parentNode)}var s=i.getAttribute("data-select-id");if(s){var c=t.findFromCache(s),f=i.getAttribute("data-select-value");n.emitValue("select",{obj:c,value:f})}var s=i.getAttribute("data-popview");if(s)for(var l=i;l;){if(l.getAttribute){var d;if(d=l.getAttribute("data-view")){r.popCurrentView(d);break}}l=l.parentNode}var h=i.getAttribute("data-action");if(h){for(var u,_=10,p=i;p&&!(u=p.getAttribute("data-id"))&&_--;)p=p.parentNode;if(p&&u){var v=h.split("("),h=v.shift(),m=v.pop(),g=null;if(m)var y=m.split(")"),g=y.shift().split(",");var c=t.findFromCache(u);c&&r.isFunction(c[h])&&(r.isArray(g)?c[h].apply(c,g):c[h]())}}}}),n._hasRenderCh=!0,n._dom.addEventListener("input",function(t){var e=t.target;if(e){var i=e.getAttribute("data-value-id");if(i){var n=i.split("::"),r=n[0],a=P()._find(r),o=n[1];if(!a)return;if("undefined"!=typeof a.data[o]){var s=e.value,c=a.data[o];s!=c&&(a.data[o]=s,P()._emitEvent(n[0],"change",[4,o,s,c,r]))}}}})),i=i.trim();try{var o=this.createNewTemplate(t,i)}catch(s){return this}return this._dom.appendChild(o),t._didBindA||(t._didBindA=!0,P()._onValue(t.__id,"change",function(t){r.broadcastDOMChange(document,t)})),this},t.template=function(t,e){this._htmlTemplate=e},t.templateIterator=function(t,e,i){if(t){var n=t.children;if(n)for(var r=n.length,a=0;r>a;a++){var o=n[a];if(o){var s=e(o,i);s||this.templateIterator(o,e)}}}}}(this),function(t){t.circle=function(t,e){var i=this.shortcutFor("circle",t,e);return i},t.createPath=function(t,e,i){var n=d();return n.parse(t),n.makePathAbsolute(),e&&i&&n.fitPathInto(e,i),this.path({d:n.svgString()})},t.createShadowFilter=function(t,e,i,n){var a=this;r().add(function(){for(;a&&"svg"!=a._dom.tagName;)a=a.parent(),console.log("Looking ",a);if(a?(console.log("Found svgRoot for filter "+t),console.log("Tag is ",a._dom.tagName,a)):console.log("Did not find the svgRoot for filter "+t),i||(i=0),n||(n=0),e||(e=5),a&&"svg"==a._dom.tagName){var r=null;a.forChildren(function(t){"defs"==t._dom.tagName&&(r=t)});var o;o=r?r:a.defs(),console.log("Defs for "+t,"is",o);var s=o.filter("",{id:t,height:"130%"});s.feGaussianBlur("",{"in":"SourceAlpha",stdDeviation:e}),s.feOffset("",{dx:i,dy:n,result:"offsetblur"});var c=s.feMerge();return c.feMergeNode(),c.feMergeNode("",{"in":"SourceGraphic"}),s}})},t.defs=function(t,e){var i=this.shortcutFor("defs",t,e);return i},t.draggableBox=function(t){t=t||{},t.x||(t.x=0),t.y||(t.y=0);var e=_data({x:t.x,y:t.y,alpha:t.alpha||1}),i=this.rect("",{fill:t.fillStyle||"yellow",x:e.x,y:e.y,width:10,height:10,"fill-opacity":e.alpha});i._data=e,i._x=e.x(),i._y=e.y();var n,r;return i.draggable(function(){n=e.x(),r=e.y(),i.trigger("focus")},function(t,a){e.x(a.dx+n),e.y(a.dy+r),i._x=e.x(),i._y=e.y(),i.trigger("x",e.x()),i.trigger("y",e.y()),i.trigger("change")},function(t,a){e.x(a.dx+n),e.y(a.dy+r),i.trigger("x",e.x()),i.trigger("y",e.y()),i._x=e.x(),i._y=e.y(),i.trigger("blur")}),i},t.feGaussianBlur=function(t,e){var i=this.shortcutFor("feGaussianBlur",t,e);return i},t.feMerge=function(t,e){var i=this.shortcutFor("feMerge",t,e);return i},t.feMergeNode=function(t,e){var i=this.shortcutFor("feMergeNode",t,e);return i},t.feOffset=function(t,e){var i=this.shortcutFor("feOffset",t,e);return i},t.filter=function(t,e){var i=this.shortcutFor("filter",t,e);return i},t.g=function(t,e){var i=this.shortcutFor("g",t,e);return i},t.image=function(t,e){var i=this.shortcutFor("image",t,e);return i},t.line=function(t,e){var i=this.shortcutFor("line",t,e);return i},t.path=function(t,e){var i=this.shortcutFor("path",t,e);return i},t.rect=function(t,e){var i=this.shortcutFor("rect",t,e);return i},t.svg=function(t,e){var i=this.shortcutFor("svg",t,e);return i},t.svg_text=function(t,e){var i=this.shortcutFor("text",t,e);return i},t.tspan=function(t,e){var i=this.shortcutFor("tspan",t,e);return i}}(this),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.bs_accordion=function(t){var e=D("div").addClass("panel-group"),i=e.guid();e.q.attr("id",i);var n=this;return t.items.forEach(function(t){var r=e.guid();t.body_collapse_id=r;var a=n.panel(t);e.add(a);var o=a.component_title();if(o){o.clear();var s=o.a("",{"data-toggle":"collapse","data-parent":"#"+i,href:"#"+r});s.add(t.title)}}),e},t.bs_breadcrumb=function(t){var e=D("div"),i=e.ol("breadcrumb");return t.items&&t.items.forEach(function(e){var n=i.li().a().text(e.title);n.on("click",function(){e.action&&e.action(),e.view&&t.content&&t.content.pushView(e.view)})}),e},t.bs_button=function(t,e){var i="";t.size&&("xs"==t.size&&(i="btn-xs"),"s"==t.size&&(i="btn-sm"),"l"==t.size&&(i="btn-lg"),"m"==t.size&&(i=""));var n=D("button");return n.addClass("btn btn-"+(t.type||"default")),i&&n.addClass(i),this.bs_setItemContent(t,n),this.bs_setItemAction(t,n,e),this.add(n),n},t.bs_buttonDropdown=function(t){var e=D("div").addClass("btn-group"),i=e.button("btn btn-default dropdown-toggle",{"data-toggle":"dropdown",type:"button"});t.title&&i.span().text(t.title),i.span("caret");var n=e.ul("dropdown-menu",{role:"menu"});return t.items&&t.items.forEach(function(e){var i=n.li(),r=i.a();e.leftBadge&&r.span("badge").text(e.leftBadge),e.title&&r.span().add(e.title),e.rightBadge&&r.span("badge").text(e.rightBadge),e.active&&i.addClass("active"),r.on("click",function(){e.action&&e.action(),e.view&&t.content&&t.content.pushView(e.view)})}),e},t.bs_buttonGroup=function(t){var e=D("div").addClass("btn-group"),i=this;return t.items&&t.items.forEach(function(n){var r=i.button(n,t);e.add(r)}),e},t.bs_componentSubitems=function(t,e){if(e.buttongroup){var i=this.buttonGroup(e.buttongroup);t.add(i)}},t.bs_createButton=function(t,e,i){return i||(i="myButton"),D("button").addClass(i).add(D("span").addClass("fa fa-"+t),D("span").text(e))},t.bs_createDropDown=function(t){var e=D("div"),i=D("button").addClass("buttonStyle").text("Drop Down Text");e.addItem(i);var n=this.dropDownMenu(0,0);e.addItem(n);var r=(D("div"),n.content());return t.forEach(function(t){var e=D("table").addRow(D("div").addClass("circlebtn-13").text("<span class='fa fa-user'>"),t.text),i=D("div").addItem(e);r.addItem(i),i.q.css("font-size",12),i.on("click",function(){n.val(t),n.hide()})}),n.content().addClass("ddMenuStyle"),n.on("value",function(){i.text(""),i.clear();var t=D("table").addRow(D("div").addClass("circlebtn-13").text("<span class='fa fa-user'>"),n.val().text);t.q.css("font-size",16).css("line-height",2).css("width",130),i.addItem(t),e.trigger("value",n.val())}),e.val=function(){return n.val()},i.on("click",function(){n.show()}),e},t.bs_createListItem=function(t){var e,i={},n=i.liElem||"li",r=D(n);r.addClass(t.itemClass||i.itemClass||"list-group-item");var e;return e=i.listClass?r[i.aElem||"a"]():r,t.iconImg&&e.img("iconImg",{src:t.iconImg}),t.leftBadge&&e[i.spanElem||"span"]("badge").text(t.leftBadge),t.title&&e[i.titleElem||i.spanElem||"span"]("title").add(t.title),t.rightBadge&&e[i.spanElem||"span"]("badge").text(t.rightBadge),t.active&&r.addClass("active"),e.on("click",function(){t.viewFn&&(t.view||(t.view=t.viewFn())),t.action&&t.action()(),t.view&&i.content&&i.content.pushView(t.view)}),r},t.bs_createSubNavigator=function(t,e,i){var n,r=D("div"),a=[],o=0;return e.forEach(function(){!function(o){t[o]&&(t[o].addClass("navi-item"),t[o].on("click",function(){if(n){if(n==t[o])return;n.removeClass("activeNavi"),t[o].addClass("activeNavi"),n=t[o]}else t[o].addClass("activeNavi"),n=t[o];a[o]?i.pushView(a[o]):(e[o](),a[o]=i.getCurrentView())}),r.add(t[o]))}(o);o++}),r},t.bs_dateInputEditable=function(t){var e;e=t?Date.parse(t):new Date,e||(e=new Date);var i=D("div"),n=D("div"),r=D("table"),a=D("div").text(t).addClass("textDisplay"),o=createButton("save","Save"),s=createButton("ban","Cancel"),c=createButton("edit","Edit","myButton2");r.addRow(a,c),n.addItem(r);for(var f=!1,l=D("table"),d=D("select"),h=D("select"),u=D("select"),_=(new Date).getFullYear(),p=1,v=1;_>1900;){var m=D("option").val(_).text(_);d.addItem(m),e.getFullYear()==_&&(m.q.attr("selected",!0),d.val(_)),_--}for(var g=["January","February","March","April","May","June","July","August","September","October","November","December"];12>=p;){var m=D("option").val(p).text(g[p-1]);h.addItem(m),e.getMonth()+1==p&&(m.q.attr("selected",!0),h.val(p)),p++}for(;31>=v;){var m=D("option").val(v).text(v);u.addItem(m),e.getDate()==v&&(m.q.attr("selected",!0),u.val(v)),v++}return d.on("value",function(){l.trigger("value")}),h.on("value",function(){l.trigger("value")}),u.on("value",function(){l.trigger("value")}),l.addClass("dateSelect"),l.addRow(d,h,u,o),l.val=function(){return d.val()+"-"+h.val()+"-"+u.val()},l.on("value",function(){console.log(l.val())}),l.hide(),n.on("click",function(){f=!0,n.hide(),l.show()}),o.on("click",function(){n.show(),l.hide(),t=l.val(),a.text(t),i.trigger("value")}),s.on("click",function(){n.show(),l.hide()}),i.addItem(n).addItem(l),i.val=function(){return t},i},t.bs_dropdown=function(t){var e=D("ul").addClass("dropdown-menu");return e.q.attr("role","menu"),t.items&&t.items.forEach(function(i){var n=e.li("",{role:"presentation"}),r=n.a("",{role:"menuitem",href:"#",tabindex:-1});i.leftBadge&&r.span("badge").text(i.leftBadge),i.title&&r.span().add(i.title),i.rightBadge&&r.span("badge").text(i.rightBadge),i.active&&n.addClass("active"),r.on("click",function(){i.action&&i.action(),i.view&&t.content&&t.content.pushView(i.view)})}),e},t.bs_dropDownMenu=function(t,e){var i=D("div"),n=D("div"),r=!1;t||(t=0),e||(e=0),i.q.css("position","relative"),n.q.css("position","absolute").css("left",t).css("top",e),n.hide(),i.addItem(n),i.show=function(){return r?void i.hide():($(n._dom).slideDown(),void(r=!0))};var a;return i.val=function(t){return"undefined"!=typeof t&&(a=t,i.trigger("value")),a},i.hide=function(){$(n._dom).slideUp(),r=!1},i.content=function(){return n},i.x=function(e){return t=e,n.q.css("left",e),i},i.y=function(t){return e=t,n.q.css("top",t),i},i},t.bs_fileupload=function(t){var e=D(),i=e.form("",{action:t.target,enctype:"multipart/form-data",method:"POST",name:e.guid()}),n=t.maxCnt||20,r=function(e){t.onComplete&&t.onComplete(e)},a="complete"+(new Date).getTime();if(window[a]=r,i.input("",{type:"hidden",value:a,name:"onComplete"}),i.label("control-label").text(_t(t.title||"Valitse tiedostot")),t.vars)for(var o in t.vars)t.vars.hasOwnProperty(o)&&i.input("",{type:"hidden",value:t.vars[o],name:o});var s=i.div("form-group"),c=t.maxFileCnt||5,f=0,l=function(){if(!(f>=c)){var i=s.input("",{type:"file",name:"file_"+f});i.on("value",function(){t.autoUpload?e.uploadFiles():n>f&&l()}),f++}};l();var d=D("iframe"),h=e.guid();return d.q.attr("id",h),d.q.attr("name",h),d.absolute().x(-4e3).y(-4e3),e.add(d),e.uploadFiles=function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&i.input("",{type:"hidden",value:t[e],name:e});i._dom.target=h,i._dom.submit(),s.clear(),f=0,l()},t.getUploader&&t.getUploader(e.uploadFiles),this.add(e),e},t.bs_form=function(t,e){var i=D().div("",{role:"form"}),n=this,r=D("div").addClass("btn-group"),a=D("div").addClass("textDisplayHead").addClass("errorDisplay").text(" ");return i.add(a),e.fields.forEach(function(e){var a,o=t[e.name],s=e.name,c=s,f=(i.div("inputError"),"str"),l=e.name.split(":");if(2==l.length?(f=l[1],s=l[0],c=s):("btn"==e.name.substr(0,3)&&(f="btn",c=e.name.substr(3)),f||"b"!=e.name.substr(0,1)||(f="bool"),f||"i"!=e.name.substr(0,1)||(f="int"),f||"pe"!=e.name.substr(0,2)||(f="pw"),f||"date"!=e.name.substr(0,4)||(f="date"),"text"==e.type&&(f="text")),"file"==f&&e.target){var d=n.bs_fileupload({target:e.target,title:e.text,vars:e.vars||{},getUploader:e.getUploader});i.add(d)}if("custom"==f)return void(e.content&&i.add(e.content));var h={type:"text",bind:{data:t,name:s},text:e.text,joyride:e.joyride};if("str"==f&&(h.type="text",i.bs_input(h)),"bool"==f){a=D("checkbox"),a.checked(parseInt(o)),a.bind(t,s);var u=i.div("checkbox");u.label().add(a).span().text(e.text)}"password"==f&&(h.type="password",i.bs_input(h)),"text"==f&&(h.rows=e.rows||6,h.type="textarea",i.bs_textarea(h)),"date"==f&&(h.type="date",i.bs_input(h)),"time"==f&&(h.type="time",i.bs_input(h)),"btn"==f&&r.bs_button({title:e.text,type:e.type||"primary"}).on("click",function(){return i.trigger(c),!1})}),i.add(r),this.add(i),i},t.bs_formAsDivs=function(t,e){var i=D("div"),n=this;i.addClass("formarea");var r=D("div");r.addClass("formTable");var a=D("div").addClass("formButtons"),o=D("div").addClass("textDisplayHead").addClass("errorDisplay").text(" ");return r.add(o),i.error=function(t){return o.clear(),o.addItem(t),i},e.fields.forEach(function(e){var o,s=t[e.name],c=e.name,f=c,l=r.div("inputError"),d="str",h=e.name.split(":");if(2==h.length?(d=h[1],c=h[0],f=c):("btn"==e.name.substr(0,3)&&(d="btn",f=e.name.substr(3)),d||"b"!=e.name.substr(0,1)||(d="bol"),d||"i"!=e.name.substr(0,1)||(d="int"),d||"pe"!=e.name.substr(0,2)||(d="pw"),d||"date"!=e.name.substr(0,4)||(d="date"),"text"==e.type&&(d="text")),"btn"==d&&(o=n.createButton(e.name.substr(3),e.text,e.className),a.addItem(o),a.addItem(D("span").text(" ")),o.on("click",function(){i.trigger(f)})),"bool"==d){o=D("checkbox"),o.checked(parseInt(s)),o.bind(t,c);var u=r.div("checkBoxHolder").add(o),_=D("div").addClass("checkBoxHead").text(e.text);u.add(_)}if("int"==d){o=D("input").addClass("textDisplay");var _=D("div").addClass("textDisplayHead").text(e.text);r.add(_,o),o.bind(t,c)}if("str"==d){o=D("input").addClass("textDisplay");var _=D("div").addClass("textDisplayHead").text(e.text);r.add(_,o),o.bind(t,c)}if("text"==d){o=D("textarea").addClass("textArea");var _=D("div").addClass("textDisplayHead").text(e.text);r.add(_,o),o.bind(t,c)}if("password"==d){o=D("input").addClass("textDisplay"),o.q.attr("type","password"),o.bind(t,c);var _=D("div").addClass("textDisplayHead").text(e.text);r.add(_,o)}if("date"==d){o=n.dateInputEditable(s);var _=D("div").addClass("textDisplayHead").text(e.text);r.add(_,o)}e.validator&&o.on("value",function(){var t;(t=e.validator(o))?(l.add(t),l.addClass("errorActive")):l.removeClass("errorActive")})}),r.add(a),i.addItem(r),i},t.bs_genericTabSelector=function(t,e){var i,n=D("div"),r=n.div("tabContainer"),a=r.div("tabLeft"),o=r.div("tabRight"),s=0,c=null,f=0;t.forEach(function(n){var r=a.div("tabName").add(n);r.on("click",function(n){if(s!=n.__index){e[s].hide(),e[n.__index].show();{t[s]}i.removeClass("tabName").addClass("tabItemNotActive"),c=e[n.__index],s=n.__index,r.removeClass("tabItemNotActive").addClass("tabName"),i=r}}),r.__index=f,f>0?(r.removeClass("tabName"),r.addClass("tabItemNotActive")):(i=r,r.removeClass("tabItemNotActive")),f++});var f=0;return e.forEach(function(t){f>0?t.hide():(t.show(),c=t),o.add(t),f++}),n},t.bs_infoAsTable=function(t,e){var i=D("div");i.addClass("formarea");var n=D("table");n.addClass("formTable");var r=D("div"),a=D("div").addClass("textDisplayHead").addClass("errorDisplay").text(" ");return n.addRow("",a),i.error=function(t){return a.clear(),a.addItem(t),i},e.fields.forEach(function(e){{var i;t[e.name]}if("btn"==e.name.substr(0,3)||"b"==e.name.substr(0,1)&&(i=D("div").text("X"),n.addRow("",D("table").addRow(i,e.text))),"i"==e.name.substr(0,1)){i=D("div").addClass("textDisplay");var r=D("div").addClass("textDisplayHead").text(e.text);n.addRow(r,i),i.bind(t,e.name)}if("str"==e.name.substr(0,3))if(e.type&&"text"==e.type){i=D("div").addClass("textArea");var r=D("div").addClass("textDisplayHead").text(e.text);n.addRow(r,i),i.bind(t,e.name)}else{i=D("duv").addClass("textDisplay");var r=D("div").addClass("textDisplayHead").text(e.text);n.addRow(r,i),i.bind(t,e.name)}"date"==e.name.substr(0,4)}),n.addRow("",r),i.addItem(n),i},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.bs_input=function(t){var e=D("div").addClass("form-group");t.feedback&&e.addClass("has-success has-feedback");var i=e.guid();t.text&&e.label("control-label",{"for":i}).text(t.text);var n=e.input("form-control",{id:i,type:t.type||"text"});t.joyride&&(n._joyride=t.joyride),t.bind&&n.bind(t.bind.data,t.bind.name);var r,a="glyphicon-ok";return t.feedback&&(r=e.span("glyphicon form-control-feedback"),r.hide()),e.setFeedback=function(t){r.removeClass(a),"ok"==t&&(a="glyphicon-ok"),"error"==t&&(a="glyphicon-remove"),"warning"==t&&(a="glyphicon-warning-sign"),r.addClass(a)},this.add(e),e},t.bs_joyride=function(t){var e=[],i=function(t){t._joyride&&e.push(t),t.forChildren(i)};i(t);var n,r=this,a=0;n=r.popover({title:"Otsikko",content:"Sislt",type:"info",position:"right",footer:r.pager({items:[{title:"Edellinen",action:function(){0==a&&(a=e.length),a--,c(a)}},{title:"Seuraava",action:function(){a++,a==e.length&&(a=0),c(a)}}]})}).absolute();var o=D("body",document.body);o.add(n);var s,c=function(t){n._dom.style.display="block",s&&s.removeClass("joyride-info");var i=e[t];i.addClass("joyride-info");var r=i.offset(),a=n.box(),o=i.box();n.x(r.left+200).y(r.top-a.height/2+o.height/2),n.component_title(i._joyride.title),n.component_content(i._joyride.content)};e.length&&c(0)},t.bs_jumbotron=function(t){var e=D("div"),i=e.div("jumbotron");return t.content&&i.add(t.content),e},t.bs_listgroup=function(t){var e=this,i=D(t.ulElem||"ul").addClass(t.listClass||"list-group");return t.className&&i.addClass(t.className),t.items&&t.items.forEach(function(n){var r;if(n.dropdown&&t.listClass){var a=i.li("dropdown"),r=a.a("dropdown-toggle",{"data-toggle":"dropdown",href:"#"});setTimeout(function(){$(r._dom).dropdown()},50)}else{var r,o=t.liElem||"li",a=i[o](n.itemClass||t.itemClass||"list-group-item");r=t.listClass?a[t.aElem||"a"]():a}n.iconImg&&r.img("iconImg",{src:n.iconImg}),n.leftBadge&&r[t.spanElem||"span"]("badge").text(n.leftBadge),n.title&&r[t.titleElem||t.spanElem||"span"]("title").add(n.title),e.componentSubitems(a,n,t),n.rightBadge&&r[t.spanElem||"span"]("badge").text(n.rightBadge),n.active&&a.addClass("active"),n.dropdown&&t.listClass&&(r[t.spanElem||"span"]("caret"),a.add(n.dropdown)),r.on("click",function(){n.viewFn&&(n.view||(n.view=n.viewFn())),n.action&&n.action(),n.view&&t.content&&t.content.pushView(n.view)})}),i},t.bs_listgrouptest=function(t){var e=this,i=D(t.ulElem||"ul").addClass(t.listClass||"list-group");t.className&&i.addClass(t.className);var n=function(n){var r,r,a=t.liElem||"li",o=i[a](n.itemClass||t.itemClass||"list-group-item");r=t.listClass?o[t.aElem||"a"]():o,n.iconImg&&r.img("iconImg",{src:n.iconImg}),n.leftBadge&&r[t.spanElem||"span"]("badge").text(n.leftBadge),n.title&&r[t.titleElem||t.spanElem||"span"]("title").add(n.title),e.componentSubitems(o,n,t),n.rightBadge&&r[t.spanElem||"span"]("badge").text(n.rightBadge),n.active&&o.addClass("active"),r.on("click",function(){n.viewFn&&(n.view||(n.view=n.viewFn())),n.action&&n.action()(),n.view&&t.content&&t.content.pushView(n.view)})};return t.items&&(t.items.forEach(n),t.items.on("insert",function(e,i){n(t.items.item(i))})),i},t.bs_maincontent=function(t){var e,i,n,r=D("div").addClass("page page-"+(t.type||"default")),a=r.div("page-heading");if(t.body_collapse_id){var o=r.div("panel-collapse collapse",{id:t.body_collapse_id});e=o.div("panel-body"),i=o.div("panel-footer")}else e=r.div("page-body"),i=r.div("page-footer");return t.heading&&a.add(t.heading),t.title&&(n=a.h1("page-title"),n.add(t.title)),t.content&&e.add(t.content),t.footer&&i.add(t.footer),this.setContentFunctions(r,{heading:a,title:n,content:e,footer:i}),r},t.bs_navbar=function(t){console.log("Navbar test...");var e=D("nav").addClass("navbar navbar-default"),i=e.div("container-fluid"),n=i.guid(),r=i.div("navbar-header"),a=r.button("navbar-toggle collapsed",{type:"button","data-toggle":"collapse","data-target":"#"+n});console.log("Navbar test...2"),a.span("sr-only").text("Avaa navigaatio"),a.span("icon-bar"),a.span("icon-bar"),a.span("icon-bar"),t.leftIcon&&r.a("navbar-brand",{href:"#"}).add(t.leftIcon),console.log("Navbar test...3");var o=i.div("collapse navbar-collapse",{id:n});if(console.log("Navbar test...4"),t.itemsLeft){var s=this.listgroup({listClass:"nav navbar-nav",itemClass:"item",items:t.itemsLeft,content:t.content});o.add(s)}return e},t.bs_navtabs=function(t){var e=D("ul").addClass("nav nav-tabs");if(e.q.attr("role","tablist"),t.items){var i;t.items.forEach(function(n){var r=e.li();n.active&&(i=r,r.addClass("active"));var a=r.a();n.title&&a.add(n.title),a.on("click",function(){i&&i.removeClass("active"),r.addClass("active"),i=r,n.action&&n.action(),!n.view&&n.viewFn&&(n.view=n.viewFn(n)),n.view&&t.content&&t.content.pushView(n.view)}),n.active&&a.trigger("click")})}return this.add(e),e},t.bs_pager=function(t){var e=D("ul").addClass("pager");return t.items&&t.items.forEach(function(i){var n=e.li();i.active&&n.addClass("active");var r=n.a();i.title&&r.text(i.title),r.on("click",function(){i.action&&i.action(),i.view&&t.content&&t.content.pushView(i.view)})}),e},t.bs_pagetitle=function(t){var e=D("div").addClass("page-header"),i=e.h1();return i.text(t),e},t.bs_pagination=function(t){{var e=D("ul").addClass("pagination");e.li().a().text("&laquo;")}t.items&&t.items.forEach(function(i){var n=e.li();i.active&&n.addClass("active");var r=n.a();i.title&&r.text(i.title),r.on("click",function(){i.action&&i.action(),i.view&&t.content&&t.content.pushView(i.view)})});e.li().a().text("&raquo;");return e},t.bs_panel=function(t){var e,i,n,r=D("div").addClass("panel panel-"+(t.type||"default")),a=r.div("panel-heading");if(t.body_collapse_id){var o=r.div("panel-collapse collapse",{id:t.body_collapse_id});e=o.div("panel-body"),i=o.div("panel-footer")}else e=r.div("panel-body"),i=r.div("panel-footer");return t.heading&&a.add(t.heading),t.title&&(n=a.h3("panel-title"),n.add(t.title)),t.content&&e.add(t.content),t.footer&&i.add(t.footer),this.setContentFunctions(r,{heading:a,title:n,content:e,footer:i}),r},t.bs_pills=function(t){var e=D("ul").addClass("nav nav-pills");return t.items&&t.items.forEach(function(i){if(i.dropdown){var n=e.li("dropdown"),r=n.a("dropdown-toggle",{"data-toggle":"dropdown",href:"#"});setTimeout(function(){$(r._dom).dropdown()},50)}else var n=e.li(),r=n.a();i.leftBadge&&r.span("badge").text(i.leftBadge),i.title&&r.span().add(i.title),i.rightBadge&&r.span("badge").text(i.rightBadge),i.active&&n.addClass("active"),i.dropdown&&(r.span("caret"),n.add(i.dropdown)),r.on("click",function(){i.action&&i.action(),i.view&&t.content&&t.content.pushView(i.view)})}),e},t.bs_popover=function(t){var e=D("div").addClass("popover "+(t.position||"left")),i=(e.div("arrow"),e.div("popover-title")),n=e.div("popover-content"),r=e.div("panel-footer");
return t.title&&i.text(t.title),t.content&&n.add(t.content),t.footer&&r.add(t.footer),this.setContentFunctions(e,{title:i,content:n,footer:r}),e},t.bs_progressBar=function(t){t.value=t.value||0;var e=o.div("progress");return bb=e.div("progress-bar",{role:"progressbar","aria-valuenow":t.value||0,"aria-valuemin":t.valuemin||0,"aria-valuemax":t.valuemax||100}).width(t.value+"%").text(t.value),t.toText&&t.toText(t.value),bb.setProgress=function(e){t.value=e,bb.width(e+"%"),bb.text(e+"%")},bb.setProgress(t.value),e},t.bs_row=function(t){if("[object Array]"!==Object.prototype.toString.call(t)){var e=t.items,i=e.length;if(0==i)return D();if(t.widths){var n=D("div").addClass("row"),r=0;return t.items.forEach(function(e){var i=t.widths[r++]+"",a=parseInt(i.substring(0,i.length)),o=Math.floor(12*a/100),s=n.div("col col-md-"+o);s.add(e)}),this.add(n),n}if(i>(t.rowSize||12)){for(var a,o=0,n=D("div").addClass("container");(a=e.slice(o,o+(t.rowSize||12)))&&0!=a.length;)n.add(this.bs_row({rowSize:t.rowSize||12,items:a})),o+=t.rowSize||12;return this.add(n),n}var s=Math.floor(12/i);t.rowSize&&(s=Math.floor(12/t.rowSize));var n=D("div").addClass("row");return t.items.forEach(function(t){var e=n.div("col col-md-"+s);e.add(t)}),this.add(n),n}},t.bs_setContentFunctions=function(t,e){for(var i in e)e.hasOwnProperty(i)&&e[i]&&!function(i){var n=e[i],r="component_";r+=i,t[r]=function(t){return t?(n.clear(),void n.add(t)):n}}(i)},t.bs_setItemAction=function(t,e,i){e.on("click",function(){t.action&&t.action(),t.view&&i.content&&i.content.pushView(t.view)})},t.bs_setItemContent=function(t,e){return t.faicon&&(e.span("fa fa-"+t.faicon),e.span().html("&nbsp;")),t.glyph&&(e.span("glyphicon glyphicon-"+t.glyph),e.span().html("&nbsp;")),t.leftBadge&&e.span("badge").text(t.leftBadge),t.title&&e.span().add(t.title),t.rightBadge&&e.span("badge").text(t.rightBadge),t.active&&e.addClass("active"),e},t.bs_textarea=function(t){var e=D("div").addClass("form-group");t.feedback&&e.addClass("has-success has-feedback");var i=e.guid();t.text&&e.label("control-label",{"for":i}).text(t.text);var n=e.textarea("form-control",{id:i,type:t.type||"text",rows:t.rows||6});t.bind&&n.bind(t.bind.data,t.bind.name);var r,a="glyphicon-ok";return t.feedback&&(r=e.span("glyphicon form-control-feedback"),r.hide()),e.setFeedback=function(t){r.removeClass(a),"ok"==t&&(a="glyphicon-ok"),"error"==t&&(a="glyphicon-remove"),"warning"==t&&(a="glyphicon-warning-sign"),r.addClass(a)},this.add(e),e}}(this),function(t){var e;t.colorMix=function(t,e,i){var n=this.toRGB(t),r=this.toRGB(e),a=this.yuvConversion2(n,r,function(t,e){return{y:(1-i)*t.y+i*e.y,u:(1-i)*t.u+i*e.u,v:(1-i)*t.v+i*e.v}});return a},t.colorToHex=function(t){if("#"===t.substr(0,1))return t;var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),i=parseInt(e[2]),n=parseInt(e[3]),r=parseInt(e[4]),a=r|n<<8|i<<16;return e[1]+"#"+a.toString(16)},t.colourNameToHex=function(t){return"undefined"!=typeof e[t.toLowerCase()]?e[t.toLowerCase()]:!1},t.componentToHex=function(t){t=parseInt(t);var e=t.toString(16);return 1==e.length?"0"+e:e},t.hexToRgb=function(t){if("#"==t[0]&&(t=t.substr(1)),3==t.length){var e=t;t="",e=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(e).slice(1);for(var i=0;3>i;i++)t+=e[i]+e[i]}if(!t)return null;if(null!=t){var n=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(t).slice(1);return{r:parseInt(n[0],16),g:parseInt(n[1],16),b:parseInt(n[2],16)}}},t.hexToYuv=function(t){var e=this;return e.rgbToYuv(e.toRGB(t))},t.hsvToRgb=function(t){var e,i,n,r,a,o,s,c,f=Math.max(0,Math.min(360,t.h)),l=Math.max(0,Math.min(100,t.s)),d=Math.max(0,Math.min(100,t.v));if(l/=100,d/=100,0==l)return e=i=n=d,{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*n)};switch(f/=60,r=Math.floor(f),a=f-r,o=d*(1-l),s=d*(1-l*a),c=d*(1-l*(1-a)),r){case 0:e=d,i=c,n=o;break;case 1:e=s,i=d,n=o;break;case 2:e=o,i=d,n=c;break;case 3:e=o,i=s,n=d;break;case 4:e=c,i=o,n=d;break;default:e=d,i=o,n=s}return{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*n)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){e||(e={none:"#ffffff",aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"})}),t.rgbToHex=function(t){var e=this;return"#"+e.componentToHex(t.r)+e.componentToHex(t.g)+e.componentToHex(t.b)},t.rgbToHsv=function(t){var e,i,n,r,a,o=t.r/255,s=t.g/255,c=t.b/255,f=Math.max(o,s,c),l=f-Math.min(o,s,c),d=function(t){return(f-t)/6/l+.5};return 0==l?r=a=0:(a=l/f,e=d(o),i=d(s),n=d(c),o===f?r=n-i:s===f?r=1/3+e-n:c===f&&(r=2/3+i-e),0>r?r+=1:r>1&&(r-=1)),{h:Math.round(360*r),s:Math.round(100*a),v:Math.round(100*f)}},t.rgbToYuv=function(t){var e=t.r/255,i=t.g/255,n=t.b/255;return{y:.299*e+.587*i+.114*n,u:-.14713*e-.28885*i+.436*n,v:.615*e-.51499*i-.10001*n}},t.toRGB=function(t){if("object"==typeof t)return t;var e=this,i=e.colourNameToHex(t);return i||(i=e.colorToHex(t)),e.hexToRgb(i)},t.toRSpace=function(t){return Math.max(0,Math.min(255,Math.round(t)))},t.yuvConversion=function(t,e){var i=this,n=i.rgbToYuv(i.toRGB(t));n=e(n);var r=i.yuvToRgb(n);return i.rgbToHex(r)},t.yuvConversion2=function(t,e,i){var n=this,r=n.rgbToYuv(n.toRGB(t)),a=n.rgbToYuv(n.toRGB(e));r=i(r,a);var o=n.yuvToRgb(r);return n.rgbToHex(o)},t.yuvPixelConversion=function(t,e){var i=me.rgbToYuv(t);i=e(i);var n=me.yuvToRgb(i);return t.r=n.r,t.g=n.g,t.b=n.b,t},t.yuvToRgb=function(t){var e=t.y,i=t.u,n=t.v;return{r:this.toRSpace(255*(e+0*i+1.13983*n)),g:this.toRSpace(255*(e-.39465*i-.5806*n)),b:this.toRSpace(255*(e+2.03211*i))}}}(this),function(t){var e,n,r,a,o,s,c;t.__singleton=function(){return e},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,e){if(t&&o&&o[t]){var i=o[t];return new i(t,e)}}),t._loadRemoteUrls=function(){if(!c){c=!0;for(var t=document.querySelectorAll("[data-url]"),e=0;e<t.length;e++){var i=t[e],n=function(t){var e=t.getAttribute("data-url"),i=e.split("://"),n=(i.shift(),i.shift()),r=n.split("/"),a=r.shift(),o=a.split(":"),s=o[0],c=o[1],f=r.shift(),l=r.pop(),d=r.join("/"),h={channel:{ip:s,port:c,sandbox:f,path:d,file:l,auth:{u:"abba",p:"nowp"}}},u=_data({},h);u.then(function(){var e=t.innerHTML;e=e.trim(),console.log("*** the html "),console.log(e),console.log("*** the data"),console.log(u.toData());var i=D(t);i.renderTemplate(u,e)})};n(i)}}},t.extendAll=function(e,i){if(this.isObject(e)){for(var n in e)e.hasOwnProperty(n)&&this.extendAll(n,e[n]);return this}return t[e]||(t[e]=i),this},t.getComponentRegistry=function(){return o},t.globalState=function(){String.prototype.trim||!function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}();var t=n=function(){var t={},e={},i=1,n={},r={},a={},o=!1,s=null,c=[],f=!1,l={x:0,y:0},d={sx:0,sy:0,dx:0,dy:0};t._cssfactor=1,t.domIndex={};var h="data-egid",u="huNqe7q1",_=1;t.addListener=function(e,i){a[e]||(a[e]=[]);var n=!1;return a[e].forEach(function(t){t==i&&(n=!0)}),n?void 0:(a[e].length>0?a[e][0]=i:a[e].push(i),console.log("Addded listeners"),console.log(a),t)},t.removeListener=function(e,i){if(a[e]){for(var n=a[e],r=n.length,o=0;r>o;o++){var s=n[o];if(s==i){a[e].splice(o,1);break}}return t}};var p=2;t.popZ=function(){return p++},t.msg=t.sendEvent=function(t,e,i,n,r,o,s,c,f){a[t]&&a[t].forEach(function(t){t.trigger(e,i,n,r,o,s,c,f)})},t.onmsg=function(e,i,n){t.addListener(e,{trigger:function(t,e,r,a,o,s){t==i&&n(e,r,a,o,s)}})},t.addToDomIndex=function(e,i){var n;if(n=e.getAttribute(h))return n;var n=u+_;_++,t.domIndex[n]=i,e.setAttribute(h,n)},t.searchDomIndex=function(e){if(e){if("string"==typeof e)return t.domIndex[e];if(e.getAttribute&&(e=e.getAttribute(h)),e)return t.domIndex[e]}},t.addEventListener=function(t,e,i){return e=e.toLowerCase(),t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener(e,i),!0},t.mouse=function(){return l},t.pxParam=function(t){if("string"==typeof t)return parseInt(t)+"px";var e=parseInt(t);return isNaN(e)?void 0:e+"px"},t.bexp=function(t,e){var i="";return i+="-o-"+t+":"+e+";\n",i+="-moz-"+t+":"+e+";\n",i+="-webkit-"+t+":"+e+";\n",i+=t+":"+e+";\n"},t.addEventListener(document,"mousemove",function(t){t=t||window.event,t.pageX?(l.x=t.pageX,l.y=t.pageY):(l.x=t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),l.y=t.clientY+(document.documentElement.scrollTop||document.body.scrollTop)),o&&(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,d.dx=l.x-d.sx,d.dy=l.y-d.sy,s&&s.trigger("drag",d))}),t.setDragged=function(t){o=!0,s=t},t.dragMouseUp=function(){s&&s.trigger("enddrag",d),o=!1,s=null},t.dragMouseDown=function(e){if(f=!0,!o){var i=!1,n=[];if(e?n.push(e):(c.forEach(function(t){t.isHovering()&&n.push(t)}),n.sort(function(t,e){return t.z&&e.z?e.z()-t.z():0})),n[0]){var r=n[0],a=r.offset();return t.setDragged(r),d.sx=l.x,d.sy=l.y,d.dx=0,d.dy=0,d.x=l.x-a.left,d.y=l.y-a.top,i=!0,r.trigger("startdrag",d),!0}}},t.addEventListener(document,"mouseup",function(){t.dragMouseUp()}),t.addEventListener(document,"mousedown",function(e){t.dragMouseDown()&&(e=e||window.event,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1)}),t.draggable=function(t){c.push(t),t.isHovering();var e=t;t.trigger("msg","set item draggable"),t.touchevents(),t.on("touchstart",function(){var i=e.offset(),n=t.touch(0);d.sx=n.startX,d.sy=n.startY,d.dx=0,d.dy=0,d.x=n.startX-i.left,d.y=n.startY-i.top,o=!0,t.trigger("startdrag",d)}),t.on("touchmove",function(){var e=t.touch(0);d.dx=e.dx,d.dy=e.dy,o=!0,t.trigger("drag",d)}),t.on("touchend",function(){var e=t.touch(0);d.dx=e.dx,d.dy=e.dy,t.trigger("enddrag",d),o=!1})},t.findData=function(){};var v=!1;t.send=function(t,e,i,n){if(!v&&t.__id){v=!0;var a=t.__id(),o=r[a];if(o){var s=o[e];s&&s.forEach(function(t){t!=n&&t.trigger(i)})}v=!1}},t.bind=function(e,i,n){e.__id||t.data(e);var a=e.__id(),o=r[a];o||(r[a]={},o=r[a]);var s=o[i];s||(o[i]=[],s=o[i]);for(var c=s.length,f=0;c>f;f++)if(s[f]==n)return t;return s.push(n),t},t.data=function(t){if(!t.__fn){i++;{(function(e){t.__id=function(){return"gd"+e}})(i)}n[t.__id()]=t}return t},t.register=function(t,i){e[t]=i},t.find=function(t){return e[t]},t.trigger=function(e,i,n){if(t._ev&&t._ev[e]){var r=t;return t._ev[e].forEach(function(t){t(r,i,n)}),t}},t.on=function(e,i){t._ev||(t._ev={}),t._ev[e]||(t._ev[e]=[]),t._ev[e].push(i)};var m={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pausebreak",20:"capslock",27:"escape",32:" ",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",43:"+",44:"printscreen",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},g={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},y=!1;return t.listenKeyboard=function(){y||(y=!0,t.getKeyEventName=function(t,e,i){var n="";return i.ctrlKey&&(t+="ctrl-"),i.shiftKey&&(t+="shift-"),"undefined"!=typeof m[e]&&(n=m[e],i.shiftKey&&"undefined"!=typeof g[e]&&(n=g[e])),t+n},t._shiftKeyDown=!1,t.addEventListener(document,"keydown",function(e){var i=e.charCode||e.keyCode||e.which,n=i;t._keyup=n;var r="";16==n&&(t._shiftKeyDown=!0),"undefined"!=typeof m[n]&&(r=m[n],t._shiftKeyDown&&"undefined"!=typeof g[n]&&(r=g[n])),t.trigger("keydown",n),t.trigger(t.getKeyEventName("keydown-",n,e)),t.msg("keyboard",t.getKeyEventName("keydown-",n,e))}),t.addEventListener(document,"keyup",function(e){e=e||window.event;var i=e.charCode||e.keyCode||e.which,n=i;t._keyup=n;var r="";16==n&&(t._shiftKeyDown=!1),"undefined"!=typeof m[n]&&(r=m[n],t._shiftKeyDown&&"undefined"!=typeof g[n]&&(r=g[n])),t.trigger("keyup",n),t.trigger(t.getKeyEventName("keyup-",n,e)),t.msg("keyboard",t.getKeyEventName("keyup-",n,e))}))},t.copy=function(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var i=new Date;return i.setTime(e.getTime()),i}if(e instanceof Array){for(var i=[],n=0,r=e.length;r>n;n++)i[n]=t.copy(e[n]);return i}if(e instanceof Object){var i={};for(var a in e)e.hasOwnProperty(a)&&(i[a]=t.copy(e[a]));return i}throw new Error("Unable to copy obj! Its type isn't supported.")},t}();return t},t.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,e){this.initAsTag(t,e),this._loadRemoteUrls()}),t.initAsTag=function(t,c,f){if(this.isObject(t))this._dom=t,t=this._dom.tagName,"input"==t&&"checkbox"==this._dom.getAttribute("type")&&(t="checkbox");else if(t&&t.charAt&&"#"==t.charAt(0)){console.log("Searching for the element name..."+t);var l=document.getElementById(t.substring(1));l&&(console.log("Found it!!!"),console.log(l.tagName),t=l.tagName,this._dom=l)}o||(o={}),t||(t="div"),e||(this.initElemNames(),e=n=this.globalState(),a={circle:"true",rect:!0,path:!0,svg:!0,image:!0,line:!0,text:!0,tspan:!0,g:!0,pattern:!0,polygon:!0,polyline:!0,clippath:!0,defs:!0,feoffset:!0,femerge:!0,femergenode:!0,fegaussianblur:!0,filter:!0});var d="http://www.w3.org/2000/svg",h=t;if(t=t.toLowerCase(),f);else if(!s[t]&&!a[t])return void(this._invalidTag=t);r||(this.initScreenEvents(),r=!0),a[t]&&(this._svgElem=!0,this._svg=!0),this._type=t,this._tag=t.toLowerCase(),"checkbox"==this._type&&(this._checked=!1,this._tag="input"),this._children=[],"svg"==t&&(this._svg=!0),this._dom||("svg"==t?(this._dom=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._dom.setAttribute("xmlns","http://www.w3.org/2000/svg"),this._dom.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink")):this._dom=this._svgElem?document.createElementNS(d,h):document.createElement(this._tag)),this.q=new i(this._dom,this),"checkbox"==this._type&&this.q.attr("type","checkbox"),!this._component&&c&&"undefined"!=typeof c.appendChild&&c.appendChild(this._dom)},t.initElemNames=function(){if(!s){var t=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","sampe","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];s={},t.forEach(function(t){s[t]=!0})}},t.registerComponent=function(t,e){o[t]||(o[t]=e)}}(this)},D=function(t,e,i,n,r,a,o,s){if(!(this instanceof D))return new D(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=D._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};D._classInfo={name:"_e"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("_e",D),D.prototype=new L,"undefined"!=typeof window&&(window._e=D),"undefined"!=typeof window&&(window._e_prototype=L),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},jeejee=function(t,e,i,n,r,a,o,s){if(!(this instanceof jeejee))return new jeejee(t,e,i,n,r,a,o,s);var c=[t,e,i,n,r,a,o,s];if(this.__factoryClass){var f,l=this;if(this.__factoryClass.forEach(function(t){f=t.apply(l,c)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=jeejee._classInfo.name)return new f(t,e,i,n,r,a,o,s)}else if(f)return f}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,c)})}else"function"==typeof this.init&&this.init.apply(this,c)};jeejee._classInfo={name:"jeejee"},"undefined"!=typeof ocNamespaces&&ocNamespaces("").registerComponent("jeejee",jeejee),jeejee.prototype=new jeejee_prototype,"undefined"!=typeof window&&(window.jeejee=jeejee),"undefined"!=typeof window&&(window.jeejee_prototype=jeejee_prototype);